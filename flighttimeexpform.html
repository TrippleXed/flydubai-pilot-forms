<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FZ_pilot_flying_hours_form</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root{ 
      /* flydubai Official Brand Colors */
      --bg: linear-gradient(135deg, #6d28d9 0%, #7c3aed 12%, #8b5cf6 25%, #a855f7 37%, #c084fc 50%, #6366f1 62%, #8b5cf6 75%, #9333ea 87%, #7c3aed 100%);
      --card: #ffffff; 
      --ink: #0f172a; 
      --muted: #64748b; 
      --accent: #3b82f6; 
      --accent-light: #60a5fa;
      --line: #e2e8f0; 
      --flydubai-blue: #3b82f6;
      --flydubai-orange: #f97316;
      --flydubai-navy: #1e3a8a;
      --flydubai-light-blue: #dbeafe;
      --aviation-silver: #94a3b8;
      --success: #059669;
      --warning: #d97706;
      --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4), 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    html,body{height:100%; scroll-behavior: smooth;}
    body{
      margin:0;
      background: var(--bg);
      background-attachment: fixed;
      background-size: 100% 100vh;
      color:var(--ink);
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      font-weight: 400;
      min-height: 100vh;
    }
    
    .container{
      max-width:1200px;
      margin:40px auto;
      padding:32px;
    }
    
    .card{
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 24px;
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
    }
    
    /* flydubai brand accent stripe */
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 50%, var(--flydubai-blue) 100%);
    }
    header{
      padding: 16px 40px;
      border-bottom: 2px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 30%, #f8fafc 70%, #f1f5f9 100%);
      position: relative;
      min-height: 100px;
    }
    
    header h1{
      margin: 0;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: var(--flydubai-navy);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      line-height: 28px;
    }
    
    header .logo {
      width: 500px;
      height: 100px;
      background-image: url('Flydubai-Logo.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: left center;
    }
    
    header .controls {
      flex-shrink: 0;
      transform: translateY(-10px);
    }
    
    header .controls .btn {
      padding: 0px 20px;
      font-size: 16px;
      font-weight: 700;
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      border-color: #dc2626;
      color: #ffffff;
      box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      line-height: 28px;
      display: flex;
      align-items: center;
    }
    
    header .controls .btn:hover {
      background: linear-gradient(135deg, #b91c1c 0%, #dc2626 100%);
      box-shadow: 0 6px 16px rgba(220, 38, 38, 0.5);
      transform: translateY(-2px);
    }
    
    .content{
      padding: 40px;
    }

    /* Form grid (top row) */
    .grid{
      display: grid;
      gap: 24px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    
    .content > .grid:first-of-type{ 
      gap: 28px; 
      grid-template-columns: minmax(320px, 1fr) minmax(240px, 1fr) minmax(220px, 1fr);
      margin-bottom: 32px;
    }
    
    .content > .grid:first-of-type input, 
    .content > .grid:first-of-type select{ 
      box-sizing: border-box;
    }

    label{
      display: block;
      font-weight: 600;
      margin: 0 0 8px;
      font-size: 14px;
      color: var(--flydubai-navy);
      letter-spacing: 0.025em;
    }
    
    input, select, button{
      font: inherit;
      color: inherit;
      transition: all 0.2s ease-in-out;
    }
    
    input[type="text"], 
    input[type="date"], 
    select{
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 3px solid #cbd5e1;
      background: #ffffff;
      color: var(--ink);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), inset 0 1px 3px rgba(0, 0, 0, 0.05);
    }
    
    input[type="text"]:focus, 
    input[type="date"]:focus, 
    select:focus{
      outline: none;
      border-color: var(--flydubai-blue);
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2), 0 0 0 4px rgba(59, 130, 246, 0.15), inset 0 1px 3px rgba(0, 0, 0, 0.05);
      transform: translateY(-2px);
    }
    
    input[type="text"]::placeholder{
      color: var(--aviation-silver);
      font-weight: 400;
    }
    
    /* Validation styles for required notes fields */
    .ac-notes.required-empty {
      border-color: #dc2626 !important;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
    }

    h2.section-h{
      margin: 20px 0 16px;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: var(--flydubai-navy);
      text-transform: uppercase;
      position: relative;
      padding-left: 24px;
    }
    
    h2.section-h::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 24px;
      background: var(--flydubai-orange);
      border-radius: 2px;
    }
    
    .section{
      border: 2px solid var(--line);
      border-radius: 20px;
      padding: 32px;
      margin-top: 24px;
      background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 100%);
    }
    
    .section-title{
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--line);
    }
    
    .section-title h3{
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--flydubai-navy);
      letter-spacing: -0.025em;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      table-layout: fixed;
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    
    th, td{
      border-bottom: 1px solid var(--line);
      padding: 16px 12px;
      vertical-align: middle;
    }
    
    th{
      font-size: 14px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      text-align: center;
      background: linear-gradient(135deg, var(--flydubai-blue) 0%, var(--flydubai-navy) 100%);
      color: #ffffff;
      position: relative;
      padding: 20px 12px;
      line-height: 1.3;
      vertical-align: middle;
    }

    .flight-role {
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      color: var(--flydubai-navy);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 18px 16px;
      vertical-align: middle;
    }
    
    th:first-child {
      border-top-left-radius: 16px;
    }
    
    th:last-child {
      border-top-right-radius: 16px;
    }
    
    th b{
      font-weight: 700;
      display: block;
      margin-bottom: 2px;
    }
    
    .flight-role{
      font-weight: 700;
      color: var(--flydubai-blue);
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }
    
    tbody tr:hover {
      background-color: rgba(30, 58, 138, 0.02);
    }
    .hhmm{
      width: 96px;
      max-width: 100%;
      display: block;
      margin: 0 auto;
      text-align: center;
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }
    
    td input[type="text"].hhmm{
      width: 96px;
      padding: 10px 8px;
      font-family: 'Courier New', monospace;
      font-weight: 600;
      text-align: center;
    }
    
    td input[type="date"]{
      width: 150px;
      display: block;
      margin: 0 auto;
      text-align: center;
      padding: 10px 8px;
    }

    .controls{
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 20px;
      justify-content: center;
    }

    .section-title .controls {
      margin-top: 0;
      transform: translateY(-10px);
    }
    
    .btn{
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid var(--line);
      padding: 12px 20px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.025em;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
      transition: left 0.5s;
    }
    
    .btn:hover{
      border-color: var(--flydubai-blue);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn:hover::before {
      left: 100%;
    }
    
    .btn:active{
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .btn.primary{
      background: linear-gradient(135deg, var(--flydubai-blue) 0%, var(--accent-light) 100%);
      border-color: var(--flydubai-blue);
      color: #ffffff;
      font-weight: 700;
    }
    
    .btn.primary:hover{
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.4);
    }
    
    .btn.warn{
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border-color: #fca5a5;
      color: #dc2626;
    }
    
    .btn.warn:hover{
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3);
    }
    
    #btnAddSection{ 
      background: linear-gradient(135deg, var(--flydubai-orange) 0%, #fb923c 100%);
      border-color: var(--flydubai-orange);
      color: #ffffff;
      font-weight: 700;
    }
    
    #btnAddSection:hover{ 
      box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
    }

    .kpi{
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid var(--line);
      padding: 20px 24px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .kpi::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--flydubai-orange);
    }
    
    .kpi b{
      font-size: 20px;
      font-weight: 700;
      color: var(--flydubai-blue);
      font-family: 'Courier New', monospace;
      display: block;
      margin-top: 4px;
    }
    
    .footer-fields{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }
    
    .footer-fields label{
      font-weight: 700;
      text-align: center;
      color: var(--flydubai-navy);
      margin-bottom: 12px;
    }
    .date-cell{
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .date-print{
      display: none;
      padding: 10px 16px;
      border: 2px dashed var(--line);
      border-radius: 12px;
      color: var(--flydubai-navy);
      font-weight: 600;
      background: #f8fafc;
    }

    .grand{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 32px;
    }
    
    .summary{
      margin-top: 48px;
      border-top: 3px solid var(--flydubai-orange);
      padding-top: 32px;
      position: relative;
    }
    
    .summary::before {
      content: '';
      position: absolute;
      top: -3px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 6px;
      background: var(--flydubai-blue);
      border-radius: 0 0 3px 3px;
    }

    /* Signature section */
    #signSection .sig-pad{ 
      border: 2px dashed var(--flydubai-orange);
      border-radius: 16px;
      background: #fff;
      padding: 16px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    #sigCanvas{ 
      width: 100%;
      height: 160px;
      background: #fff;
      border-radius: 8px;
      cursor: crosshair;
    }
    
    #sigControls{ 
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    @media print{ #sigControls{ display:none !important } }

    /* PDF preview mode matches A4 before capture */
    body.pdf .container{ max-width:calc(210mm - 12mm); padding:6mm; margin:0 auto }
    body.pdf #formCard{ box-shadow:none; border-color:#d1d5db; border-radius:0 }
    body.pdf table, body.pdf tr, body.pdf td, body.pdf th{ page-break-inside: avoid }
    body.pdf *{ -webkit-print-color-adjust: exact; print-color-adjust: exact }

    @page{ size:A4; margin:6mm }
    @media print{ *{ -webkit-print-color-adjust: exact; print-color-adjust: exact }
      body{background:#fff;color:#000}
      .no-print{display:none !important}
      .card, .section{box-shadow:none;border-color:#d1d5db}
      header{border-color:#d1d5db}
      th,td{border-color:#e5e7eb}
      /* keep visual boxes for dates */
      .date-print{display:inline-block} .date-inp, #sigDate{opacity:0;position:absolute;width:0;height:0;pointer-events:none}
      .container{ max-width:calc(210mm - 12mm); margin:0 auto; padding:6mm }
      table, tr, td, th{ page-break-inside: avoid }
    }
  /* Improve spacing/legibility in SUMMARY tables only */
    .summary table th{ padding-top:12px; padding-bottom:12px; line-height:1.2 }
    .summary table td{ padding-top:10px; padding-bottom:10px }
    @media print{ .summary table th{ font-size:11px } .summary table td input.hhmm{ width:90px } }
  /* tiny spacing for MP/Night inputs to avoid touching */
    .footer-fields input.hhmm{ margin-top:4px }
    @media print{ #doj{ -webkit-appearance:none; appearance:none; width:auto; max-width:200px; box-sizing:border-box; padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; background:#fff } #doj::-webkit-calendar-picker-indicator{ display:none } }
  /* spacing so MP/Night boxes never touch */
    .footer-fields .mp{ margin-right:8px }
    .footer-fields .night{ margin-left:8px }
    /* prevent Date of Joining from exceeding its container in PDF */
    @media print{
      #doj{ display:block; width:auto; max-width:200px; box-sizing:border-box; padding:10px 12px; border:1px solid #d1d5db; border-radius:10px; background:#fff }
      #doj::-webkit-calendar-picker-indicator{ display:none }
    }
  /* ensure inputs never touch borders */
    .section input, .section select{ box-sizing:border-box }
  /* limit signature date width so it doesn't reach signature pad */
    #signSection #sigDate{ max-width:180px }
  /* center-align MP & Night inputs exactly under their labels */
    .footer-fields .mp, .footer-fields .night{ width:84px; margin:4px auto 0 !important; display:block }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="formCard">
      <header>
        <div class="logo"></div>
        <h1>FLIGHT TIME EXPERIENCE</h1>
        <div class="controls no-print">
          <button class="btn" id="btnReset" title="Clear all">Reset Form</button>
        </div>
      </header>

      <div class="content">
        <!-- Pilot Info -->
        <div class="grid">
          <div>
            <label for="pilotName">Name</label>
            <input id="pilotName" type="text" placeholder="e.g., Jane D. Pilot" />
          </div>
          <div>
            <label for="designation">Designation</label>
            <select id="designation">
              <option value="">Select…</option>
              <option>Captain</option>
              <option>First Officer</option>
              <option>Second Officer</option>
              <option>Cadet</option>
            </select>
          </div>
          <div>
            <label for="doj">Date of Joining</label>
            <input id="doj" type="date" />
          </div>
        </div>

        <h2 class="section-h">Flight Experience by Aircraft Type</h2>
        <div id="sections"></div>
        <div class="controls no-print">
          <button class="btn" id="btnAddSection">+ Add another aircraft type</button>
        </div>

        <!-- Grand totals for all aircraft types -->
        <div class="section" id="grandTotals">
          <div class="section-title">
            <h3>GRAND TOTALS (All Aircraft Types)</h3>
          </div>
          <div class="grand">
            <div class="kpi">Combined Block Hours: <b id="gtCombined">0:00</b></div>
            <div class="kpi">Multi‑Pilot Block Hours: <b id="gtMP">0:00</b></div>
            <div class="kpi">Night Hours: <b id="gtNight">0:00</b></div>
          </div>
        </div>

        <!-- SUMMARY SECTION -->
        <div class="summary">
          <h2 class="section-h">FLYING EXPERIENCE SUMMARY</h2>
          <h3 class="section-h" style="margin-top:6px">GENERAL</h3>
          <div class="section">
            <table>
              <thead>
                <tr>
                  <th><b>PIC/P1</b></th>
                  <th><b>SIC/P2</b></th>
                  <th><b>SOLO</b></th>
                  <th><b>INSTRUMENT</b></th>
                  <th><b>SIM</b></th>
                  <th><b>NIGHT</b></th>
                  <th><b>INSTRUCTOR</b></th>
                  <th><b>P1 U/S</b></th>
                  <th><b>GRAND TOTAL</b></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Declaration & Signature -->
        <div class="section" id="signSection">
          <div class="section-title"><h3>✍️ Declaration & Digital Signature</h3></div>
          <div style="background:linear-gradient(135deg,#fef7ed 0%,#fed7aa 100%);padding:20px;border-radius:12px;border:2px solid var(--flydubai-orange);margin-bottom:24px;">
            <p style="font-size:14px;line-height:1.7;color:var(--flydubai-navy);margin:0;font-weight:500;text-align:justify;">
              <strong>DECLARATION:</strong> I solemnly declare and affirm that all flight time, experience records, and operational details contained herein are true, accurate, and complete in accordance with ICAO Annex 1 standards and applicable civil aviation regulations. I acknowledge that this declaration is made under penalty of regulatory sanctions and understand that any material misrepresentation, omission, or falsification may result in suspension or revocation of aviation privileges, disciplinary proceedings pursuant to applicable aviation law, and may constitute grounds for disqualification from aviation employment. I further acknowledge my continuing obligation to maintain the accuracy and currency of this record in compliance with regulatory requirements.
            </p>
          </div>
          <div class="grid">
            <div>
              <label>Date</label>
              <input type="date" id="sigDate" />
              <span class="date-print" id="sigDatePrint"></span>
            </div>
            <div>
              <label>Digital Signature</label>
              <div class="sig-pad">
                <canvas id="sigCanvas"></canvas>
                <div id="sigControls" class="controls no-print">
                  <input type="text" id="typedSig" placeholder="Type name to render as signature" style="flex:1;min-width:220px;padding:10px 12px;border:1px solid var(--line);border-radius:10px" />
                  <button class="btn" id="sigApply">Apply Typed</button>
                  <label class="btn" for="sigUpload">Upload Image</label>
                  <input id="sigUpload" type="file" accept="image/*" style="display:none" />
                  <button class="btn warn" id="sigClear">Clear</button>
                </div>
              </div>
              <div class="muted" style="font-size:12px;margin-top:6px">You can draw, apply a typed name, or upload a signature image.</div>
            </div>
          </div>
        </div>

        <!-- Bottom note & centered Submit button -->
        <div id="submitNote" style="text-align:center;margin:40px 0 0;padding:32px;background:linear-gradient(135deg,#fafbff 0%,#f8fafc 100%);border-radius:20px;border:2px solid var(--line);">
          <p style="margin:0 0 20px;font-size:15px;color:var(--flydubai-navy);font-weight:500;">Please review all information and submit your completed form to <strong style="color:var(--flydubai-blue);font-weight:700;">FOF.Admin@flydubai.com</strong></p>
          <div class="no-print" style="text-align:center;">
            <button class="btn primary" id="btnSubmit" style="font-size:16px;padding:16px 32px;">📤 Submit Form</button>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
    // ===== Utilities =====
    function parseHHMM(str){ if(!str) return 0; const m = String(str).trim().match(/^\s*(\d+)\s*:\s*(\d{1,2})\s*$/); if(!m) return 0; let h = parseInt(m[1],10)||0; let mm = parseInt(m[2],10)||0; h += Math.floor(mm/60); mm = mm % 60; return h*60 + mm; }
    function toHHMM(totalMinutes){ totalMinutes = Math.max(0, Math.floor(totalMinutes||0)); const h = Math.floor(totalMinutes/60); const m = totalMinutes % 60; return h+":"+(m<10?"0"+m:m); }
    function padHHMM(el){ const v = el.value.trim(); const mins = parseHHMM(v); el.value = mins ? toHHMM(mins) : ""; }
    const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]; function toDDMMMYYYY(iso){ if(!iso) return ""; const d = new Date(iso); if(Number.isNaN(d.getTime())) return ""; const dd = String(d.getDate()).padStart(2,'0'); const mmm = MONTHS[d.getMonth()]; const yyyy = d.getFullYear(); return `${dd}-${mmm}-${yyyy}`; }

    // ===== Sections builder =====
    let sectionCounter = 0;
    function makeAircraftSection({label, typeText, locked=false, b737Type=null}){
      const id = ++sectionCounter;
      const sec = document.createElement('section');
      sec.className = 'section'; sec.dataset.sectionId = id; sec.dataset.locked = locked ? '1' : '0';
      
      let aircraftDropdown = '';
      if(b737Type) {
        // Special dropdown for Boeing 737 variants
        aircraftDropdown = `
        <div style="display: grid; grid-template-columns: 400px auto 1fr; gap: 16px; align-items: end;">
          <div>
            <select class="ac-type" ${locked ? 'disabled' : ''} style="${locked ? 'background-color: #f3f4f6; cursor: not-allowed;' : ''}">
              ${b737Type === 'ng-max' ? `
                <option value="Boeing 737 NG/MAX">Boeing 737 NG/MAX</option>
              ` : `
                <option value="Boeing 737 Classic (300-500)">Boeing 737 Classic (300-500)</option>
              `}
            </select>
          </div>
          <div class="heavy-jet-indicator" style="display: flex; align-items: center; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);">
            ✈ >50T MTOW
          </div>
          <div class="notes-field" style="display: none;">
            <label>Notes/Comments (Required if "Other" selected above)</label>
            <input type="text" class="ac-notes" placeholder="Please specify aircraft type, model, or any additional details..." style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid var(--line); background: #ffffff; color: var(--ink); font-family: inherit; font-size: 14px;" />
          </div>
        </div>`;
      } else {
        // Regular dropdown for other aircraft
        aircraftDropdown = `
        <div style="display: grid; grid-template-columns: 400px auto 1fr; gap: 16px; align-items: end;">
          <div>
            <select class="ac-type">
              <option value="">Select Aircraft Type...</option>
              <optgroup label="Boeing Commercial Aircraft">
                <option value="Boeing 757-200">Boeing 757-200</option>
                <option value="Boeing 757-300">Boeing 757-300</option>
                <option value="Boeing 767-200">Boeing 767-200</option>
                <option value="Boeing 767-300">Boeing 767-300</option>
                <option value="Boeing 777-200">Boeing 777-200</option>
                <option value="Boeing 777-300">Boeing 777-300</option>
                <option value="Boeing 787-8">Boeing 787-8 Dreamliner</option>
                <option value="Boeing 787-9">Boeing 787-9 Dreamliner</option>
                <option value="Boeing 787-10">Boeing 787-10 Dreamliner</option>
              </optgroup>
              <optgroup label="Airbus Commercial Aircraft">
                <option value="Airbus A319">Airbus A319</option>
                <option value="Airbus A320">Airbus A320</option>
                <option value="Airbus A321">Airbus A321</option>
                <option value="Airbus A330-200">Airbus A330-200</option>
                <option value="Airbus A330-300">Airbus A330-300</option>
                <option value="Airbus A340-200">Airbus A340-200</option>
                <option value="Airbus A340-300">Airbus A340-300</option>
                <option value="Airbus A350-900">Airbus A350-900</option>
                <option value="Airbus A350-1000">Airbus A350-1000</option>
                <option value="Airbus A380">Airbus A380</option>
              </optgroup>
              <optgroup label="Regional Jets & Commercial Aircraft">
                <option value="McDonnell Douglas MD-80">McDonnell Douglas MD-80</option>
                <option value="McDonnell Douglas MD-90">McDonnell Douglas MD-90</option>
                <option value="Embraer E-Jet E170">Embraer E-Jet E170</option>
                <option value="Embraer E-Jet E175">Embraer E-Jet E175</option>
                <option value="Embraer E-Jet E190">Embraer E-Jet E190</option>
                <option value="Embraer E-Jet E195">Embraer E-Jet E195</option>
                <option value="Bombardier CRJ-100">Bombardier CRJ-100</option>
                <option value="Bombardier CRJ-200">Bombardier CRJ-200</option>
                <option value="Bombardier CRJ-700">Bombardier CRJ-700</option>
                <option value="Bombardier CRJ-900">Bombardier CRJ-900</option>
                <option value="Bombardier CRJ-1000">Bombardier CRJ-1000</option>
                <option value="British Aerospace 146">British Aerospace BAe 146</option>
                <option value="Avro RJ70">Avro RJ70</option>
                <option value="Avro RJ85">Avro RJ85</option>
                <option value="Avro RJ100">Avro RJ100</option>
                <option value="Dornier 328JET">Dornier 328JET</option>
                <option value="Fairchild Metro III">Fairchild Metro III</option>
                <option value="Jetstream 41">BAe Jetstream 41</option>
                <option value="Embraer EMB-120">Embraer EMB-120 Brasilia</option>
              </optgroup>
              <optgroup label="Cargo Aircraft">
                <option value="Boeing 747-400F">Boeing 747-400F Freighter</option>
                <option value="Boeing 767-300F">Boeing 767-300F Freighter</option>
                <option value="Boeing 777F">Boeing 777F Freighter</option>
                <option value="Airbus A330-200F">Airbus A330-200F Freighter</option>
                <option value="McDonnell Douglas MD-11F">McDonnell Douglas MD-11F</option>
              </optgroup>
              <optgroup label="Business Jets & Private Aircraft">
                <option value="Gulfstream G150">Gulfstream G150</option>
                <option value="Gulfstream G280">Gulfstream G280</option>
                <option value="Gulfstream G450">Gulfstream G450</option>
                <option value="Gulfstream G500">Gulfstream G500</option>
                <option value="Gulfstream G550">Gulfstream G550</option>
                <option value="Gulfstream G600">Gulfstream G600</option>
                <option value="Gulfstream G650">Gulfstream G650</option>
                <option value="Gulfstream G700">Gulfstream G700</option>
                <option value="Bombardier Global 5000">Bombardier Global 5000</option>
                <option value="Bombardier Global 5500">Bombardier Global 5500</option>
                <option value="Bombardier Global 6000">Bombardier Global 6000</option>
                <option value="Bombardier Global 6500">Bombardier Global 6500</option>
                <option value="Bombardier Global 7500">Bombardier Global 7500</option>
                <option value="Bombardier Challenger 300">Bombardier Challenger 300</option>
                <option value="Bombardier Challenger 350">Bombardier Challenger 350</option>
                <option value="Bombardier Challenger 605">Bombardier Challenger 605</option>
                <option value="Bombardier Challenger 650">Bombardier Challenger 650</option>
                <option value="Dassault Falcon 2000">Dassault Falcon 2000</option>
                <option value="Dassault Falcon 2000EX">Dassault Falcon 2000EX</option>
                <option value="Dassault Falcon 2000LX">Dassault Falcon 2000LX</option>
                <option value="Dassault Falcon 6X">Dassault Falcon 6X</option>
                <option value="Dassault Falcon 7X">Dassault Falcon 7X</option>
                <option value="Dassault Falcon 8X">Dassault Falcon 8X</option>
                <option value="Dassault Falcon 900">Dassault Falcon 900</option>
                <option value="Cessna Citation X">Cessna Citation X</option>
                <option value="Cessna Citation X+">Cessna Citation X+</option>
                <option value="Cessna Citation Columbus">Cessna Citation Columbus</option>
                <option value="Cessna Citation Hemisphere">Cessna Citation Hemisphere</option>
                <option value="Cessna Citation Sovereign">Cessna Citation Sovereign</option>
                <option value="Cessna Citation Sovereign+">Cessna Citation Sovereign+</option>
                <option value="Cessna Citation Latitude">Cessna Citation Latitude</option>
                <option value="Cessna Citation Longitude">Cessna Citation Longitude</option>
                <option value="Hawker 4000">Hawker 4000</option>
                <option value="Hawker 800XP">Hawker 800XP</option>
                <option value="Hawker 850XP">Hawker 850XP</option>
                <option value="Hawker 900XP">Hawker 900XP</option>
                <option value="Embraer Legacy 450">Embraer Legacy 450</option>
                <option value="Embraer Legacy 500">Embraer Legacy 500</option>
                <option value="Embraer Legacy 600">Embraer Legacy 600</option>
                <option value="Embraer Legacy 650">Embraer Legacy 650</option>
                <option value="Embraer Lineage 1000">Embraer Lineage 1000</option>
                <option value="Embraer Praetor 500">Embraer Praetor 500</option>
                <option value="Embraer Praetor 600">Embraer Praetor 600</option>
              </optgroup>
              <optgroup label="Light Jets & Mid-Size Jets">
                <option value="Cessna Citation CJ3+">Cessna Citation CJ3+</option>
                <option value="Cessna Citation CJ4">Cessna Citation CJ4</option>
                <option value="Cessna Citation M2">Cessna Citation M2</option>
                <option value="Cessna Citation XLS+">Cessna Citation XLS+</option>
                <option value="Embraer Phenom 100">Embraer Phenom 100</option>
                <option value="Embraer Phenom 300">Embraer Phenom 300</option>
                <option value="HondaJet">HondaJet</option>
                <option value="Pilatus PC-24">Pilatus PC-24</option>
                <option value="Beechcraft Premier 1A">Beechcraft Premier 1A</option>
                <option value="Learjet 45">Learjet 45</option>
                <option value="Learjet 60">Learjet 60</option>
                <option value="Learjet 70">Learjet 70</option>
                <option value="Learjet 75">Learjet 75</option>
              </optgroup>
              <optgroup label="Turboprop Aircraft">
                <option value="ATR 42">ATR 42</option>
                <option value="ATR 72">ATR 72</option>
                <option value="Bombardier Q400">Bombardier Q400 (Dash 8)</option>
                <option value="Bombardier Dash 8-100">Bombardier Dash 8-100</option>
                <option value="Bombardier Dash 8-200">Bombardier Dash 8-200</option>
                <option value="Bombardier Dash 8-300">Bombardier Dash 8-300</option>
                <option value="Saab 340">Saab 340</option>
                <option value="Saab 2000">Saab 2000</option>
                <option value="Dornier 328">Dornier Do 328</option>
                <option value="Let L-410">Let L-410 Turbolet</option>
                <option value="Jetstream 32">BAe Jetstream 32</option>
                <option value="Jetstream 31">BAe Jetstream 31</option>
                <option value="Beechcraft 1900">Beechcraft 1900</option>
                <option value="Beechcraft King Air 90">Beechcraft King Air 90</option>
                <option value="Beechcraft King Air 200">Beechcraft King Air 200</option>
                <option value="Beechcraft King Air 250">Beechcraft King Air 250</option>
                <option value="Beechcraft King Air 300">Beechcraft King Air 300</option>
                <option value="Beechcraft King Air 350">Beechcraft King Air 350</option>
                <option value="Pilatus PC-12">Pilatus PC-12</option>
                <option value="Pilatus PC-6 Porter">Pilatus PC-6 Porter</option>
                <option value="TBM 700">TBM 700</option>
                <option value="TBM 850">TBM 850</option>
                <option value="TBM 900">TBM 900</option>
                <option value="TBM 930">TBM 930</option>
                <option value="TBM 960">TBM 960</option>
                <option value="Piper Meridian">Piper Meridian</option>
                <option value="Piper Cheyenne">Piper Cheyenne</option>
                <option value="Cessna Caravan 208">Cessna Caravan 208</option>
                <option value="Cessna 208 Amphibian">Cessna 208 Caravan Amphibian</option>
                <option value="Cessna Conquest">Cessna Conquest</option>
                <option value="Cessna 441">Cessna 441 Conquest</option>
                <option value="Piper Aztec">Piper PA-23 Aztec</option>
                <option value="Britten-Norman Islander">Britten-Norman BN-2 Islander</option>
                <option value="Britten-Norman Trislander">Britten-Norman BN-2A Trislander</option>
                <option value="DHC-6 Twin Otter">de Havilland Canada DHC-6 Twin Otter</option>
                <option value="DHC-7 Dash 7">de Havilland Canada DHC-7 Dash 7</option>
                <option value="Shorts 330">Shorts 330</option>
                <option value="Shorts 360">Shorts 360</option>
              </optgroup>
              <optgroup label="Single Engine Piston">
                <option value="Cessna 150">Cessna 150</option>
                <option value="Cessna 152">Cessna 152</option>
                <option value="Cessna 162 SkyCatcher">Cessna 162 SkyCatcher</option>
                <option value="Cessna 172">Cessna 172 Skyhawk</option>
                <option value="Cessna 177">Cessna 177 Cardinal</option>
                <option value="Cessna 180">Cessna 180 Skywagon</option>
                <option value="Cessna 182">Cessna 182 Skylane</option>
                <option value="Cessna 185">Cessna 185 Skywagon</option>
                <option value="Cessna 206">Cessna 206 Stationair</option>
                <option value="Cessna 210">Cessna 210 Centurion</option>
                <option value="Piper Cherokee">Piper Cherokee (PA-28)</option>
                <option value="Piper Warrior">Piper Warrior (PA-28)</option>
                <option value="Piper Archer">Piper Archer (PA-28)</option>
                <option value="Piper Arrow">Piper Arrow (PA-28R)</option>
                <option value="Piper Saratoga">Piper Saratoga (PA-32)</option>
                <option value="Piper Lance">Piper Lance (PA-32R)</option>
                <option value="Piper Cub">Piper J-3 Cub</option>
                <option value="Piper Super Cub">Piper PA-18 Super Cub</option>
                <option value="Beechcraft Bonanza">Beechcraft Bonanza (A36)</option>
                <option value="Beechcraft Musketeer">Beechcraft Musketeer</option>
                <option value="Beechcraft Sundowner">Beechcraft Sundowner</option>
                <option value="Cirrus SR20">Cirrus SR20</option>
                <option value="Cirrus SR22">Cirrus SR22</option>
                <option value="Diamond DA20">Diamond DA20 Katana</option>
                <option value="Diamond DA40">Diamond DA40 Diamond Star</option>
                <option value="Diamond DA50">Diamond DA50 RG</option>
                <option value="Diamond DA62">Diamond DA62</option>
                <option value="Mooney M20">Mooney M20</option>
                <option value="American Champion Scout">American Champion 8KCAB Scout</option>
                <option value="Grumman AA-5">Grumman American AA-5</option>
                <option value="Grumman Tiger">Grumman AA-5B Tiger</option>
                <option value="Robin DR400">Robin DR400</option>
                <option value="Socata TB10">Socata TB10 Tobago</option>
                <option value="Socata TB20">Socata TB20 Trinidad</option>
                <option value="Extra EA-300">Extra EA-300</option>
                <option value="Slingsby T67 Firefly">Slingsby T67 Firefly</option>
                <option value="Tecnam P2008">Tecnam P2008</option>
                <option value="Flight Design CTLS">Flight Design CTLS</option>
                <option value="Van's RV-6">Van's Aircraft RV-6</option>
                <option value="Van's RV-7">Van's Aircraft RV-7</option>
                <option value="Van's RV-8">Van's Aircraft RV-8</option>
                <option value="Van's RV-9">Van's Aircraft RV-9</option>
                <option value="Van's RV-10">Van's Aircraft RV-10</option>
              </optgroup>
              <optgroup label="Twin Engine Piston">
                <option value="Beechcraft Baron">Beechcraft Baron</option>
                <option value="Beechcraft Twin Bonanza">Beechcraft Twin Bonanza</option>
                <option value="Cessna 310">Cessna 310</option>
                <option value="Cessna 340">Cessna 340</option>
                <option value="Cessna 414">Cessna 414</option>
                <option value="Cessna 421">Cessna 421</option>
                <option value="Piper Seneca">Piper Seneca</option>
                <option value="Piper Navajo">Piper Navajo</option>
                <option value="Piper Aztec">Piper Aztec</option>
                <option value="Diamond DA42">Diamond DA42 Twin Star</option>
              </optgroup>
              <optgroup label="Helicopters">
                <option value="Bell 206">Bell 206 JetRanger</option>
                <option value="Bell 407">Bell 407</option>
                <option value="Bell 412">Bell 412</option>
                <option value="Bell 429">Bell 429</option>
                <option value="Airbus H120">Airbus H120 (EC120)</option>
                <option value="Airbus H125">Airbus H125 (AS350)</option>
                <option value="Airbus H130">Airbus H130 (EC130)</option>
                <option value="Airbus H135">Airbus H135 (EC135)</option>
                <option value="Airbus H145">Airbus H145 (EC145)</option>
                <option value="Robinson R22">Robinson R22</option>
                <option value="Robinson R44">Robinson R44</option>
                <option value="Robinson R66">Robinson R66</option>
                <option value="Sikorsky S-76">Sikorsky S-76</option>
                <option value="AgustaWestland AW139">AgustaWestland AW139</option>
              </optgroup>
              <optgroup label="Military & Special Aircraft">
                <option value="Lockheed C-130 Hercules">Lockheed C-130 Hercules</option>
                <option value="Boeing KC-135">Boeing KC-135 Stratotanker</option>
                <option value="Airbus A400M">Airbus A400M Atlas</option>
                <option value="Boeing E-3 AWACS">Boeing E-3 AWACS</option>
                <option value="Lockheed P-3 Orion">Lockheed P-3 Orion</option>
                <option value="Boeing P-8 Poseidon">Boeing P-8 Poseidon</option>
                <option value="General Atomics MQ-9">General Atomics MQ-9 Reaper (UAV)</option>
              </optgroup>
              <optgroup label="Vintage & Classic Aircraft">
                <option value="Douglas DC-3">Douglas DC-3</option>
                <option value="Boeing 727">Boeing 727</option>
                <option value="McDonnell Douglas DC-9">McDonnell Douglas DC-9</option>
                <option value="Lockheed L-1011">Lockheed L-1011 TriStar</option>
                <option value="Sud Aviation Caravelle">Sud Aviation Caravelle</option>
                <option value="BAC One-Eleven">BAC One-Eleven</option>
                <option value="Fokker F28">Fokker F28</option>
                <option value="Fokker 100">Fokker 100</option>
              </optgroup>
              <optgroup label="Other Aircraft Types">
                <option value="Glider">Glider/Sailplane</option>
                <option value="Ultralight">Ultralight Aircraft</option>
                <option value="Experimental">Experimental Aircraft</option>
                <option value="Other - Specify in Notes">Other - Specify in Notes</option>
              </optgroup>
            </select>
          </div>
          <div class="heavy-jet-indicator" style="display: none; align-items: center; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);">
            ✈ >50T MTOW
          </div>
          <div class="notes-field" style="display: none;">
            <label>Notes/Comments (Required if "Other" selected above)</label>
            <input type="text" class="ac-notes" placeholder="Please specify aircraft type, model, or any additional details..." style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid var(--line); background: #ffffff; color: var(--ink); font-family: inherit; font-size: 14px;" />
          </div>
        </div>`;
      }
      
      sec.innerHTML = `
        <div class="section-title">
          <h3>${label}${typeText?': '+typeText:''}</h3>
          <div class="controls no-print">${locked?'' : '<button class="btn warn" data-remove-section>Remove</button>'}</div>
        </div>
        ${locked && !b737Type ? '' : aircraftDropdown}
        <table>
          <thead>
            <tr>
              <th><b>Flight Role</b></th>
              <th><b>Total Hours</b><span class="sub"><b>(HH:MM)</b></span></th>
              <th><b>Total Block Hours in the Last 12 Months</b><span class="sub"><b>(HH:MM)</b></span></th>
              <th><b>Date of First Flight</b><span class="sub"><b>(Last 12 Months)</b></span></th>
              <th><b>Date of Last Flight</b><span class="sub"><b>(Last 12 Months)</b></span></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="flight-role"><strong>PIC</strong></td>
              <td><input type="text" class="hhmm totHours" placeholder="0:00" /></td>
              <td><input type="text" class="hhmm blk12" placeholder="0:00" /></td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
            </tr>
            <tr>
              <td class="flight-role">SIC</td>
              <td><input type="text" class="hhmm totHours" placeholder="0:00" /></td>
              <td><input type="text" class="hhmm blk12" placeholder="0:00" /></td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="footer-fields">
          <div>
            <label>Total Combined Block Hours (HH:MM)</label>
            <div class="kpi"><b class="combined">0:00</b></div>
          </div>
          <div>
            <label>Total Multi‑Pilot Block Hours (HH:MM)</label>
            <input type="text" class="hhmm mp" placeholder="0:00" />
          </div>
          <div>
            <label>Total Night Hours (HH:MM)</label>
            <input type="text" class="hhmm night" placeholder="0:00" />
          </div>
        </div>
      `;
      return sec;
    }

    const sectionsWrap = document.getElementById('sections');
    // Locked sections 1 & 2 with Boeing 737 variants
    sectionsWrap.appendChild(makeAircraftSection({label:'Aircraft Type 1', typeText:'', locked:true, b737Type:'ng-max'}));
    sectionsWrap.appendChild(makeAircraftSection({label:'Aircraft Type 2', typeText:'', locked:true, b737Type:'classic'}));
    // Start with one blank; add more via + button
    sectionsWrap.appendChild(makeAircraftSection({label:'Aircraft Type 3', typeText:'', locked:false}));

    // ===== Events =====
    // Function to check if aircraft is above 50 tons MTOW
    function isHeavyJet(aircraftType) {
      const heavyJets = [
        // Boeing 737 variants (all above 50T MTOW)
        'Boeing 737 NG/MAX',
        'Boeing 737 Classic (300-500)',
        // Boeing Commercial Aircraft
        'Boeing 757-200', 'Boeing 757-300',
        'Boeing 767-200', 'Boeing 767-300', 
        'Boeing 777-200', 'Boeing 777-300',
        'Boeing 787-8 Dreamliner', 'Boeing 787-9 Dreamliner', 'Boeing 787-10 Dreamliner',
        // Airbus Commercial Aircraft  
        'Airbus A319', 'Airbus A320', 'Airbus A321',
        'Airbus A330-200', 'Airbus A330-300',
        'Airbus A340-200', 'Airbus A340-300',
        'Airbus A350-900', 'Airbus A350-1000',
        'Airbus A380',
        // Regional Jets above 50T
        'McDonnell Douglas MD-80', 'McDonnell Douglas MD-90',
        'Embraer E-Jet E190', 'Embraer E-Jet E195',
        'British Aerospace BAe 146', 'Avro RJ70', 'Avro RJ85', 'Avro RJ100',
        // Business Jets above 50T
        'Gulfstream G550', 'Gulfstream G600', 'Gulfstream G650', 'Gulfstream G700',
        'Bombardier Global 5000', 'Bombardier Global 5500', 'Bombardier Global 6000', 
        'Bombardier Global 6500', 'Bombardier Global 7500',
        'Dassault Falcon 2000', 'Dassault Falcon 2000EX', 'Dassault Falcon 2000LX',
        'Dassault Falcon 7X', 'Dassault Falcon 8X', 'Dassault Falcon 900',
        'Cessna Citation Longitude', 'Embraer Lineage 1000',
        // Cargo Aircraft
        'Boeing 747-400F Freighter', 'Boeing 767-300F Freighter',
        'Boeing 777F Freighter', 'Airbus A330-200F Freighter',
        'McDonnell Douglas MD-11F',
        // Military & Special Aircraft above 50T
        'Lockheed C-130 Hercules', 'Boeing KC-135 Stratotanker', 'Airbus A400M Atlas',
        'Boeing E-3 AWACS', 'Lockheed P-3 Orion', 'Boeing P-8 Poseidon',
        // Vintage & Classic Aircraft above 50T
        'Douglas DC-3', 'Boeing 727', 'McDonnell Douglas DC-9',
        'Lockheed L-1011 TriStar', 'Sud Aviation Caravelle', 'BAC One-Eleven',
        'Fokker F28', 'Fokker 100'
      ];
      return heavyJets.includes(aircraftType);
    }
    
    // Validation function to check if all "Other" fields are properly filled
    function validateOtherFields(){
      const sections = sectionsWrap.querySelectorAll('.section');
      let isValid = true;
      
      // Clear previous validation styling
      sections.forEach(section => {
        const notesField = section.querySelector('.ac-notes');
        if(notesField) notesField.classList.remove('required-empty');
      });
      
      for(let section of sections){
        const aircraftSelect = section.querySelector('.ac-type');
        const notesField = section.querySelector('.ac-notes');
        if(aircraftSelect && aircraftSelect.value === 'Other - Specify in Notes'){
          if(!notesField || !notesField.value.trim()){
            const sectionTitle = section.querySelector('.section-title h3').textContent;
            if(notesField) {
              notesField.classList.add('required-empty');
              if(isValid) notesField.focus(); // Focus on first invalid field
            }
            if(isValid) alert(`Please specify the aircraft type in the notes field for ${sectionTitle}`);
            isValid = false;
          }
        }
      }
      return isValid;
    }

    // Function to collect all form data
    function collectFormData() {
      const formData = {
        // Personal information
        pilotName: document.getElementById('pilotName')?.value || '',
        designation: document.getElementById('designation')?.value || '',
        dateOfJoining: document.getElementById('doj')?.value || '',
        
        // Signature data
        signatureDate: document.getElementById('sigDate')?.value || '',
        
        // Aircraft sections data
        aircraftSections: []
      };

      // Collect data from all aircraft sections
      const sections = document.querySelectorAll('.section[data-section-id]');
      sections.forEach(section => {
        const aircraftType = section.querySelector('.ac-type')?.value || '';
        const sectionData = {
          aircraftType: aircraftType,
          flightData: {}
        };

        // Collect all input data from the section
        const inputs = section.querySelectorAll('input[type="text"]');
        inputs.forEach(input => {
          if (input.value.trim()) {
            const label = input.closest('td')?.getAttribute('data-label') || input.placeholder || '';
            sectionData.flightData[label] = input.value;
          }
        });

        if (aircraftType || Object.keys(sectionData.flightData).length > 0) {
          formData.aircraftSections.push(sectionData);
        }
      });

      return formData;
    }

    // Function to submit form data
    async function submitForm(formData) {
      const submitButton = document.getElementById('btnSubmit');
      const originalText = submitButton.innerHTML;
      
      try {
        // Show loading state
        submitButton.innerHTML = '⏳ Submitting...';
        submitButton.disabled = true;

        const response = await fetch('/api/submit-form', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        const result = await response.json();

        if (result.success) {
          alert('Form submitted successfully! Thank you for your submission.');
        } else {
          throw new Error(result.message || 'Failed to submit form');
        }
      } catch (error) {
        console.error('Submit error:', error);
        alert('Error submitting form: ' + error.message + '\nPlease try again or contact support.');
      } finally {
        // Restore button state
        submitButton.innerHTML = originalText;
        submitButton.disabled = false;
      }
    }

    document.addEventListener('click', (e)=>{
      const t = e.target;
      if(t.matches('#btnAddSection')){
        // Validate before adding new section
        if(!validateOtherFields()) return;
        const count = sectionsWrap.querySelectorAll('.section').length + 1;
        sectionsWrap.appendChild(makeAircraftSection({label:`Aircraft Type ${count}`, typeText:'', locked:false}));
        computeAll();
      }
      if(t.closest('[data-remove-section]')){
        const sec = t.closest('.section');
        if(sec && sec.dataset.locked !== '1'){ sec.remove(); computeAll(); }
      }
      if(t.matches('#btnReset')){
        if(confirm('Clear all fields?')) location.reload();
      }
      if(t.matches('#btnSubmit')){
        // Validate before submitting
        if(!validateOtherFields()) return;
        
        // Collect form data
        const formData = collectFormData();
        
        // Submit form
        submitForm(formData);
      }
    });

    document.addEventListener('input', (e)=>{
      const t = e.target;
      if(t.classList.contains('hhmm')){ computeAll(); }
      if(t.classList.contains('date-inp')){ const span = t.closest('.date-cell').querySelector('.date-print'); span.textContent = toDDMMMYYYY(t.value); }
      if(t.id === 'pilotName'){ const typed = document.getElementById('typedSig'); if(typed && !typed.value) typed.value = t.value; }
      // Show/hide notes field and heavy jet indicator based on aircraft type selection
      if(t.classList.contains('ac-type')){
        const section = t.closest('.section');
        const notesField = section.querySelector('.notes-field');
        const heavyJetIndicator = section.querySelector('.heavy-jet-indicator');
        
        // Handle notes field
        if(notesField){
          if(t.value === 'Other - Specify in Notes'){
            notesField.style.display = 'block';
          } else {
            notesField.style.display = 'none';
            // Clear the notes field when hiding
            const textarea = notesField.querySelector('.ac-notes');
            if(textarea) {
              textarea.value = '';
              textarea.classList.remove('required-empty');
            }
          }
        }
        
        // Handle heavy jet indicator
        if(heavyJetIndicator){
          if(isHeavyJet(t.value)){
            heavyJetIndicator.style.display = 'flex';
          } else {
            heavyJetIndicator.style.display = 'none';
          }
        }
      }
      // Clear validation styling when user types in notes field
      if(t.classList.contains('ac-notes')){
        t.classList.remove('required-empty');
      }
    });

    document.addEventListener('blur', (e)=>{
      const t = e.target;
      if(t.classList && t.classList.contains('hhmm')){ padHHMM(t); computeAll(); }
      if(t.classList && t.classList.contains('date-inp')){ const span = t.closest('.date-cell').querySelector('.date-print'); span.textContent = toDDMMMYYYY(t.value); }
    }, true);

    function computeAll(){
      let gtCombined = 0, gtMP = 0, gtNight = 0;
      sectionsWrap.querySelectorAll('.section').forEach(sec=>{
        let combined = 0;
        sec.querySelectorAll('input.totHours').forEach(inp=> combined += parseHHMM(inp.value));
        const combinedEl = sec.querySelector('.combined');
        if(combinedEl) combinedEl.textContent = toHHMM(combined);
        gtCombined += combined;
        sec.querySelectorAll('input.mp').forEach(inp=> gtMP += parseHHMM(inp.value));
        sec.querySelectorAll('input.night').forEach(inp=> gtNight += parseHHMM(inp.value));
      });
      document.getElementById('gtCombined').textContent = toHHMM(gtCombined);
      document.getElementById('gtMP').textContent = toHHMM(gtMP);
      document.getElementById('gtNight').textContent = toHHMM(gtNight);
    }

    // ===== Signature pad logic (draw / typed / upload) =====
    (function initSignature(){
      const canvas = document.getElementById('sigCanvas');
      if(!canvas) return; const ctx = canvas.getContext('2d');
      function setupCanvas(){
        const ratio = Math.max(window.devicePixelRatio || 1, 1);
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * ratio; canvas.height = 160 * ratio;
        ctx.setTransform(ratio,0,0,ratio,0,0); ctx.lineWidth = 2; ctx.lineJoin='round'; ctx.lineCap='round'; ctx.strokeStyle = '#111827';
      }
      function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); }
      function pos(e){ const r=canvas.getBoundingClientRect(); const p=e.touches? e.touches[0]: e; return {x:p.clientX - r.left, y:p.clientY - r.top}; }
      let drawing=false, lastX=0, lastY=0;
      function start(e){ drawing=true; const p=pos(e); lastX=p.x; lastY=p.y; e.preventDefault(); }
      function move(e){ if(!drawing) return; const p=pos(e); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(p.x,p.y); ctx.stroke(); lastX=p.x; lastY=p.y; e.preventDefault(); }
      function end(){ drawing=false; }
      setupCanvas(); window.addEventListener('resize', setupCanvas);
      canvas.addEventListener('mousedown', start); canvas.addEventListener('mousemove', move); window.addEventListener('mouseup', end);
      canvas.addEventListener('touchstart', start, {passive:false}); canvas.addEventListener('touchmove', move, {passive:false}); window.addEventListener('touchend', end);

      document.getElementById('sigClear').addEventListener('click', clearCanvas);
      document.getElementById('sigApply').addEventListener('click', ()=>{
        const txt = (document.getElementById('typedSig').value || '').trim(); if(!txt) return;
        clearCanvas();
        ctx.font = '36px cursive'; ctx.fillStyle = '#111827';
        const metrics = ctx.measureText(txt); const cssW = canvas.getBoundingClientRect().width; const x = Math.max(10, (cssW - metrics.width)/2 );
        ctx.fillText(txt, x, 110);
      });
      document.getElementById('sigUpload').addEventListener('change', (ev)=>{
        const file = ev.target.files && ev.target.files[0]; if(!file) return;
        const img = new Image(); img.onload = ()=>{
          clearCanvas();
          const cssW = canvas.getBoundingClientRect().width, cssH = 160; 
          const scale = Math.min(cssW*0.9 / img.width, cssH*0.9 / img.height);
          const w = img.width * scale, h = img.height * scale; const x = (cssW - w)/2, y = (cssH - h)/2;
          ctx.drawImage(img, x, y, w, h);
        }; img.src = URL.createObjectURL(file);
      });
    })();

    // Init
    (function(){ computeAll(); })();
  </script>
</body>
</html>
