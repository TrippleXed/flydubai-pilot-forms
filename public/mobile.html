<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>flydubai Flight Operations - Fleet</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root{ 
      /* flydubai Official Brand Colors */
      --bg: linear-gradient(135deg, #6d28d9 0%, #7c3aed 12%, #8b5cf6 25%, #a855f7 37%, #c084fc 50%, #6366f1 62%, #8b5cf6 75%, #9333ea 87%, #7c3aed 100%);
      --card: #ffffff; 
      --ink: #0f172a; 
      --muted: #64748b; 
      --accent: #3b82f6; 
      --accent-light: #60a5fa;
      --line: #e2e8f0; 
      --flydubai-blue: #3b82f6;
      --flydubai-orange: #f97316;
      --flydubai-navy: #1e3a8a;
      --flydubai-light-blue: #dbeafe;
      --aviation-silver: #94a3b8;
      --success: #059669;
      --warning: #d97706;
      --expired: #dc2626;
      --shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.15);
      --shadow-lg: 0 15px 35px -10px rgba(0, 0, 0, 0.2);
    }
    
    * { 
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      scroll-behavior: smooth;
      overflow-x: hidden;
      width: 100%;
    }
    
    body {
      background: var(--bg);
      background-attachment: fixed;
      background-size: 100% 100vh;
      color: var(--ink);
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      font-weight: 400;
      min-height: 100vh;
      width: 100vw;
      max-width: 100vw;
    }

    /* Initially hide all content until password is verified */
    .content-container {
      display: none;
    }
    
    .password-protecting {
      display: block;
    }
    
    .container {
      width: 100vw;
      max-width: 100vw;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      margin: 0;
      width: 100%;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 50%, var(--flydubai-blue) 100%);
    }
    
    /* Mobile Header */
    .header {
      padding: 8px 12px;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 30%, #f8fafc 70%, #f1f5f9 100%);
      min-height: 60px;
      width: 100%;
    }
    
    .header-center {
      flex: 1;
      text-align: center;
    }
    
    .header .logo {
      width: 80px;
      height: 35px;
      background-image: url('Flydubai-Logo.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: left center;
      flex-shrink: 0;
    }
    
    .fof-logo {
      width: 80px;
      height: 35px;
      background-image: url('FOF LOGO ICON.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: right center;
      flex-shrink: 0;
    }
    
    .header h1 {
      font-size: 14px;
      font-weight: 700;
      color: var(--flydubai-navy);
      margin: 0;
      line-height: 1.2;
      text-align: center;
      flex: 1;
    }
    
    /* Mobile Progress */
    .progress-container {
      padding: 8px 12px;
      background: var(--card);
      border-bottom: 1px solid var(--line);
      width: 100%;
    }
    
    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e2e8f0;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 8px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 100%);
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .progress-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 10px;
      font-weight: 500;
      gap: 4px;
    }
    
    .step {
      display: flex;
      align-items: center;
      color: var(--muted);
    }
    
    .step.active {
      color: var(--flydubai-blue);
    }
    
    .step.completed {
      color: var(--success);
    }
    
    .step-number {
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 8px;
      font-weight: 700;
      color: white;
      background: var(--muted);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      margin-right: 4px;
    }
    
    .step.active .step-number {
      background: var(--flydubai-blue);
    }
    
    .step.completed .step-number {
      background: var(--success);
    }
    
    /* Mobile Form Steps */
    .form-step {
      padding: 15px 12px;
      padding-bottom: 5px;
      width: 100%;
      display: none;
      animation: fadeIn 0.3s ease;
    }
    
    .form-step.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .step-title {
      font-size: 18px;
      font-weight: 700;
      color: var(--flydubai-navy);
      margin-bottom: 8px;
    }
    
    .step-subtitle {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 20px;
    }
    
    /* Mobile Form Sections */
    .form-section {
      margin-bottom: 20px;
      width: 100%;
      border: 2px solid var(--line);
      border-radius: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .form-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 100%);
    }
    
    .section {
      margin-bottom: 20px;
      width: 100%;
      border: 2px solid var(--line);
      border-radius: 16px;
      padding: 20px;
      background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 100%);
    }
    
    .section-title, .section-h {
      font-size: 16px;
      font-weight: 600;
      color: var(--flydubai-navy);
      margin-bottom: 15px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--line);
    }
    
    /* Mobile Form Grid - Always Single Column */
    .form-grid, .grid {
      display: flex;
      flex-direction: column;
      gap: 15px;
      width: 100%;
    }
    
    /* Mobile Form Groups */
    .form-group {
      width: 100%;
      margin-bottom: 15px;
    }
    
    .form-group label, label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--ink);
      font-size: 13px;
    }
    
    .required::after {
      content: ' *';
      color: var(--expired);
    }
    
    /* Mobile Form Inputs */
    .form-input, .form-select, input, select, textarea {
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      border: 1px solid var(--line);
      background: var(--card);
      color: var(--ink);
      font-family: inherit;
      font-size: 14px;
      transition: all 0.2s ease;
      box-sizing: border-box;
    }
    
    .form-input:focus, .form-select:focus, input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--flydubai-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    /* Mobile Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
      font-weight: 500;
      font-size: 14px;
      padding: 12px 20px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      min-height: 44px;
      width: 100%;
      margin: 5px 0;
    }
    
    .btn.primary {
      background: linear-gradient(135deg, var(--flydubai-blue) 0%, var(--accent-light) 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
    }
    
    .btn.secondary {
      background: var(--card);
      color: var(--ink);
      border: 1px solid var(--line);
    }
    
    .btn:hover {
      transform: translateY(-2px);
    }
    
    /* Mobile Navigation */
    .form-navigation {
      padding: 15px 12px;
      padding-bottom: max(80px, env(safe-area-inset-bottom, 80px));
      background: var(--card);
      border-top: 1px solid var(--line);
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      margin-top: 20px;
    }
    
    .nav-left, .nav-right {
      width: 100%;
    }
    
    /* Mobile Upload Areas */
    .upload-area {
      border: 2px dashed var(--line);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      background: #fafafa;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 10px 0;
      width: 100%;
    }
    
    .upload-area:hover {
      border-color: var(--flydubai-blue);
      background: rgba(59, 130, 246, 0.05);
    }
    
    /* Mobile Aircraft Sections */
    .aircraft-type-section, .section {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 15px;
      margin-bottom: 15px;
      width: 100%;
    }
    
    .aircraft-type-section .form-grid {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .heavy-jet-indicator {
      display: flex;
      align-items: center;
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);
      margin: 8px 0;
      width: fit-content;
    }

    /* Time input styling */
    .hhmm {
      width: 80px !important;
      padding: 8px !important;
      font-family: 'Courier New', monospace !important;
      text-align: center;
      font-weight: 600;
      border: 2px solid var(--line) !important;
    }

    .hhmm:focus {
      border-color: var(--flydubai-blue) !important;
    }
    
    /* Mobile Tables - Convert to vertical cards */
    .table-mobile {
      display: block;
      width: 100%;
    }
    
    .table-mobile .table-row {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 10px;
      display: block;
    }
    
    .table-mobile .table-cell {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .table-mobile .table-cell:last-child {
      border-bottom: none;
    }
    
    .table-mobile .table-label {
      font-weight: 600;
      color: var(--flydubai-navy);
      flex: 1;
    }
    
    .table-mobile .table-value {
      flex: 1;
      text-align: right;
    }

    /* Regular tables for summary */
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
      font-size: 12px;
    }
    
    table th, table td {
      padding: 8px 4px;
      text-align: center;
      border: 1px solid var(--line);
      vertical-align: middle;
    }
    
    table th {
      background: var(--flydubai-light-blue);
      font-weight: 600;
      color: var(--flydubai-navy);
      font-size: 10px;
    }
    
    /* Mobile Signature Section */
    #signSection .form-grid {
      display: flex;
      flex-direction: column;
      gap: 15px;
      align-items: stretch;
    }
    
    #signSection input, #signSection button, #signSection label {
      width: 100%;
      margin: 5px 0;
    }
    
    .signature-canvas, #sigCanvas {
      width: 100%;
      height: 150px;
      border: 2px solid var(--line);
      border-radius: 8px;
      background: white;
      touch-action: none;
    }
    
    /* Mobile Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      z-index: 1000;
      padding: 20px;
    }
    
    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 20px;
      width: 100%;
      max-height: 80vh;
      overflow-y: auto;
      position: relative;
      top: 50%;
      transform: translateY(-50%);
    }
    
    .close {
      position: absolute;
      right: 15px;
      top: 15px;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      color: var(--muted);
    }

    /* Status indicators */
    .status-valid {
      color: var(--success);
      font-weight: 600;
    }
    
    .status-warning {
      color: var(--warning);
      font-weight: 600;
    }
    
    .status-expired {
      color: var(--expired);
      font-weight: 600;
    }

    .requirement-note {
      background: #f8fafc;
      padding: 12px;
      border-radius: 8px;
      border-left: 4px solid var(--flydubai-blue);
      margin-top: 10px;
      font-size: 12px;
      color: var(--muted);
    }

    .file-restoration-indicator {
      margin-top: 8px;
      padding: 8px 12px;
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 6px;
      font-size: 12px;
      color: #856404;
    }

    .date-print {
      font-size: 12px;
      color: var(--muted);
      margin-top: 4px;
    }

    .kpi {
      margin: 5px 0;
      font-size: 13px;
    }

    .grand {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .controls {
      text-align: center;
      margin: 20px 0;
    }

    .summary {
      margin-top: 30px;
    }

    .no-print {
      /* Mobile doesn't need this but keeping for compatibility */
    }
    
    /* Hide elements not needed on mobile */
    .desktop-only {
      display: none !important;
    }
    
    /* Ensure no horizontal scrolling */
    * {
      max-width: 100vw;
    }
    
    /* Loading States */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--flydubai-blue);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Auto-save status */
    #autoSaveStatus {
      position: fixed;
      top: 10px;
      right: 10px;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 12px;
      z-index: 1000;
      display: none;
    }

    /* Recovery banner */
    #recoveryBanner {
      background: linear-gradient(135deg, #ecfdf5 0%, #f0fdf4 100%);
      border: 1px solid #a7f3d0;
      border-radius: 12px;
      padding: 16px;
      margin: 10px;
      display: none;
    }

    #recoveryBanner.show {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Auto-save status indicator -->
  <div id="autoSaveStatus"></div>

  <!-- Redirect message for desktop users -->
  <script>
    // If screen is large, redirect to desktop version
    if (window.innerWidth >= 768) {
      window.location.href = 'index.html';
    }
  </script>
  
  <!-- Session Recovery Banner -->
  <div id="recoveryBanner">
    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
      <div style="font-size: 20px;">💾</div>
      <div>
        <div style="font-weight: 600; color: var(--success);">Previous Session Found</div>
        <div style="font-size: 12px; color: var(--muted);">We found your previous form data. Would you like to restore it?</div>
      </div>
    </div>
    <div style="display: flex; gap: 12px;">
      <button onclick="recoverSession()" style="flex: 1; padding: 8px 16px; background: var(--success); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer;">
        Restore Session
      </button>
      <button onclick="clearSession()" style="flex: 1; padding: 8px 16px; background: var(--card); color: var(--ink); border: 1px solid var(--line); border-radius: 8px; font-weight: 500; cursor: pointer;">
        Start Fresh
      </button>
    </div>
  </div>

  <div class="container content-container">
    <div class="card">
      <!-- Mobile Header -->
      <div class="header">
        <div class="logo"></div>
        <div class="header-center">
          <h1>Flight Operations - Fleet</h1>
        </div>
        <div class="fof-logo"></div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-steps">
          <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <span>Personal</span>
          </div>
          <div class="step" data-step="2">
            <div class="step-number">2</div>
            <span>Flight Experience</span>
          </div>
          <div class="step" data-step="3">
            <div class="step-number">3</div>
            <span>Documents</span>
          </div>
          <div class="step" data-step="4">
            <div class="step-number">4</div>
            <span>Review</span>
          </div>
        </div>
      </div>

      <!-- Step 1: Personal Information -->
      <div class="form-step active" data-step="1">
        <h2 class="step-title">👨‍✈️ Personal Information</h2>
        <p class="step-subtitle">Let's start with your basic information. All fields marked with <span class="required">*</span> are required.</p>
        
        <div class="form-section">
          <div class="section-title">Basic Information</div>
          <div class="form-grid">
            <div class="form-group">
              <label for="pilotName" class="required">Full Name</label>
              <input type="text" id="pilotName" class="form-input" placeholder="Enter your full name" required />
            </div>
            <div class="form-group">
              <label for="designation" class="required">flydubai Designation</label>
              <select id="designation" class="form-select" required>
                <option value="">Select…</option>
                <option>Captain</option>
                <option>First Officer</option>
                <option>Second Officer</option>
                <option>Cadet</option>
                <option>Ab-Initio</option>
              </select>
            </div>
            <div class="form-group">
              <label for="dateOfBirth" class="required">Date of Birth</label>
              <input type="date" id="dateOfBirth" class="form-input" required />
            </div>
            <div class="form-group">
              <label for="nationality" class="required">Nationality</label>
              <select id="nationality" class="form-select" required>
                <option value="">Select your nationality</option>
                <option value="AF">Afghanistan</option>
                <option value="AL">Albania</option>
                <option value="DZ">Algeria</option>
                <option value="AS">American Samoa</option>
                <option value="AD">Andorra</option>
                <option value="AO">Angola</option>
                <option value="AI">Anguilla</option>
                <option value="AQ">Antarctica</option>
                <option value="AG">Antigua and Barbuda</option>
                <option value="AR">Argentina</option>
                <option value="AM">Armenia</option>
                <option value="AW">Aruba</option>
                <option value="AU">Australia</option>
                <option value="AT">Austria</option>
                <option value="AZ">Azerbaijan</option>
                <option value="BS">Bahamas</option>
                <option value="BH">Bahrain</option>
                <option value="BD">Bangladesh</option>
                <option value="BB">Barbados</option>
                <option value="BY">Belarus</option>
                <option value="BE">Belgium</option>
                <option value="BZ">Belize</option>
                <option value="BJ">Benin</option>
                <option value="BM">Bermuda</option>
                <option value="BT">Bhutan</option>
                <option value="BO">Bolivia</option>
                <option value="BA">Bosnia and Herzegovina</option>
                <option value="BW">Botswana</option>
                <option value="BV">Bouvet Island</option>
                <option value="BR">Brazil</option>
                <option value="IO">British Indian Ocean Territory</option>
                <option value="BN">Brunei Darussalam</option>
                <option value="BG">Bulgaria</option>
                <option value="BF">Burkina Faso</option>
                <option value="BI">Burundi</option>
                <option value="KH">Cambodia</option>
                <option value="CM">Cameroon</option>
                <option value="CA">Canada</option>
                <option value="CV">Cape Verde</option>
                <option value="KY">Cayman Islands</option>
                <option value="CF">Central African Republic</option>
                <option value="TD">Chad</option>
                <option value="CL">Chile</option>
                <option value="CN">China</option>
                <option value="CX">Christmas Island</option>
                <option value="CC">Cocos (Keeling) Islands</option>
                <option value="CO">Colombia</option>
                <option value="KM">Comoros</option>
                <option value="CG">Congo</option>
                <option value="CD">Congo, Democratic Republic</option>
                <option value="CK">Cook Islands</option>
                <option value="CR">Costa Rica</option>
                <option value="CI">Cote D'Ivoire</option>
                <option value="HR">Croatia</option>
                <option value="CU">Cuba</option>
                <option value="CY">Cyprus</option>
                <option value="CZ">Czech Republic</option>
                <option value="DK">Denmark</option>
                <option value="DJ">Djibouti</option>
                <option value="DM">Dominica</option>
                <option value="DO">Dominican Republic</option>
                <option value="EC">Ecuador</option>
                <option value="EG">Egypt</option>
                <option value="SV">El Salvador</option>
                <option value="GQ">Equatorial Guinea</option>
                <option value="ER">Eritrea</option>
                <option value="EE">Estonia</option>
                <option value="ET">Ethiopia</option>
                <option value="FK">Falkland Islands (Malvinas)</option>
                <option value="FO">Faroe Islands</option>
                <option value="FJ">Fiji</option>
                <option value="FI">Finland</option>
                <option value="FR">France</option>
                <option value="GF">French Guiana</option>
                <option value="PF">French Polynesia</option>
                <option value="TF">French Southern Territories</option>
                <option value="GA">Gabon</option>
                <option value="GM">Gambia</option>
                <option value="GE">Georgia</option>
                <option value="DE">Germany</option>
                <option value="GH">Ghana</option>
                <option value="GI">Gibraltar</option>
                <option value="GR">Greece</option>
                <option value="GL">Greenland</option>
                <option value="GD">Grenada</option>
                <option value="GP">Guadeloupe</option>
                <option value="GU">Guam</option>
                <option value="GT">Guatemala</option>
                <option value="GN">Guinea</option>
                <option value="GW">Guinea-Bissau</option>
                <option value="GY">Guyana</option>
                <option value="HT">Haiti</option>
                <option value="HM">Heard Island & Mcdonald Islands</option>
                <option value="VA">Holy See (Vatican City State)</option>
                <option value="HN">Honduras</option>
                <option value="HK">Hong Kong</option>
                <option value="HU">Hungary</option>
                <option value="IS">Iceland</option>
                <option value="IN">India</option>
                <option value="ID">Indonesia</option>
                <option value="IR">Iran, Islamic Republic Of</option>
                <option value="IQ">Iraq</option>
                <option value="IE">Ireland</option>
                <option value="IL">Israel</option>
                <option value="IT">Italy</option>
                <option value="JM">Jamaica</option>
                <option value="JP">Japan</option>
                <option value="JO">Jordan</option>
                <option value="KZ">Kazakhstan</option>
                <option value="KE">Kenya</option>
                <option value="KI">Kiribati</option>
                <option value="KR">Korea</option>
                <option value="KW">Kuwait</option>
                <option value="KG">Kyrgyzstan</option>
                <option value="LA">Lao People's Democratic Republic</option>
                <option value="LV">Latvia</option>
                <option value="LB">Lebanon</option>
                <option value="LS">Lesotho</option>
                <option value="LR">Liberia</option>
                <option value="LY">Libyan Arab Jamahiriya</option>
                <option value="LI">Liechtenstein</option>
                <option value="LT">Lithuania</option>
                <option value="LU">Luxembourg</option>
                <option value="MO">Macao</option>
                <option value="MK">Macedonia</option>
                <option value="MG">Madagascar</option>
                <option value="MW">Malawi</option>
                <option value="MY">Malaysia</option>
                <option value="MV">Maldives</option>
                <option value="ML">Mali</option>
                <option value="MT">Malta</option>
                <option value="MH">Marshall Islands</option>
                <option value="MQ">Martinique</option>
                <option value="MR">Mauritania</option>
                <option value="MU">Mauritius</option>
                <option value="YT">Mayotte</option>
                <option value="MX">Mexico</option>
                <option value="FM">Micronesia, Federated States Of</option>
                <option value="MD">Moldova</option>
                <option value="MC">Monaco</option>
                <option value="MN">Mongolia</option>
                <option value="MS">Montserrat</option>
                <option value="MA">Morocco</option>
                <option value="MZ">Mozambique</option>
                <option value="MM">Myanmar</option>
                <option value="NA">Namibia</option>
                <option value="NR">Nauru</option>
                <option value="NP">Nepal</option>
                <option value="NL">Netherlands</option>
                <option value="AN">Netherlands Antilles</option>
                <option value="NC">New Caledonia</option>
                <option value="NZ">New Zealand</option>
                <option value="NI">Nicaragua</option>
                <option value="NE">Niger</option>
                <option value="NG">Nigeria</option>
                <option value="NU">Niue</option>
                <option value="NF">Norfolk Island</option>
                <option value="MP">Northern Mariana Islands</option>
                <option value="NO">Norway</option>
                <option value="OM">Oman</option>
                <option value="PK">Pakistan</option>
                <option value="PW">Palau</option>
                <option value="PS">Palestinian Territory, Occupied</option>
                <option value="PA">Panama</option>
                <option value="PG">Papua New Guinea</option>
                <option value="PY">Paraguay</option>
                <option value="PE">Peru</option>
                <option value="PH">Philippines</option>
                <option value="PN">Pitcairn</option>
                <option value="PL">Poland</option>
                <option value="PT">Portugal</option>
                <option value="PR">Puerto Rico</option>
                <option value="QA">Qatar</option>
                <option value="RE">Reunion</option>
                <option value="RO">Romania</option>
                <option value="RU">Russian Federation</option>
                <option value="RW">Rwanda</option>
                <option value="SH">Saint Helena</option>
                <option value="KN">Saint Kitts And Nevis</option>
                <option value="LC">Saint Lucia</option>
                <option value="PM">Saint Pierre And Miquelon</option>
                <option value="VC">Saint Vincent And Grenadines</option>
                <option value="WS">Samoa</option>
                <option value="SM">San Marino</option>
                <option value="ST">Sao Tome And Principe</option>
                <option value="SA">Saudi Arabia</option>
                <option value="SN">Senegal</option>
                <option value="CS">Serbia And Montenegro</option>
                <option value="SC">Seychelles</option>
                <option value="SL">Sierra Leone</option>
                <option value="SG">Singapore</option>
                <option value="SK">Slovakia</option>
                <option value="SI">Slovenia</option>
                <option value="SB">Solomon Islands</option>
                <option value="SO">Somalia</option>
                <option value="ZA">South Africa</option>
                <option value="GS">South Georgia And Sandwich Isl.</option>
                <option value="ES">Spain</option>
                <option value="LK">Sri Lanka</option>
                <option value="SD">Sudan</option>
                <option value="SR">Suriname</option>
                <option value="SJ">Svalbard And Jan Mayen</option>
                <option value="SZ">Swaziland</option>
                <option value="SE">Sweden</option>
                <option value="CH">Switzerland</option>
                <option value="SY">Syrian Arab Republic</option>
                <option value="TW">Taiwan</option>
                <option value="TJ">Tajikistan</option>
                <option value="TZ">Tanzania</option>
                <option value="TH">Thailand</option>
                <option value="TL">Timor-Leste</option>
                <option value="TG">Togo</option>
                <option value="TK">Tokelau</option>
                <option value="TO">Tonga</option>
                <option value="TT">Trinidad And Tobago</option>
                <option value="TN">Tunisia</option>
                <option value="TR">Turkey</option>
                <option value="TM">Turkmenistan</option>
                <option value="TC">Turks And Caicos Islands</option>
                <option value="TV">Tuvalu</option>
                <option value="UG">Uganda</option>
                <option value="UA">Ukraine</option>
                <option value="AE">United Arab Emirates</option>
                <option value="GB">United Kingdom</option>
                <option value="US">United States</option>
                <option value="UM">United States Outlying Islands</option>
                <option value="UY">Uruguay</option>
                <option value="UZ">Uzbekistan</option>
                <option value="VU">Vanuatu</option>
                <option value="VE">Venezuela</option>
                <option value="VN">Viet Nam</option>
                <option value="VG">Virgin Islands, British</option>
                <option value="VI">Virgin Islands, U.S.</option>
                <option value="WF">Wallis And Futuna</option>
                <option value="EH">Western Sahara</option>
                <option value="YE">Yemen</option>
                <option value="ZM">Zambia</option>
                <option value="ZW">Zimbabwe</option>
              </select>
            </div>
            <div class="form-group">
              <label for="contactEmail" class="required">Email Address</label>
              <input type="email" id="contactEmail" class="form-input" placeholder="your.email@example.com" 
                     pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" 
                     title="Please enter a valid email address (e.g., name@example.com)" 
                     required />
            </div>
            <div class="form-group">
              <label for="doj" class="required">Date of Joining</label>
              <input type="date" id="doj" class="form-input" required />
            </div>
            <div class="form-group">
              <label for="countryCode" class="required">Country Code</label>
              <select id="countryCode" class="form-select" required>
                <option value="">Select Code</option>
                <option value="+971">🇦🇪 +971 UAE</option>
                <option value="+1">🇺🇸 +1 USA</option>
                <option value="+44">🇬🇧 +44 UK</option>
                <option value="+1">🇨🇦 +1 Canada</option>
                <option value="+61">🇦🇺 +61 Australia</option>
                <option value="+49">🇩🇪 +49 Germany</option>
                <option value="+33">🇫🇷 +33 France</option>
                <option value="+34">🇪🇸 +34 Spain</option>
                <option value="+39">🇮🇹 +39 Italy</option>
                <option value="+31">🇳🇱 +31 Netherlands</option>
                <option value="+46">🇸🇪 +46 Sweden</option>
                <option value="+47">🇳🇴 +47 Norway</option>
                <option value="+45">🇩🇰 +45 Denmark</option>
                <option value="+358">🇫🇮 +358 Finland</option>
                <option value="+41">🇨🇭 +41 Switzerland</option>
                <option value="+43">🇦🇹 +43 Austria</option>
                <option value="+32">🇧🇪 +32 Belgium</option>
                <option value="+353">🇮🇪 +353 Ireland</option>
                <option value="+351">🇵🇹 +351 Portugal</option>
                <option value="+30">🇬🇷 +30 Greece</option>
                <option value="+966">🇸🇦 +966 Saudi Arabia</option>
                <option value="+974">🇶🇦 +974 Qatar</option>
                <option value="+965">🇰🇼 +965 Kuwait</option>
                <option value="+973">🇧🇭 +973 Bahrain</option>
                <option value="+968">🇴🇲 +968 Oman</option>
                <option value="+20">🇪🇬 +20 Egypt</option>
                <option value="+962">🇯🇴 +962 Jordan</option>
                <option value="+961">🇱🇧 +961 Lebanon</option>
                <option value="+963">🇸🇾 +963 Syria</option>
                <option value="+964">🇮🇶 +964 Iraq</option>
                <option value="+91">🇮🇳 +91 India</option>
                <option value="+92">🇵🇰 +92 Pakistan</option>
                <option value="+880">🇧🇩 +880 Bangladesh</option>
                <option value="+94">🇱🇰 +94 Sri Lanka</option>
                <option value="+63">🇵🇭 +63 Philippines</option>
                <option value="+62">🇮🇩 +62 Indonesia</option>
                <option value="+60">🇲🇾 +60 Malaysia</option>
                <option value="+65">🇸🇬 +65 Singapore</option>
                <option value="+66">🇹🇭 +66 Thailand</option>
                <option value="+84">🇻🇳 +84 Vietnam</option>
                <option value="+86">🇨🇳 +86 China</option>
                <option value="+81">🇯🇵 +81 Japan</option>
                <option value="+82">🇰🇷 +82 South Korea</option>
                <option value="+27">🇿🇦 +27 South Africa</option>
                <option value="+234">🇳🇬 +234 Nigeria</option>
                <option value="+254">🇰🇪 +254 Kenya</option>
                <option value="+251">🇪🇹 +251 Ethiopia</option>
                <option value="+233">🇬🇭 +233 Ghana</option>
                <option value="+212">🇲🇦 +212 Morocco</option>
                <option value="+55">🇧🇷 +55 Brazil</option>
                <option value="+54">🇦🇷 +54 Argentina</option>
                <option value="+56">🇨🇱 +56 Chile</option>
                <option value="+57">🇨🇴 +57 Colombia</option>
                <option value="+52">🇲🇽 +52 Mexico</option>
                <option value="+58">🇻🇪 +58 Venezuela</option>
                <option value="+51">🇵🇪 +51 Peru</option>
                <option value="+593">🇪🇨 +593 Ecuador</option>
                <option value="+64">🇳🇿 +64 New Zealand</option>
                <option value="+90">🇹🇷 +90 Turkey</option>
                <option value="+98">🇮🇷 +98 Iran</option>
                <option value="+972">🇮🇱 +972 Israel</option>
              </select>
            </div>
            <div class="form-group">
              <label for="phoneNumber" class="required">Phone Number</label>
              <input type="tel" id="phoneNumber" class="form-input" placeholder="50 123 4567" required />
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Flight Experience -->
      <div class="form-step" data-step="2">
        <h2 class="section-h">Flight Experience by Aircraft Type</h2>
        <div id="sections"></div>
        <div class="controls no-print">
          <button class="btn" id="btnAddSection">+ Add another aircraft type</button>
        </div>

        <!-- Grand totals for all aircraft types -->
        <div class="section" id="grandTotals">
          <div class="section-title">
            <h3>GRAND TOTALS (All Aircraft Types)</h3>
          </div>
          <div class="grand">
            <div class="kpi">Combined Block Hours: <b id="gtCombined">0:00</b></div>
            <div class="kpi">Multi‑Pilot Block Hours: <b id="gtMP">0:00</b></div>
            <div class="kpi">Night Hours: <b id="gtNight">0:00</b></div>
          </div>
        </div>

        <!-- SUMMARY SECTION -->
        <div class="summary">
          <h2 class="section-h">FLYING EXPERIENCE SUMMARY</h2>
          <h3 class="section-h" style="margin-top:6px">GENERAL</h3>
          <div class="section">
            <!-- Mobile-friendly compact row layout -->
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <!-- Row 1: PIC, SIC, SOLO -->
              <div style="display: flex; gap: 8px;">
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">PIC/P1</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">SIC/P2</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">SOLO</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
              </div>
              
              <!-- Row 2: INSTRUMENT, SIM, NIGHT -->
              <div style="display: flex; gap: 8px;">
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">INSTRUMENT</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">SIM</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">NIGHT</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
              </div>
              
              <!-- Row 3: INSTRUCTOR, P1 U/S, GRAND TOTAL -->
              <div style="display: flex; gap: 8px;">
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">INSTRUCTOR</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center;">P1 U/S</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
                <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                  <label style="font-size: 11px; font-weight: bold; margin-bottom: 4px; text-align: center; color: #1e40af;">GRAND TOTAL</label>
                  <input type="text" class="hhmm form-input" placeholder="0:00" style="text-align: center; font-size: 12px; font-weight: bold; background: #dbeafe; border: 2px solid #3b82f6; padding: 6px; width: 100%; box-sizing: border-box; margin: 0;">
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 3: Documentation -->
      <div class="form-step" data-step="3">
        <div class="form-section">
          <h2 class="section-h">🛂 Pilot License (ATPL/CPL/MPL)</h2>
          <div class="grid">
            <div>
              <label>License Type</label>
              <select id="licenseType">
                <option value="">Select License Type</option>
                <option value="ATPL">ATPL (Airline Transport Pilot License)</option>
                <option value="CPL">CPL (Commercial Pilot License)</option>
                <option value="MPL">MPL (Multi-Crew Pilot License)</option>
              </select>
            </div>
            <div>
              <label>License Number</label>
              <input type="text" id="licenseNumber" placeholder="Enter license number" />
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="licenseIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="licenseExpiry" onchange="checkValidity('license')" />
            </div>
            <div>
              <label>Upload Document</label>
              <input type="file" id="licenseFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="licenseStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Current valid pilot license (ATPL/CPL/MPL) with appropriate aircraft type ratings. License must be valid for the duration of employment and recognized by UAE GCAA or convertible to UAE license.
          </div>
        </div>

      <!-- Radio Operator License Section -->
      <div class="form-section">
        <h2 class="section-h">📻 Radio Operator License</h2>
        <div class="grid">
          <div>
            <label>ROL Type</label>
            <select id="rolType" onchange="toggleROLFields()">
              <option value="">Select ROL Type</option>
              <option value="Separate Certificate">Separate ROL Certificate</option>
              <option value="Attached to License">Attached to Pilot License</option>
            </select>
          </div>
        </div>
        
        <div id="rolSeparateFields" class="conditional-section">
          <div class="grid">
            <div>
              <label>ROL Number</label>
              <input type="text" id="rolNumber" placeholder="Enter ROL certificate number">
            </div>
            <div>
              <label>Issuing Radio Authority</label>
              <select id="rolAuthority">
                <option value="">Select Radio Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction Générale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad Aérea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Aviação Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="Austrocontrol Austria">Austrocontrol (Austria)</option>
                <option value="DGTA Belgium">DGTA (Direction Générale Transport Aérien - Belgium)</option>
                <option value="CAA Denmark">CAA Denmark (Civil Aviation Authority)</option>
                <option value="CAA Finland">CAA Finland (Civil Aviation Authority)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Civil Aviation Authority)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Iceland">CAA Iceland (Civil Aviation Authority)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech Republic (Civil Aviation Authority)</option>
                <option value="CAA Slovakia">CAA Slovakia (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (Civil Aviation Authority)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Civil Aviation Authority)</option>
                <option value="CAA Romania">CAA Romania (Civil Aviation Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Authority)</option>
                <option value="CAA Greece">CAA Greece (Civil Aviation Authority)</option>
                <option value="CAA Cyprus">CAA Cyprus (Civil Aviation Authority)</option>
                <option value="CAA Malta">CAA Malta (Civil Aviation Authority)</option>
                <option value="CAA Estonia">CAA Estonia (Civil Aviation Authority)</option>
                <option value="CAA Latvia">CAA Latvia (Civil Aviation Authority)</option>
                <option value="CAA Lithuania">CAA Lithuania (Civil Aviation Authority)</option>
                
                <!-- Americas -->
                <option value="Transport Canada">Transport Canada (Civil Aviation Authority)</option>
                <option value="ANAC Brazil">ANAC (Agência Nacional de Aviação Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administración Nacional de Aviación Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Dirección General de Aeronáutica Civil - Chile)</option>
                <option value="AEROCIVIL Colombia">AEROCIVIL (Aeronáutica Civil - Colombia)</option>
                <option value="DGAC Peru">DGAC (Dirección General de Aeronáutica Civil - Peru)</option>
                <option value="DGAC Ecuador">DGAC (Dirección General de Aviación Civil - Ecuador)</option>
                <option value="INAC Venezuela">INAC (Instituto Nacional de Aeronáutica Civil - Venezuela)</option>
                <option value="DINAC Paraguay">DINAC (Dirección Nacional de Aeronáutica Civil - Paraguay)</option>
                <option value="DINACIA Uruguay">DINACIA (Dirección Nacional de Aviación Civil - Uruguay)</option>
                <option value="DGAC Bolivia">DGAC (Dirección General de Aeronáutica Civil - Bolivia)</option>
                <option value="ANAC Mexico">ANAC (Agencia Federal de Aviación Civil - Mexico)</option>
                <option value="DGAC Guatemala">DGAC (Dirección General de Aeronáutica Civil - Guatemala)</option>
                <option value="COCESNA">COCESNA (Central American Corporation for Air Navigation Services)</option>
                <option value="JAA Jamaica">JAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Ethiopia">ECAA (Ethiopian Civil Aviation Authority)</option>
                <option value="CAA Ghana">CAA Ghana (Civil Aviation Authority)</option>
                <option value="CAA Morocco">CAA Morocco (Office National des Aéroports)</option>
                <option value="CAA Algeria">CAA Algeria (Établissement National de la Navigation Aérienne)</option>
                <option value="CAA Egypt Regional">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="CAA Tunisia">CAA Tunisia (Office de l'Aviation Civile et des Aéroports)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Other/Manual Entry -->
                <option value="Other">Other Radio Authority (Specify below)</option>
              </select>
              <div id="rolAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="rolAuthorityOther" placeholder="Please specify radio authority" />
              </div>
            </div>
          </div>
          <div class="grid">
            <div>
              <label>ROL Issue Date</label>
              <input type="date" id="rolIssue">
            </div>
            <div>
              <label>ROL Expiry Date</label>
              <input type="date" id="rolExpiry" onchange="checkDocumentExpiry('ROL', this.value)">
              <div id="rolExpiryWarning" class="expiry-warning"></div>
            </div>
          </div>
          
          <div>
            <label>Upload ROL Certificate</label>
            <input type="file" id="rolFile" accept=".pdf,.jpg,.jpeg,.png" onchange="handleFileUpload(this, 'ROL Certificate')">
            <div class="upload-info">Accepted formats: PDF, JPG, PNG (Max 10MB)</div>
          </div>
        </div>
        
        <div id="rolAttachedFields" class="conditional-section">
          <div class="info-note">
            <strong>Note:</strong> Since ROL is attached to your pilot license, please ensure your pilot license document clearly shows the radio operator endorsement.
          </div>
        </div>
        
        <div class="requirement-note">
          <strong>Requirement:</strong> Valid Radio Operator License (ROL) certificate with appropriate endorsements for commercial aviation operations.
        </div>
      </div>

        <div class="form-section">
          <h2 class="section-h">🏥 Medical Certificate</h2>
          <div class="grid">
            <div>
              <label>Medical Class</label>
              <select id="medicalClass">
                <option value="">Select Medical Class</option>
                <option value="Class 1">Class 1 Medical Certificate</option>
              </select>
            </div>
            <div>
              <label>Issuing Medical Authority</label>
              <select id="medicalAuthority">
                <option value="">Select Aviation Medical Authority</option>
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="Other">Other Aviation Medical Authority (Specify below)</option>
              </select>
              <div id="medicalAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="medicalAuthorityOther" placeholder="Please specify aviation medical authority" />
              </div>
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="medicalIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="medicalExpiry" onchange="checkValidity('medical')" />
            </div>
            <div>
              <label>Upload Document</label>
              <input type="file" id="medicalFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="medicalStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid Class 1 medical certificate issued within the last 12 months. Must meet ICAO medical standards and be valid for commercial aviation operations. Class 2 medical certificates are not accepted.
          </div>
        </div>


        <div class="form-section">
          <h2 class="section-h">🌐 English Proficiency Certificate (if applicable)</h2>
          <div class="grid">
            <div>
              <label>Proficiency Level</label>
              <select id="englishLevel">
                <option value="">Select ICAO Level</option>
                <option value="Level 4">Level 4 (Operational)</option>
                <option value="Level 5">Level 5 (Extended)</option>
                <option value="Level 6">Level 6 (Expert)</option>
              </select>
            </div>
            <div>
              <label>Test Type</label>
              <select id="englishTestType" onchange="toggleEnglishTestDate()">
                <option value="">Select Test Type</option>
                <option value="ICAO English Test">ICAO English Test</option>
                <option value="Aviation English Test">Aviation English Test</option>
                <option value="TEA (Test of English for Aviation)">TEA (Test of English for Aviation)</option>
                <option value="IELTS">IELTS (Academic)</option>
                <option value="Attached to License">Attached to License (ELP Endorsement)</option>
                <option value="Other">Other Approved Test</option>
              </select>
            </div>
            <div id="englishTestDateDiv">
              <label>Test Date</label>
              <input type="date" id="englishTestDate" />
            </div>
            <div id="englishExpiryDiv">
              <label>Expiry Date</label>
              <input type="date" id="englishExpiry" onchange="checkValidity('english')" />
            </div>
            <div id="englishUploadDiv">
              <label>Upload Certificate</label>
              <input type="file" id="englishFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="englishStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> ICAO Level 4 or higher English proficiency certificate. Native English speakers may provide alternative documentation. Certificate must be current and valid for commercial aviation operations.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">📘 Passport</h2>
          <div class="grid">
            <div>
              <label>Passport Number</label>
              <input type="text" id="passportNumber" placeholder="Enter passport number" />
            </div>
            <div>
              <label>Passport Nationality</label>
              <select id="passportNationality">
                <option value="">Select Passport Nationality</option>
                <option value="American">American (USA)</option>
                <option value="British">British (UK)</option>
                <option value="Canadian">Canadian</option>
                <option value="Australian">Australian</option>
                <option value="German">German</option>
                <option value="French">French</option>
                <option value="Spanish">Spanish</option>
                <option value="Italian">Italian</option>
                <option value="Dutch">Dutch (Netherlands)</option>
                <option value="Swedish">Swedish</option>
                <option value="Norwegian">Norwegian</option>
                <option value="Danish">Danish</option>
                <option value="Finnish">Finnish</option>
                <option value="Swiss">Swiss</option>
                <option value="Austrian">Austrian</option>
                <option value="Belgian">Belgian</option>
                <option value="Irish">Irish</option>
                <option value="Portuguese">Portuguese</option>
                <option value="Greek">Greek</option>
                <option value="Emirati">Emirati (UAE)</option>
                <option value="Saudi">Saudi Arabian</option>
                <option value="Qatari">Qatari</option>
                <option value="Kuwaiti">Kuwaiti</option>
                <option value="Bahraini">Bahraini</option>
                <option value="Omani">Omani</option>
                <option value="Egyptian">Egyptian</option>
                <option value="Jordanian">Jordanian</option>
                <option value="Lebanese">Lebanese</option>
                <option value="Syrian">Syrian</option>
                <option value="Iraqi">Iraqi</option>
                <option value="Indian">Indian</option>
                <option value="Pakistani">Pakistani</option>
                <option value="Bangladeshi">Bangladeshi</option>
                <option value="Sri Lankan">Sri Lankan</option>
                <option value="Filipino">Filipino (Philippines)</option>
                <option value="Indonesian">Indonesian</option>
                <option value="Malaysian">Malaysian</option>
                <option value="Thai">Thai</option>
                <option value="Vietnamese">Vietnamese</option>
                <option value="Singaporean">Singaporean</option>
                <option value="South Korean">South Korean</option>
                <option value="Japanese">Japanese</option>
                <option value="Chinese">Chinese</option>
                <option value="Russian">Russian</option>
                <option value="Ukrainian">Ukrainian</option>
                <option value="Polish">Polish</option>
                <option value="Czech">Czech</option>
                <option value="Hungarian">Hungarian</option>
                <option value="Romanian">Romanian</option>
                <option value="Bulgarian">Bulgarian</option>
                <option value="Croatian">Croatian</option>
                <option value="Serbian">Serbian</option>
                <option value="Slovenian">Slovenian</option>
                <option value="Slovak">Slovak</option>
                <option value="South African">South African</option>
                <option value="Nigerian">Nigerian</option>
                <option value="Kenyan">Kenyan</option>
                <option value="Ethiopian">Ethiopian</option>
                <option value="Moroccan">Moroccan</option>
                <option value="Tunisian">Tunisian</option>
                <option value="Algerian">Algerian</option>
                <option value="Brazilian">Brazilian</option>
                <option value="Argentinian">Argentinian</option>
                <option value="Chilean">Chilean</option>
                <option value="Colombian">Colombian</option>
                <option value="Mexican">Mexican</option>
                <option value="Venezuelan">Venezuelan</option>
                <option value="Peruvian">Peruvian</option>
                <option value="Ecuadorian">Ecuadorian</option>
                <option value="New Zealand">New Zealand</option>
                <option value="Turkish">Turkish</option>
                <option value="Iranian">Iranian</option>
                <option value="Israeli">Israeli</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="passportIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="passportExpiry" onchange="checkValidity('passport')" />
            </div>
            <div>
              <label>Upload Document</label>
              <input type="file" id="passportFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="passportStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid passport with minimum 6 months validity remaining from intended employment start date. Must be machine-readable and in good condition.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">📋 License Verification Letter</h2>
          <div class="grid">
            <div>
              <label>Issuing Aviation Authority</label>
              <select id="licenseVerificationAuthority">
                <option value="">Select Aviation Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction Générale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad Aérea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Aviação Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="AAC Austria">AAC (Austro Control - Austria)</option>
                <option value="DGAC Belgium">DGAC (Direction Générale Transport Aérien - Belgium)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Denmark">CAA Denmark (Danish Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Swedish Transport Agency)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority Norway)</option>
                <option value="CAA Finland">CAA Finland (Finnish Transport and Communications Agency)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (National Transport Authority)</option>
                <option value="CAA Romania">CAA Romania (Romanian Civil Aeronautical Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Administration)</option>
                <option value="CAA Greece">CAA Greece (Hellenic Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Croatian Civil Aviation Agency)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Agency)</option>
                <option value="CAA Slovakia">CAA Slovakia (Transport Authority)</option>
                <option value="CAA Russia">CAA Russia (Federal Air Transport Agency)</option>
                <option value="CAA Ukraine">CAA Ukraine (State Aviation Administration)</option>
                
                <!-- Americas -->
                <option value="TCCA Canada">TCCA (Transport Canada Civil Aviation)</option>
                <option value="ANAC Brazil">ANAC (Agência Nacional de Aviação Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administración Nacional de Aviación Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Dirección General de Aeronáutica Civil - Chile)</option>
                <option value="UAEAC Colombia">UAEAC (Unidad Administrativa Especial de Aeronáutica Civil - Colombia)</option>
                <option value="DGAC Ecuador">DGAC (Dirección General de Aviación Civil - Ecuador)</option>
                <option value="DGAC Peru">DGAC (Dirección General de Aeronáutica Civil - Peru)</option>
                <option value="DINAC Venezuela">DINAC (Instituto Nacional de Aeronáutica Civil - Venezuela)</option>
                <option value="DGAC Mexico">DGAC (Dirección General de Aeronáutica Civil - Mexico)</option>
                <option value="JCAA Jamaica">JCAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA South Africa">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Egypt">ECAA (Egyptian Civil Aviation Authority)</option>
                <option value="GACA Ghana">GACA (Ghana Civil Aviation Authority)</option>
                <option value="CCAA Ethiopia">CCAA (Ethiopian Civil Aviation Authority)</option>
                <option value="DGAC Morocco">DGAC (Direction Générale de l'Aviation Civile - Morocco)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Other/Manual Entry -->
                <option value="Other">Other Aviation Authority (Specify below)</option>
              </select>
              <div id="licenseVerificationAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="licenseVerificationAuthorityOther" placeholder="Please specify aviation authority" />
              </div>
            </div>
            <div>
              <label>Verification Letter Date</label>
              <input type="date" id="licenseVerificationDate" onchange="validateLetterDate('licenseVerificationDate', 'License Verification Letter')" />
            </div>
            <div>
              <label>Upload Verification Letter</label>
              <input type="file" id="licenseVerificationFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="licenseVerificationStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Official letter from the aviation authority that issued your license confirming its validity, ratings, and any restrictions. Required for license conversion to UAE GCAA license.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">✅ No Incident/Accident Letter</h2>
          <div class="grid">
            <div>
              <label>Issuing Aviation Authority</label>
              <select id="incidentLetterAuthority">
                <option value="">Select Aviation Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction Générale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad Aérea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Aviação Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="AAC Austria">AAC (Austro Control - Austria)</option>
                <option value="DGAC Belgium">DGAC (Direction Générale Transport Aérien - Belgium)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Denmark">CAA Denmark (Danish Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Swedish Transport Agency)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority Norway)</option>
                <option value="CAA Finland">CAA Finland (Finnish Transport and Communications Agency)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (National Transport Authority)</option>
                <option value="CAA Romania">CAA Romania (Romanian Civil Aeronautical Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Administration)</option>
                <option value="CAA Greece">CAA Greece (Hellenic Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Croatian Civil Aviation Agency)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Agency)</option>
                <option value="CAA Slovakia">CAA Slovakia (Transport Authority)</option>
                <option value="CAA Russia">CAA Russia (Federal Air Transport Agency)</option>
                <option value="CAA Ukraine">CAA Ukraine (State Aviation Administration)</option>
                
                <!-- Americas -->
                <option value="TCCA Canada">TCCA (Transport Canada Civil Aviation)</option>
                <option value="ANAC Brazil">ANAC (Agência Nacional de Aviação Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administración Nacional de Aviación Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Dirección General de Aeronáutica Civil - Chile)</option>
                <option value="UAEAC Colombia">UAEAC (Unidad Administrativa Especial de Aeronáutica Civil - Colombia)</option>
                <option value="DGAC Ecuador">DGAC (Dirección General de Aviación Civil - Ecuador)</option>
                <option value="DGAC Peru">DGAC (Dirección General de Aeronáutica Civil - Peru)</option>
                <option value="DINAC Venezuela">DINAC (Instituto Nacional de Aeronáutica Civil - Venezuela)</option>
                <option value="DGAC Mexico">DGAC (Dirección General de Aeronáutica Civil - Mexico)</option>
                <option value="JCAA Jamaica">JCAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA South Africa">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Egypt">ECAA (Egyptian Civil Aviation Authority)</option>
                <option value="GACA Ghana">GACA (Ghana Civil Aviation Authority)</option>
                <option value="CCAA Ethiopia">CCAA (Ethiopian Civil Aviation Authority)</option>
                <option value="DGAC Morocco">DGAC (Direction Générale de l'Aviation Civile - Morocco)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Previous Employer/Other -->
                <option value="Previous Airline/Employer">Previous Airline/Employer</option>
                <option value="Other">Other Authority (Specify below)</option>
              </select>
              <div id="incidentLetterAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="incidentLetterAuthorityOther" placeholder="Please specify authority" />
              </div>
            </div>
            <div>
              <label>Letter Issue Date</label>
              <input type="date" id="incidentLetterDate" onchange="validateLetterDate('incidentLetterDate', 'No Incident/Accident Letter')" />
            </div>
            <div>
              <label>Upload Letter</label>
              <input type="file" id="incidentLetterFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="incidentLetterStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Official letter confirming no aviation incidents, accidents, or violations on record. Must be issued by relevant aviation authority or previous employer within the last 6 months.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">⏱️ Flight Hours Verification Letter</h2>
          <div class="grid">
            <div>
              <label>Issuing Authority/Company</label>
              <input type="text" id="flightHoursAuthority" placeholder="Previous airline, flight school, or aviation authority" />
            </div>
            <div>
              <label>Letter Issue Date</label>
              <input type="date" id="flightHoursIssue" onchange="validateLetterDate('flightHoursIssue', 'Flight Hours Verification Letter')" />
            </div>
            <div>
              <label>Upload Verification Letter</label>
              <input type="file" id="flightHoursFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="flightHoursStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Official letter from previous employer or aviation authority verifying your total flight hours, aircraft types flown, and positions held. Must be on company letterhead with official signature and stamp.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">🆔 Emirates ID (if applicable)</h2>
          <div class="grid">
            <div>
              <label>Emirates ID Status</label>
              <select id="emiratesIdStatus" onchange="toggleEmiratesIdFields()">
                <option value="">Select Emirates ID Status</option>
                <option value="Have Emirates ID">I have Emirates ID</option>
                <option value="Do not have Emirates ID">No Current Emirates ID</option>
              </select>
            </div>
            <div id="emiratesIdNumberDiv" style="display: none;">
              <label>Emirates ID Number</label>
              <input type="text" id="emiratesIdNumber" placeholder="784-YYYY-XXXXXXX-X" />
            </div>
            <div id="emiratesIdIssueDateDiv" style="display: none;">
              <label>Issue Date</label>
              <input type="date" id="emiratesIdIssue" />
            </div>
            <div id="emiratesIdExpiryDateDiv" style="display: none;">
              <label>Expiry Date</label>
              <input type="date" id="emiratesIdExpiry" onchange="checkValidity('emiratesId')" />
            </div>
            <div id="emiratesIdUploadDiv" style="display: none;">
              <label>Upload Emirates ID Copy</label>
              <input type="file" id="emiratesIdFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="emiratesIdStatusDiv"></div>
          <div class="requirement-note">
            <strong>Note:</strong> Only required if you currently hold UAE residence. If you don't have Emirates ID, new Emirates ID will be processed after employment confirmation.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">🛂 UAE Visa & Work Permit (if applicable)</h2>
          <div class="grid">
            <div>
              <label>Current Visa Status</label>
              <select id="visaStatus">
                <option value="">Select Visa Status</option>
                <option value="Tourist Visa">Tourist Visa</option>
                <option value="Visit Visa">Visit Visa</option>
                <option value="Residence Visa">Residence Visa</option>
                <option value="Employment Visa">Employment Visa</option>
                <option value="No Current UAE Visa">No Current UAE Visa</option>
              </select>
            </div>
            <div>
              <label>Visa Expiry Date</label>
              <input type="date" id="visaExpiry" onchange="checkValidity('visa')" />
            </div>
            <div>
              <label>Upload Current Visa Copy</label>
              <input type="file" id="visaFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="visaStatusDiv"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid UAE entry visa or residence permit. If currently outside UAE, company will provide visa assistance. Work permit will be processed after job offer acceptance.
          </div>
        </div>
      </div>

      <!-- Step 4: Review & Submit -->
      <div class="form-step" data-step="4">
        <h2 class="step-title">🔍 Review & Submit</h2>
        <p class="step-subtitle">Please review all your information before submitting your documentation.</p>
        
        <div class="form-section">
          <div class="section-title">📋 Application Summary</div>
          <div id="reviewContent" style="background: #f8fafc; padding: 16px; border-radius: 8px; border: 1px solid var(--line);">
            <!-- Review content will be populated here -->
          </div>
        </div>

        <div class="form-section" id="signSection">
          <div class="section-title">✍️ Digital Signature & Declaration</div>
          
          <div style="background:linear-gradient(135deg,#fef7ed 0%,#fed7aa 100%);padding:20px;border-radius:12px;border:2px solid var(--flydubai-orange);margin-bottom:24px;">
            <p style="font-size:14px;line-height:1.7;color:var(--flydubai-navy);margin:0;font-weight:500;text-align:justify;">
              <strong>DECLARATION:</strong> I solemnly declare and affirm that all documentation, certifications, and validity periods contained herein are true, accurate, and complete in accordance with UAE GCAA regulations, ICAO standards, and applicable civil aviation requirements. I acknowledge that this declaration is made under penalty of regulatory sanctions and understand that any material misrepresentation, omission, or falsification may result in suspension or revocation of aviation privileges, termination of employment, and disciplinary proceedings pursuant to UAE aviation law. I further acknowledge my continuing obligation to maintain current and valid documentation in compliance with UAE employment and aviation regulatory requirements.
            </p>
          </div>
          
          <div class="grid">
            <div>
              <label>Date</label>
              <input type="date" id="sigDate" />
              <span class="date-print" id="sigDatePrint"></span>
            </div>
            <div>
              <label>Digital Signature</label>
              <canvas id="sigCanvas" class="signature-canvas"></canvas>
              <div style="margin-top: 8px; display: flex; flex-direction: column; gap: 8px;">
                <button type="button" id="sigClear" class="btn secondary">Clear Signature</button>
              </div>
            </div>
            <div>
              <label>Typed Signature (Alternative)</label>
              <input type="text" id="typedSig" placeholder="Type your full name" />
              <button type="button" id="sigApply" class="btn secondary">Apply Typed Signature</button>
            </div>
            <div>
              <label>Upload Signature (Alternative)</label>
              <input type="file" id="sigUpload" accept="image/*" />
            </div>
            <div>
              <label>
                <input type="checkbox" id="declaration" required />
                I declare that all information provided is true and accurate
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Navigation -->
      <div class="form-navigation">
        <div class="nav-left">
          <button type="button" id="prevBtn" class="btn secondary" style="display: none;">Previous Step</button>
        </div>
        <div class="nav-right">
          <button type="button" id="nextBtn" class="btn primary">Next Step</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Password Protection =====
    // Check if this is an authenticated reload (temporary session flag)
    const urlParams = new URLSearchParams(window.location.search);
    
    // Force password protection for testing - set to false for production
    const forcePassword = false; // Set to false in production
    
    // Check for temporary authentication
    const tempAuth = localStorage.getItem('temp_auth') === 'true';
    if (tempAuth) {
      localStorage.removeItem('temp_auth'); // Clear it immediately
    }
    
    let isAuthenticated = (!forcePassword && urlParams.has('authenticated')) || tempAuth;
    
    console.log('🔐 Password Protection Debug:');
    console.log('- URL params:', urlParams.toString());
    console.log('- Has authenticated param:', urlParams.has('authenticated'));
    console.log('- Force password mode:', forcePassword);
    console.log('- Temporary auth:', tempAuth);
    console.log('- Final authenticated status:', isAuthenticated);
    console.log('- localStorage keys:', Object.keys(localStorage));
    
    // Debug: Show what's happening with content clearing
    console.log('📍 About to check authentication...');
    
    if (!isAuthenticated) {
      console.log('❌ NOT AUTHENTICATED - Clearing content and showing password form');
      
      // Check for session recovery data immediately
      const hasSessionData = localStorage.getItem('pilotFormData') || localStorage.getItem('aircraftSections');
      if (hasSessionData) {
        console.log('📋 Previous session data detected');
        window.hasSessionToRecover = true;
      }
      
      // Immediately clear content and show password form (no timeout)
      document.body.innerHTML = '';
      document.body.style.margin = '0';
      document.body.style.padding = '0';
      document.body.style.visibility = 'visible';
      
      console.log('✅ Content cleared, about to show password form');
    } else {
      console.log('✅ AUTHENTICATED - Showing main content');
      // Clean URL after authentication and show content
      window.history.replaceState({}, document.title, window.location.pathname);
      document.querySelector('.content-container').style.display = 'block';
    }
    
    (function() {
      if (isAuthenticated) {
        console.log('⏭️ SKIPPING password form - already authenticated');
        return; // Skip password form if already authenticated
      }
      
      console.log('🔑 STARTING password form setup...');
      
      const FORM_PASSWORD = "FlightTime2025";
      let attempts = 0; // Reset attempts on each visit
      const maxAttempts = 3;
      
      function showPasswordForm() {
        console.log('🎨 RENDERING password form...');
        const errorMessage = attempts > 0 ? `<div style="color: #dc2626; margin-bottom: 16px; padding: 12px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
          <strong>Incorrect access code.</strong> ${maxAttempts - attempts} attempt(s) remaining.
        </div>` : '';
        
        const sessionRecoveryMessage = window.hasSessionToRecover ? `<div style="color: #059669; margin-bottom: 16px; padding: 12px; background: #ecfdf5; border-radius: 8px; border: 1px solid #a7f3d0;">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 18px;">📋</span>
            <span style="margin-left: 8px; font-weight: 600;">Previous session found!</span>
          </div>
          <div style="font-size: 14px;">Your previous form data will be restored after authentication.</div>
        </div>` : '';
        
        document.body.innerHTML = `
          <div style="background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 12%, #8b5cf6 25%, #a855f7 37%, #c084fc 50%, #6366f1 62%, #8b5cf6 75%, #9333ea 87%, #7c3aed 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; font-family: Inter, system-ui, sans-serif; padding: 20px;">
            <div style="background: white; border-radius: 20px; padding: 16px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4); max-width: 400px; width: 100%; border: 1px solid #e2e8f0;">
              <div style="text-align: center; margin: 0;">
                <div style="width: 180px; height: 120px; background-image: url('Flydubai-Logo.png'); background-size: contain; background-repeat: no-repeat; background-position: center; margin: 0 auto -8px;"></div>
                <h2 style="color: #7c3aed; margin: 0 0 12px 0; font-size: 28px; font-weight: 700;">Access Code Required</h2>
                <p style="color: #6b7280; margin: 0;">Enter your access code to continue to the pilot documentation form.</p>
              </div>
              
              ${sessionRecoveryMessage}
              ${errorMessage}
              
              <form id="passwordForm" style="display: flex; flex-direction: column; gap: 20px;">
                <div>
                  <label for="passwordInput" style="display: block; margin-bottom: 8px; color: #374151; font-weight: 600; font-size: 14px;">Access Code</label>
                  <div style="position: relative;">
                    <input 
                      type="password" 
                      id="passwordInput" 
                      placeholder="Enter access code"
                      style="width: 100%; padding: 16px 50px 16px 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s ease; box-sizing: border-box;"
                      onfocus="this.style.borderColor='#7c3aed'; this.style.boxShadow='0 0 0 3px rgba(124, 58, 237, 0.1)'"
                      onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                      required
                    />
                    <button 
                      type="button" 
                      id="togglePassword"
                      style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: #6b7280; padding: 0; width: 20px; height: 20px; display: flex; align-items: center; justify-content: center;"
                      onclick="togglePasswordVisibility()"
                    >
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                      </svg>
                    </button>
                  </div>
                </div>
                <button 
                  type="submit" 
                  style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%); color: white; border: none; padding: 16px 32px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 25px -5px rgba(124, 58, 237, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                >
                  Access Form
                </button>
              </form>
            </div>
          </div>
        `;
        
        // Focus on the password input
        setTimeout(() => {
          const passwordInput = document.getElementById('passwordInput');
          console.log('🎯 Trying to focus password input:', passwordInput ? 'FOUND' : 'NOT FOUND');
          if (passwordInput) passwordInput.focus();
        }, 100);
        
        // Add password visibility toggle function
        window.togglePasswordVisibility = function() {
          const passwordInput = document.getElementById('passwordInput');
          const toggleButton = document.getElementById('togglePassword');
          
          if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            toggleButton.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46C3.08 8.3 1.78 10.02 1 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/></svg>';
          } else {
            passwordInput.type = 'password';
            toggleButton.innerHTML = '<svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>';
          }
        };
        
        console.log('✅ Password form HTML set, form should be visible now');
        
        // Handle form submission
        const passwordForm = document.getElementById('passwordForm');
        console.log('🔗 Looking for password form:', passwordForm ? 'FOUND' : 'NOT FOUND');
        
        if (passwordForm) {
          passwordForm.addEventListener('submit', function(e) {
            console.log('📝 Form submission triggered!');
            e.preventDefault();
            const userPassword = document.getElementById('passwordInput')?.value;
            console.log('🔑 Password entered:', userPassword ? 'YES' : 'NO');
            console.log('🔑 Correct password:', FORM_PASSWORD);
            
            if (userPassword === FORM_PASSWORD) {
              console.log('✅ Password correct! Redirecting...');
              
              // Temporarily disable force password for the redirect
              localStorage.setItem('temp_auth', 'true');
              
              // Reload page with authenticated parameter
              const newUrl = window.location.pathname + '?authenticated=true';
              console.log('🔄 Redirecting to:', newUrl);
              window.location.href = newUrl;
              
            } else {
              console.log('❌ Password incorrect! Attempt:', attempts + 1);
              attempts++;
              if (attempts >= maxAttempts) {
                document.body.innerHTML = `
                  <div style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); min-height: 100vh; display: flex; align-items: center; justify-content: center; font-family: Inter, system-ui, sans-serif; color: white; text-align: center; padding: 20px;">
                    <div>
                      <h1 style="font-size: 48px; margin-bottom: 20px;">🔒</h1>
                      <h2 style="font-size: 24px; margin-bottom: 16px;">Access Denied</h2>
                      <p style="font-size: 16px; opacity: 0.9;">Maximum attempts exceeded. Please contact system administrator.</p>
                    </div>
                  </div>
                `;
              } else {
                console.log('🔄 Showing password form again with error');
                showPasswordForm();
              }
            }
          });
        } else {
          console.error('❌ Password form element not found after setting innerHTML!');
        }
      }
      
      // Show password form immediately
      console.log('📢 CALLING showPasswordForm()...');
      showPasswordForm();
      console.log('📢 showPasswordForm() called - check if form appeared');
    })();
  </script>

  <!-- Main JavaScript continues after authentication -->
  <script>
    // Only execute main script if authenticated
    document.addEventListener('DOMContentLoaded', function() {
      if (!isAuthenticated) return;
      
      console.log('📱 Mobile version initialization starting...');
      
      // Show content container
      document.querySelector('.content-container').style.display = 'block';
      
      // Global variables
      let currentStep = 1;
      const totalSteps = 4;
      let formData = {};
      let sectionsWrap;
      let sectionCounter = 0;

      // Initialize form
      function initializeForm() {
        console.log('🚀 Initializing mobile form...');
        
        sectionsWrap = document.getElementById('sections');
        
        // Load saved data if available
        const hasData = loadFormData();
        if (hasData) {
          populateFormFields();
        }
        
        // Check for recovery
        checkForRecovery();
        
        // Setup auto-save
        setupAutoSave();
        
        // Setup event listeners
        setupEventListeners();
        
        // Setup authority dropdown handlers
        setupAuthorityDropdownHandlers();
        
        // Add initial Boeing 737 sections (locked)
        addFlightExperienceSection('Boeing 737 NG/MAX', true, 'ng-max');
        addFlightExperienceSection('Boeing 737 Classic (300-500)', true, 'classic');
        
        console.log('✅ Mobile form initialized successfully');
      }

      // Show specific step
      function showStep(step) {
        console.log('📍 Switching to step:', step);
        
        // Hide all steps
        const allSteps = document.querySelectorAll('.form-step');
        allSteps.forEach(stepEl => stepEl.classList.remove('active'));
        
        // Hide all step indicators
        const allStepIndicators = document.querySelectorAll('.step');
        allStepIndicators.forEach(stepEl => {
          stepEl.classList.remove('active', 'completed');
        });
        
        // Show current step
        const currentStepEl = document.querySelector(`.form-step[data-step="${step}"]`);
        if (currentStepEl) {
          currentStepEl.classList.add('active');
        }
        
        // Update step indicators
        for (let i = 1; i <= totalSteps; i++) {
          const indicator = document.querySelector(`.step[data-step="${i}"]`);
          if (indicator) {
            if (i < step) {
              indicator.classList.add('completed');
            } else if (i === step) {
              indicator.classList.add('active');
            }
          }
        }
        
        // Update progress bar
        const progress = (step / totalSteps) * 100;
        document.getElementById('progressFill').style.width = `${progress}%`;
        
        // Update navigation buttons
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        
        if (prevBtn) {
          prevBtn.style.display = step > 1 ? 'block' : 'none';
        }
        
        if (nextBtn) {
          nextBtn.textContent = step === totalSteps ? 'Submit Documentation' : 'Next Step';
        }
        
        // Generate review content for step 4
        if (step === 4) {
          generateReviewContent();
        }
        
        // Auto-save when changing steps
        saveFormData();
      }
      
      // Navigation functions
      function nextStep() {
        console.log('➡️ Next step clicked, current step:', currentStep);
        
        if (currentStep < totalSteps) {
          // Validate current step before proceeding
          if (validateCurrentStep()) {
            currentStep++;
            showStep(currentStep);
          }
        } else {
          // Final submit
          submitForm();
        }
      }
      
      function previousStep() {
        console.log('⬅️ Previous step clicked, current step:', currentStep);
        
        if (currentStep > 1) {
          currentStep--;
          showStep(currentStep);
        }
      }

      // Add flight experience section
      function addFlightExperienceSection(aircraftType = '', locked = false, b737Type = null) {
        console.log('➕ Adding flight experience section:', { aircraftType, locked, b737Type });
        
        if (!sectionsWrap) {
          sectionsWrap = document.getElementById('sections');
        }
        
        sectionCounter++;
        const sectionId = `section${sectionCounter}`;
        
        const section = document.createElement('div');
        section.className = 'section';
        section.id = sectionId;
        
        const aircraftOptions = [
          // Boeing Commercial Aircraft
          'Boeing 757-200',
          'Boeing 757-300', 
          'Boeing 767-200',
          'Boeing 767-300',
          'Boeing 777-200',
          'Boeing 777-300',
          'Boeing 787-8 Dreamliner',
          'Boeing 787-9 Dreamliner',
          'Boeing 787-10 Dreamliner',
          // Airbus Commercial Aircraft
          'Airbus A319',
          'Airbus A320',
          'Airbus A321',
          'Airbus A330-200',
          'Airbus A330-300',
          'Airbus A340-200',
          'Airbus A340-300',
          'Airbus A350-900',
          'Airbus A350-1000',
          'Airbus A380',
          // Regional Jets & Commercial Aircraft
          'McDonnell Douglas MD-80',
          'McDonnell Douglas MD-90',
          'Embraer E-Jet E170',
          'Embraer E-Jet E175',
          'Embraer E-Jet E190',
          'Embraer E-Jet E195',
          'Bombardier CRJ-100',
          'Bombardier CRJ-200',
          'Bombardier CRJ-700',
          'Bombardier CRJ-900',
          'Bombardier CRJ-1000',
          'British Aerospace BAe 146',
          'Avro RJ70',
          'Avro RJ85',
          'Avro RJ100',
          'Dornier 328JET',
          'Fairchild Metro III',
          'BAe Jetstream 41',
          'Embraer EMB-120 Brasilia',
          // Cargo Aircraft
          'Boeing 747-400F Freighter',
          'Boeing 767-300F Freighter',
          'Boeing 777F Freighter',
          'Airbus A330-200F Freighter',
          'McDonnell Douglas MD-11F',
          // Business Jets & Private Aircraft
          'Gulfstream G150',
          'Gulfstream G280',
          'Gulfstream G450',
          'Gulfstream G500',
          'Gulfstream G550',
          'Gulfstream G600',
          'Gulfstream G650',
          'Gulfstream G700',
          'Bombardier Global 5000',
          'Bombardier Global 5500',
          'Bombardier Global 6000',
          'Bombardier Global 6500',
          'Bombardier Global 7500',
          'Bombardier Challenger 300',
          'Bombardier Challenger 350',
          'Bombardier Challenger 600',
          'Bombardier Challenger 650',
          'Dassault Falcon 2000',
          'Dassault Falcon 2000EX',
          'Dassault Falcon 2000LX',
          'Dassault Falcon 7X',
          'Dassault Falcon 8X',
          'Dassault Falcon 900',
          'Cessna Citation Longitude',
          'Cessna Citation X',
          'Embraer Lineage 1000',
          'Embraer Praetor 500',
          'Embraer Praetor 600',
          // Military & Special Aircraft
          'Lockheed C-130 Hercules',
          'Boeing KC-135 Stratotanker',
          'Airbus A400M Atlas',
          'Boeing E-3 AWACS',
          'Lockheed P-3 Orion',
          'Boeing P-8 Poseidon',
          // Vintage & Classic Aircraft
          'Douglas DC-3',
          'Boeing 727',
          'McDonnell Douglas DC-9',
          'Lockheed L-1011 TriStar',
          'Sud Aviation Caravelle',
          'BAC One-Eleven',
          'Fokker F28',
          'Fokker 100',
          // Other Aircraft Types
          'Glider/Sailplane',
          'Ultralight Aircraft',
          'Experimental Aircraft',
          'Other - Specify in Notes'
        ];
        
        let aircraftSelectHtml;
        if (locked && (b737Type === 'ng-max' || b737Type === 'classic')) {
          aircraftSelectHtml = `
            <div style="margin-bottom: 12px;">
              <label>Aircraft Type *</label>
              <select class="ac-type form-select" disabled style="background: #f3f4f6; color: #6b7280; cursor: not-allowed;">
                <option value="${aircraftType}" selected>${aircraftType}</option>
              </select>
            </div>
          `;
        } else {
          aircraftSelectHtml = `
            <div style="margin-bottom: 12px;">
              <label>Aircraft Type *</label>
              <select class="ac-type" required>
                <option value="">Select Aircraft Type</option>
                ${aircraftOptions.map(option => `<option value="${option}">${option}</option>`).join('')}
              </select>
            </div>
          `;
        }
        
        // Function to check if aircraft is >50T MTOW
        function isHeavyJet(aircraftType) {
          const heavyJets = [
            // Boeing Commercial Aircraft - VERIFIED >50T MTOW
            'Boeing 757-200', 'Boeing 757-300', 'Boeing 767-200', 'Boeing 767-300',
            'Boeing 777-200', 'Boeing 777-300', 'Boeing 787-8 Dreamliner', 
            'Boeing 787-9 Dreamliner', 'Boeing 787-10 Dreamliner', 'Boeing 727',
            // Airbus Commercial Aircraft - VERIFIED >50T MTOW  
            'Airbus A319', 'Airbus A320', 'Airbus A321', 'Airbus A330-200',
            'Airbus A330-300', 'Airbus A340-200', 'Airbus A340-300', 
            'Airbus A350-900', 'Airbus A350-1000', 'Airbus A380',
            // Regional Jets - ONLY VERIFIED >50T
            'Embraer E-Jet E195',
            // Business Jets - VERIFIED >50T MTOW ONLY
            'Bombardier Global 7500', 'Embraer Lineage 1000',
            // Cargo Aircraft - VERIFIED >50T MTOW
            'Boeing 747-400F Freighter', 'Boeing 767-300F Freighter', 
            'Boeing 777F Freighter', 'Airbus A330-200F Freighter', 'McDonnell Douglas MD-11F',
            // Military & Special Aircraft - VERIFIED >50T MTOW
            'Lockheed C-130 Hercules', 'Boeing KC-135 Stratotanker', 'Airbus A400M Atlas',
            'Boeing E-3 AWACS', 'Boeing P-8 Poseidon', 'Lockheed P-3 Orion',
            // Vintage & Classic Aircraft - VERIFIED >50T MTOW
            'Lockheed L-1011 TriStar'
          ];
          return heavyJets.includes(aircraftType);
        }
        
        const showHeavyJetIndicator = (aircraftType === 'Boeing 737 NG/MAX' || aircraftType === 'Boeing 737 Classic (300-500)');
        const heavyJetIndicator = showHeavyJetIndicator ? 
          '<div class="heavy-jet-indicator" style="display: flex; align-items: center; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3); margin-bottom: 12px;">✈ >50T MTOW</div>' : '';
        
        // Add heavy jet indicator placeholder for non-locked sections
        const heavyJetPlaceholder = !locked ? '<div class="heavy-jet-indicator" style="display: none; align-items: center; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3); margin-bottom: 12px;">✈ >50T MTOW</div>' : '';
        
        section.innerHTML = `
          <div class="section-title">
            <h3>Aircraft Type ${sectionCounter}</h3>
            ${!locked ? `<button type="button" onclick="removeSection('${sectionId}')" class="btn" style="background: #ef4444; color: white; font-size: 12px; padding: 6px 12px; width: auto; margin-left: 10px;">Remove</button>` : ''}
          </div>
          ${heavyJetIndicator}${heavyJetPlaceholder}
          
          <div class="grid">
            ${aircraftSelectHtml}
            <div class="notes-container" style="display: none;">
              <label>Notes/Comments</label>
              <textarea class="ac-notes" placeholder="Any additional notes about your experience on this aircraft type"></textarea>
            </div>
          </div>
          
          <!-- Flight Hours Table (Mobile Optimized) -->
          <div class="table-mobile">
            <div class="table-row">
              <div class="table-cell">
                <span class="table-label">PIC Total Hours</span>
                <span class="table-value"><input type="text" class="hhmm" placeholder="0:00" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">PIC Block Hours</span>
                <span class="table-value"><input type="text" class="hhmm" placeholder="0:00" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">SIC Total Hours</span>
                <span class="table-value"><input type="text" class="hhmm" placeholder="0:00" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">SIC Block Hours</span>
                <span class="table-value"><input type="text" class="hhmm" placeholder="0:00" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">Multi-Pilot Hours</span>
                <span class="table-value"><input type="text" class="hhmm" placeholder="0:00" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">Night Hours</span>
                <span class="table-value"><input type="text" class="hhmm" placeholder="0:00" /></span>
              </div>
            </div>
          </div>
          
          <!-- Date Fields (Mobile Optimized) -->
          <div class="table-mobile" style="margin-top: 15px;">
            <div class="table-row">
              <div class="table-cell">
                <span class="table-label">PIC First Flight</span>
                <span class="table-value"><input type="date" class="date-inp" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">PIC Last Flight</span>
                <span class="table-value"><input type="date" class="date-inp" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">SIC First Flight</span>
                <span class="table-value"><input type="date" class="date-inp" /></span>
              </div>
              <div class="table-cell">
                <span class="table-label">SIC Last Flight</span>
                <span class="table-value"><input type="date" class="date-inp" /></span>
              </div>
            </div>
          </div>
        `;
        
        sectionsWrap.appendChild(section);
        
        // Add event listeners for time fields
        const timeFields = section.querySelectorAll('.hhmm');
        timeFields.forEach(field => {
          field.addEventListener('blur', function() {
            padHHMM(this);
            computeAll();
          });
        });
        
        // Add aircraft type change event listener to show/hide notes field  
        const aircraftSelect = section.querySelector('.ac-type');
        const notesContainer = section.querySelector('.notes-container');
        
        if (aircraftSelect && !locked) {
          aircraftSelect.addEventListener('change', function() {
            // Handle notes visibility
            if (this.value === 'Other - Specify in Notes') {
              notesContainer.style.display = 'block';
            } else {
              notesContainer.style.display = 'none';
              // Clear notes when switching away from "Other"
              const notesInput = notesContainer.querySelector('.ac-notes');
              if (notesInput) notesInput.value = '';
            }
            
            // Handle heavy jet indicator visibility
            const heavyIndicator = section.querySelector('.heavy-jet-indicator');
            if (heavyIndicator) {
              if (isHeavyJet(this.value)) {
                heavyIndicator.style.display = 'flex';
              } else {
                heavyIndicator.style.display = 'none';
              }
            }
          });
          
          // Trigger initial state check for notes
          if (aircraftSelect.value === 'Other - Specify in Notes') {
            notesContainer.style.display = 'block';
          }
          
          // Trigger initial state check for heavy jet indicator
          const heavyIndicator = section.querySelector('.heavy-jet-indicator');
          if (heavyIndicator && isHeavyJet(aircraftSelect.value)) {
            heavyIndicator.style.display = 'flex';
          }
        }
      }

      // Time formatting functions
      function parseHHMM(str) {
        if (!str || str.trim() === '') return 0;
        const parts = str.split(':');
        if (parts.length !== 2) return 0;
        const hours = parseInt(parts[0]) || 0;
        const minutes = parseInt(parts[1]) || 0;
        return hours * 60 + minutes;
      }
      
      function toHHMM(totalMinutes) {
        const hours = Math.floor(totalMinutes / 60);
        const minutes = totalMinutes % 60;
        return `${hours}:${minutes.toString().padStart(2, '0')}`;
      }
      
      function padHHMM(el) {
        const val = el.value.trim();
        if (!val) {
          el.value = '0:00';
          return;
        }
        
        // Parse various formats
        let minutes = 0;
        if (val.includes(':')) {
          minutes = parseHHMM(val);
        } else {
          // Assume it's just hours
          const hours = parseFloat(val) || 0;
          minutes = Math.round(hours * 60);
        }
        
        el.value = toHHMM(minutes);
      }

      // Date formatting function
      function toDDMMMYYYY(dateStr) {
        if (!dateStr) return '';
        const date = new Date(dateStr);
        if (isNaN(date.getTime())) return '';
        
        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                       'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        const day = date.getDate().toString().padStart(2, '0');
        const month = months[date.getMonth()];
        const year = date.getFullYear();
        
        return `${day} ${month} ${year}`;
      }

      // Compute all totals
      function computeAll() {
        console.log('🔄 Computing all totals...');
        
        let totalCombined = 0;
        let totalMP = 0;
        let totalNight = 0;
        
        // Sum up all sections
        const sections = document.querySelectorAll('#sections .section');
        sections.forEach(section => {
          const timeInputs = section.querySelectorAll('.hhmm');
          if (timeInputs.length >= 6) {
            const picBlock = parseHHMM(timeInputs[1].value);
            const sicBlock = parseHHMM(timeInputs[3].value);
            const multiPilot = parseHHMM(timeInputs[4].value);
            const night = parseHHMM(timeInputs[5].value);
            
            totalCombined += picBlock + sicBlock;
            totalMP += multiPilot;
            totalNight += night;
          }
        });
        
        // Update grand totals display
        const gtCombined = document.getElementById('gtCombined');
        const gtMP = document.getElementById('gtMP');
        const gtNight = document.getElementById('gtNight');
        
        if (gtCombined) gtCombined.textContent = toHHMM(totalCombined);
        if (gtMP) gtMP.textContent = toHHMM(totalMP);
        if (gtNight) gtNight.textContent = toHHMM(totalNight);
      }

      // Remove section
      function removeSection(sectionId) {
        const section = document.getElementById(sectionId);
        if (section && !section.querySelector('input[readonly]')) {
          section.remove();
          computeAll();
          saveFormData();
        }
      }

      // Setup event listeners
      function setupEventListeners() {
        console.log('🔗 Setting up event listeners...');
        
        // Navigation buttons
        const nextBtn = document.getElementById('nextBtn');
        const prevBtn = document.getElementById('prevBtn');
        
        if (nextBtn) {
          nextBtn.addEventListener('click', nextStep);
        }
        
        if (prevBtn) {
          prevBtn.addEventListener('click', previousStep);
        }
        
        // Add section button
        const btnAddSection = document.getElementById('btnAddSection');
        if (btnAddSection) {
          btnAddSection.addEventListener('click', () => {
            addFlightExperienceSection();
            saveFormData();
          });
        }
        
        // Auto-save on form changes
        document.addEventListener('change', () => {
          saveFormData();
        });
        
        document.addEventListener('input', () => {
          saveFormData();
        });
        
        // Add event listeners for summary section time fields
        setTimeout(() => {
          const summaryTimeFields = document.querySelectorAll('.summary .hhmm');
          console.log('🕐 Setting up summary time fields:', summaryTimeFields.length);
          summaryTimeFields.forEach(field => {
            field.addEventListener('blur', function() {
              padHHMM(this);
              computeAll();
            });
          });
        }, 100);
      }

      // ROL Functions
      function toggleROLFields() {
        const rolType = document.getElementById('rolType').value;
        const rolNumberDiv = document.getElementById('rolNumberDiv');
        const rolIssueDateDiv = document.getElementById('rolIssueDateDiv');
        const rolExpiryDateDiv = document.getElementById('rolExpiryDateDiv');
        const rolUploadDiv = document.getElementById('rolUploadDiv');
        
        if (rolType === 'Attached to License') {
          // Hide all fields except ROL Type when attached to license
          if (rolNumberDiv) rolNumberDiv.style.display = 'none';
          if (rolIssueDateDiv) rolIssueDateDiv.style.display = 'none';
          if (rolExpiryDateDiv) rolExpiryDateDiv.style.display = 'none';
          if (rolUploadDiv) rolUploadDiv.style.display = 'none';
          
          // Clear the fields
          document.getElementById('rolNumber').value = '';
          document.getElementById('rolIssue').value = '';
          document.getElementById('rolExpiry').value = '';
          const fileInput = document.getElementById('rolFile');
          if (fileInput) {
            fileInput.value = '';
          }
        } else if (rolType === 'Separate Certificate') {
          // Show all fields when separate certificate is selected
          if (rolNumberDiv) rolNumberDiv.style.display = 'block';
          if (rolIssueDateDiv) rolIssueDateDiv.style.display = 'block';
          if (rolExpiryDateDiv) rolExpiryDateDiv.style.display = 'block';
          if (rolUploadDiv) rolUploadDiv.style.display = 'block';
        } else {
          // Hide fields when nothing is selected
          if (rolNumberDiv) rolNumberDiv.style.display = 'none';
          if (rolIssueDateDiv) rolIssueDateDiv.style.display = 'none';
          if (rolExpiryDateDiv) rolExpiryDateDiv.style.display = 'none';
          if (rolUploadDiv) rolUploadDiv.style.display = 'none';
        }
      }

      // Make function globally accessible
      window.toggleROLFields = toggleROLFields;

      // English Proficiency Functions
      function toggleEnglishTestDate() {
        const testType = document.getElementById('englishTestType').value;
        const testDateDiv = document.getElementById('englishTestDateDiv');
        const expiryDiv = document.getElementById('englishExpiryDiv');
        const englishUploadDiv = document.getElementById('englishUploadDiv');
        const statusDiv = document.getElementById('englishStatus');
        
        if (testType === 'Attached to License') {
          // Hide date, expiry and upload fields - keep proficiency level visible
          if (testDateDiv) testDateDiv.style.display = 'none';
          if (expiryDiv) expiryDiv.style.display = 'none';
          if (englishUploadDiv) englishUploadDiv.style.display = 'none';
          
          // Clear the hidden fields
          document.getElementById('englishTestDate').value = '';
          document.getElementById('englishExpiry').value = '';
          const fileInput = document.getElementById('englishFile');
          if (fileInput) fileInput.value = '';
          
          // Show attached to license status
          if (statusDiv) {
            statusDiv.innerHTML = '<span class="status-indicator status-valid">ATTACHED TO LICENSE</span>';
          }
        } else if (testType && testType !== '') {
          // Show all fields for other test types
          if (testDateDiv) testDateDiv.style.display = 'block';
          if (expiryDiv) expiryDiv.style.display = 'block';
          if (englishUploadDiv) englishUploadDiv.style.display = 'block';
          
          // Clear status when not attached to license
          if (statusDiv) statusDiv.innerHTML = '';
        } else {
          // Hide fields when nothing is selected
          if (testDateDiv) testDateDiv.style.display = 'none';
          if (expiryDiv) expiryDiv.style.display = 'none';
          if (englishUploadDiv) englishUploadDiv.style.display = 'none';
        }
      }

      // Make function globally accessible
      window.toggleEnglishTestDate = toggleEnglishTestDate;

      // Emirates ID Functions
      function toggleEmiratesIdFields() {
        const emiratesIdStatus = document.getElementById('emiratesIdStatus').value;
        const emiratesIdNumberDiv = document.getElementById('emiratesIdNumberDiv');
        const emiratesIdIssueDateDiv = document.getElementById('emiratesIdIssueDateDiv');
        const emiratesIdExpiryDateDiv = document.getElementById('emiratesIdExpiryDateDiv');
        const emiratesIdUploadDiv = document.getElementById('emiratesIdUploadDiv');
        
        if (emiratesIdStatus === 'Have Emirates ID') {
          // Show all fields when user has Emirates ID
          if (emiratesIdNumberDiv) emiratesIdNumberDiv.style.display = 'block';
          if (emiratesIdIssueDateDiv) emiratesIdIssueDateDiv.style.display = 'block';
          if (emiratesIdExpiryDateDiv) emiratesIdExpiryDateDiv.style.display = 'block';
          if (emiratesIdUploadDiv) emiratesIdUploadDiv.style.display = 'block';
        } else if (emiratesIdStatus === 'Do not have Emirates ID') {
          // Hide all fields when user doesn't have Emirates ID
          if (emiratesIdNumberDiv) emiratesIdNumberDiv.style.display = 'none';
          if (emiratesIdIssueDateDiv) emiratesIdIssueDateDiv.style.display = 'none';
          if (emiratesIdExpiryDateDiv) emiratesIdExpiryDateDiv.style.display = 'none';
          if (emiratesIdUploadDiv) emiratesIdUploadDiv.style.display = 'none';
          
          // Clear the fields when hidden
          document.getElementById('emiratesIdNumber').value = '';
          document.getElementById('emiratesIdIssue').value = '';
          document.getElementById('emiratesIdExpiry').value = '';
          const fileInput = document.getElementById('emiratesIdFile');
          if (fileInput) fileInput.value = '';
        } else {
          // Hide fields when nothing is selected
          if (emiratesIdNumberDiv) emiratesIdNumberDiv.style.display = 'none';
          if (emiratesIdIssueDateDiv) emiratesIdIssueDateDiv.style.display = 'none';
          if (emiratesIdExpiryDateDiv) emiratesIdExpiryDateDiv.style.display = 'none';
          if (emiratesIdUploadDiv) emiratesIdUploadDiv.style.display = 'none';
        }
      }

      // Make function globally accessible
      window.toggleEmiratesIdFields = toggleEmiratesIdFields;
      
      // Document Expiry Check Function
      function checkDocumentExpiry(docType, expiryValue) {
        if (!expiryValue) return;
        
        const today = new Date();
        const expiryDate = new Date(expiryValue);
        const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
        const warningDiv = document.getElementById(docType.toLowerCase() + 'ExpiryWarning');
        
        if (!warningDiv) return;
        
        warningDiv.innerHTML = '';
        
        if (daysUntilExpiry < 0) {
          warningDiv.innerHTML = '<span style="color: #dc2626; font-weight: 600;">⚠️ EXPIRED</span>';
        } else if (daysUntilExpiry <= 30) {
          warningDiv.innerHTML = '<span style="color: #f59e0b; font-weight: 600;">⚠️ EXPIRES SOON</span>';
        } else {
          warningDiv.innerHTML = '<span style="color: #059669; font-weight: 600;">✅ VALID</span>';
        }
      }
      
      // File Upload Handler Function
      function handleFileUpload(fileInput, documentType) {
        const file = fileInput.files[0];
        if (!file) return;
        
        // Check file size (10MB limit)
        const maxSize = 10 * 1024 * 1024; // 10MB in bytes
        if (file.size > maxSize) {
          alert(`File size too large. Maximum size is 10MB. Your file is ${(file.size / 1024 / 1024).toFixed(1)}MB.`);
          fileInput.value = '';
          return;
        }
        
        // Check file type
        const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
        if (!allowedTypes.includes(file.type)) {
          alert(`Invalid file type. Please upload PDF, JPG, or PNG files only.`);
          fileInput.value = '';
          return;
        }
        
        // Show success indicator
        console.log(`${documentType} file uploaded successfully: ${file.name}`);
      }
      
      // Make functions globally accessible
      window.checkDocumentExpiry = checkDocumentExpiry;
      window.handleFileUpload = handleFileUpload;

      // Letter Date Validation Function (30-day requirement)
      function validateLetterDate(letterDateId, letterName) {
        const dojInput = document.getElementById('doj');
        const letterDateInput = document.getElementById(letterDateId);
        
        if (!dojInput || !letterDateInput || !dojInput.value || !letterDateInput.value) {
          return; // Skip validation if inputs are missing or empty
        }
        
        const doj = new Date(dojInput.value);
        const letterDate = new Date(letterDateInput.value);
        const daysDifference = Math.ceil((doj.getTime() - letterDate.getTime()) / (1000 * 60 * 60 * 24));
        
        // Determine status div ID based on letter type
        let statusDivId = '';
        if (letterName.includes('License Verification')) {
          statusDivId = 'licenseVerificationStatus';
        } else if (letterName.includes('Flight Hours')) {
          statusDivId = 'flightHoursStatus';
        } else if (letterName.includes('Incident')) {
          statusDivId = 'incidentLetterStatus';
        }
        
        const statusDiv = document.getElementById(statusDivId);
        if (!statusDiv) return;
        
        if (daysDifference > 30) {
          statusDiv.innerHTML = `<span class="status-indicator status-expired">⚠️ LETTER TOO OLD: Issued ${daysDifference} days before joining. Must be within 30 days of employment start date.</span>`;
        } else if (daysDifference < 0) {
          const futureDays = Math.abs(daysDifference);
          statusDiv.innerHTML = `<span class="status-indicator status-warning">⚠️ FUTURE DATE: Letter dated ${futureDays} days after joining date. Please verify date is correct.</span>`;
        } else {
          statusDiv.innerHTML = `<span class="status-indicator status-valid">✅ VALID: Letter issued ${daysDifference} days before joining (within 30-day requirement)</span>`;
        }
      }

      // Make function globally accessible
      window.validateLetterDate = validateLetterDate;

      // Authority Dropdown "Other" Option Handlers
      function setupAuthorityDropdownHandlers() {
        // Medical Authority dropdown
        const medicalAuthority = document.getElementById('medicalAuthority');
        const medicalAuthorityOtherDiv = document.getElementById('medicalAuthorityOtherDiv');
        if (medicalAuthority && medicalAuthorityOtherDiv) {
          medicalAuthority.addEventListener('change', () => {
            if (medicalAuthority.value === 'Other') {
              medicalAuthorityOtherDiv.style.display = 'block';
            } else {
              medicalAuthorityOtherDiv.style.display = 'none';
            }
          });
        }
        
        // Radio Authority dropdown  
        const rolAuthority = document.getElementById('rolAuthority');
        const rolAuthorityOtherDiv = document.getElementById('rolAuthorityOtherDiv');
        if (rolAuthority && rolAuthorityOtherDiv) {
          rolAuthority.addEventListener('change', () => {
            if (rolAuthority.value === 'Other') {
              rolAuthorityOtherDiv.style.display = 'block';
            } else {
              rolAuthorityOtherDiv.style.display = 'none';
            }
          });
        }
        
        // License Verification Authority dropdown
        const licenseVerificationAuthority = document.getElementById('licenseVerificationAuthority');
        const licenseVerificationAuthorityOtherDiv = document.getElementById('licenseVerificationAuthorityOtherDiv');
        if (licenseVerificationAuthority && licenseVerificationAuthorityOtherDiv) {
          licenseVerificationAuthority.addEventListener('change', () => {
            if (licenseVerificationAuthority.value === 'Other') {
              licenseVerificationAuthorityOtherDiv.style.display = 'block';
            } else {
              licenseVerificationAuthorityOtherDiv.style.display = 'none';
            }
          });
        }
        
        // Incident Letter Authority dropdown
        const incidentLetterAuthority = document.getElementById('incidentLetterAuthority');
        const incidentLetterAuthorityOtherDiv = document.getElementById('incidentLetterAuthorityOtherDiv');
        if (incidentLetterAuthority && incidentLetterAuthorityOtherDiv) {
          incidentLetterAuthority.addEventListener('change', () => {
            if (incidentLetterAuthority.value === 'Other') {
              incidentLetterAuthorityOtherDiv.style.display = 'block';
            } else {
              incidentLetterAuthorityOtherDiv.style.display = 'none';
            }
          });
        }
      }

      // Validation functions
      function validateCurrentStep() {
        console.log('✅ Validating step:', currentStep);
        
        if (currentStep === 1) {
          return validatePersonalInfo();
        } else if (currentStep === 2) {
          return validateFlightExperience();
        } else if (currentStep === 3) {
          return validateDocumentation();
        } else if (currentStep === 4) {
          return validateDeclaration();
        }
        
        return true;
      }
      
      function validatePersonalInfo() {
        const required = ['pilotName', 'designation', 'dateOfBirth', 'nationality', 'contactEmail', 'doj', 'countryCode', 'phoneNumber'];
        
        for (const fieldId of required) {
          const field = document.getElementById(fieldId);
          if (!field || !field.value.trim()) {
            alert(`Please fill in the ${fieldId.replace(/([A-Z])/g, ' $1').toLowerCase()}`);
            field?.focus();
            return false;
          }
        }
        
        // Email validation
        const email = document.getElementById('contactEmail');
        if (email && !email.checkValidity()) {
          alert('Please enter a valid email address');
          email.focus();
          return false;
        }
        
        return true;
      }
      
      function validateFlightExperience() {
        const sections = document.querySelectorAll('#sections .section');
        
        if (sections.length === 0) {
          alert('Please add at least one aircraft type section');
          return false;
        }
        
        // Validate each section has aircraft type and some flight hours
        for (const section of sections) {
          const aircraftType = section.querySelector('.ac-type');
          if (!aircraftType || !aircraftType.value) {
            alert('Please select an aircraft type for all sections');
            aircraftType?.focus();
            return false;
          }
          
          // Check if at least one time field has data
          const timeFields = section.querySelectorAll('.hhmm');
          let hasTime = false;
          timeFields.forEach(field => {
            if (field.value && field.value !== '0:00') {
              hasTime = true;
            }
          });
          
          if (!hasTime) {
            alert('Please enter flight hours for all aircraft type sections');
            return false;
          }
        }
        
        // Validate summary table
        const summaryInputs = document.querySelectorAll('.summary .hhmm');
        let hasSummaryData = false;
        summaryInputs.forEach(input => {
          if (input.value && input.value !== '0:00') {
            hasSummaryData = true;
          }
        });
        
        if (!hasSummaryData) {
          alert('Please complete the flying experience summary table');
          return false;
        }
        
        return true;
      }
      
      function validateDocumentation() {
        const requiredFields = [
          // Pilot License fields
          { id: 'licenseType', label: 'License Type' },
          { id: 'licenseNumber', label: 'License Number' },
          { id: 'licenseIssue', label: 'License Issue Date' },
          { id: 'licenseExpiry', label: 'License Expiry Date' },
          
          // Medical Certificate fields
          { id: 'medicalClass', label: 'Medical Class' },
          { id: 'medicalAuthority', label: 'Medical Authority' },
          { id: 'medicalIssue', label: 'Medical Issue Date' },
          { id: 'medicalExpiry', label: 'Medical Expiry Date' },
          
          // Passport fields
          { id: 'passportNumber', label: 'Passport Number' },
          { id: 'passportNationality', label: 'Passport Nationality' },
          { id: 'passportIssue', label: 'Passport Issue Date' },
          { id: 'passportExpiry', label: 'Passport Expiry Date' },
          
          // UAE Visa fields
          { id: 'visaStatus', label: 'Current Visa Status' }
        ];
        
        const requiredFiles = [
          { id: 'licenseFile', label: 'Pilot License Document' },
          { id: 'medicalFile', label: 'Medical Certificate' },
          { id: 'passportFile', label: 'Passport Copy' }
        ];
        
        // Validate required form fields
        for (const { id, label } of requiredFields) {
          const field = document.getElementById(id);
          
          // Skip visa fields if "No Current UAE Visa" is selected
          const visaStatus = document.getElementById('visaStatus')?.value;
          if (id === 'visaExpiry' && visaStatus === 'No Current UAE Visa') {
            continue; // Skip validation for this field
          }
          
          // Skip ROL fields if "Attached to License" is selected
          const rolType = document.getElementById('rolType')?.value;
          if ((id === 'rolNumber' || id === 'rolIssue' || id === 'rolExpiry' || id === 'rolAuthority') && rolType === 'Attached to License') {
            continue; // Skip validation for these fields
          }
          
          // Skip English fields if "Attached to License" is selected
          const englishTestType = document.getElementById('englishTestType')?.value;
          if ((id === 'englishTestDate' || id === 'englishExpiry') && englishTestType === 'Attached to License') {
            continue; // Skip validation for these fields
          }
          
          // Skip Emirates ID fields if "Do not have Emirates ID" is selected
          const emiratesIdStatus = document.getElementById('emiratesIdStatus')?.value;
          if ((id === 'emiratesIdNumber' || id === 'emiratesIdIssue' || id === 'emiratesIdExpiry') && emiratesIdStatus === 'Do not have Emirates ID') {
            continue; // Skip validation for these fields
          }
          
          if (!field || !field.value.trim()) {
            alert(`Please complete the ${label} field in the documentation section.`);
            field?.focus();
            return false;
          }
        }
        
        // Validate required file uploads
        for (const { id, label } of requiredFiles) {
          const fileInput = document.getElementById(id);
          
          // Skip visa file if "No Current UAE Visa" is selected
          const visaStatus = document.getElementById('visaStatus')?.value;
          if (id === 'visaFile' && visaStatus === 'No Current UAE Visa') {
            continue; // Skip validation for visa file
          }
          
          // Skip ROL file if "Attached to License" is selected
          const rolType = document.getElementById('rolType')?.value;
          if (id === 'rolFile' && rolType === 'Attached to License') {
            continue; // Skip validation for ROL file
          }
          
          // Skip English file if "Attached to License" is selected
          const englishTestType = document.getElementById('englishTestType')?.value;
          if (id === 'englishFile' && englishTestType === 'Attached to License') {
            continue; // Skip validation for English file
          }
          
          // Skip Emirates ID file if "Do not have Emirates ID" is selected
          const emiratesIdStatus = document.getElementById('emiratesIdStatus')?.value;
          if (id === 'emiratesIdFile' && emiratesIdStatus === 'Do not have Emirates ID') {
            continue; // Skip validation for Emirates ID file
          }
          
          if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
            alert(`Please upload the required ${label} document.`);
            fileInput?.focus();
            return false;
          }
        }
        
        // Validate "Other" fields are properly filled
        return validateOtherFields();
      }
      
      // Validation function to check if all "Other" fields are properly filled
      function validateOtherFields() {
        const otherFieldPairs = [
          {
            dropdown: document.getElementById('medicalAuthority'),
            textField: document.getElementById('medicalAuthorityOther'),
            label: 'Medical Authority'
          },
          {
            dropdown: document.getElementById('rolAuthority'),
            textField: document.getElementById('rolAuthorityOther'),
            label: 'ROL Authority'
          },
          {
            dropdown: document.getElementById('licenseVerificationAuthority'),
            textField: document.getElementById('licenseVerificationAuthorityOther'),
            label: 'License Verification Authority'
          },
          {
            dropdown: document.getElementById('incidentLetterAuthority'),
            textField: document.getElementById('incidentLetterAuthorityOther'),
            label: 'Incident Letter Authority'
          }
        ];
        
        for (const pair of otherFieldPairs) {
          if (pair.dropdown && pair.textField && pair.dropdown.value === 'Other') {
            if (!pair.textField.value.trim()) {
              alert(`Please specify the ${pair.label} since you selected "Other"`);
              pair.textField.focus();
              return false;
            }
          }
        }
        
        return true;
      }
      
      function validateDeclaration() {
        const declaration = document.getElementById('declaration');
        if (!declaration || !declaration.checked) {
          alert('Please read and accept the declaration');
          declaration?.focus();
          return false;
        }
        
        // Check if signature exists (either canvas, typed, or uploaded)
        const canvas = document.getElementById('sigCanvas');
        const typedSig = document.getElementById('typedSig');
        
        let hasSignature = false;
        
        // Check canvas signature
        if (canvas) {
          const ctx = canvas.getContext('2d');
          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const hasCanvasData = imageData.data.some(channel => channel !== 0);
          if (hasCanvasData) hasSignature = true;
        }
        
        // Check typed signature
        if (typedSig && typedSig.value.trim()) {
          hasSignature = true;
        }
        
        if (!hasSignature) {
          alert('Please provide a signature (draw, type, or upload)');
          return false;
        }
        
        return true;
      }

      // Generate review content
      function generateReviewContent() {
        console.log('📋 Generating review content...');
        
        collectFormData(); // Make sure we have latest data
        
        let html = '<div style="font-size: 14px; line-height: 1.6;">';
        
        // Personal Information
        if (formData.personalInfo) {
          const info = formData.personalInfo;
          html += `
            <h3 style="color: var(--flydubai-navy); margin-bottom: 16px;">👨‍✈️ Personal Information</h3>
            <div style="display: grid; gap: 12px; margin-bottom: 24px;">
              ${info.pilotName ? `<div><strong>Full Name:</strong> ${info.pilotName}</div>` : ''}
              ${info.designation ? `<div><strong>Position:</strong> ${info.designation}</div>` : ''}
              ${info.dateOfBirth ? `<div><strong>Date of Birth:</strong> ${info.dateOfBirth}</div>` : ''}
              ${info.nationality ? `<div><strong>Nationality:</strong> ${info.nationality}</div>` : ''}
              ${info.contactEmail ? `<div><strong>Email:</strong> ${info.contactEmail}</div>` : ''}
              ${info.doj ? `<div><strong>Date of Joining:</strong> ${info.doj}</div>` : ''}
              ${info.countryCode && info.phoneNumber ? `<div><strong>Phone:</strong> ${info.countryCode} ${info.phoneNumber}</div>` : ''}
            </div>
          `;
        }
        
        // Flight Experience
        if (formData.flightExperience && formData.flightExperience.aircraftSections) {
          html += `
            <h3 style="color: var(--flydubai-navy); margin-bottom: 16px;">✈️ Flight Experience</h3>
          `;
          
          formData.flightExperience.aircraftSections.forEach((section, index) => {
            html += `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px; margin-bottom: 12px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">${section.aircraftType}</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div><strong>PIC Total:</strong> ${section.flightHours?.picTotal || '0:00'}</div>
                  <div><strong>PIC Block:</strong> ${section.flightHours?.picBlock || '0:00'}</div>
                  <div><strong>SIC Total:</strong> ${section.flightHours?.sicTotal || '0:00'}</div>
                  <div><strong>SIC Block:</strong> ${section.flightHours?.sicBlock || '0:00'}</div>
                  <div><strong>Multi-Pilot:</strong> ${section.flightHours?.multiPilot || '0:00'}</div>
                  <div><strong>Night:</strong> ${section.flightHours?.night || '0:00'}</div>
                  ${section.notes ? `<div><strong>Notes:</strong> ${section.notes}</div>` : ''}
                </div>
              </div>
            `;
          });
        }
        
        // Documentation Summary
        if (formData.documentation) {
          const docs = formData.documentation;
          html += `
            <h3 style="color: var(--flydubai-navy); margin-bottom: 16px;">📄 Documentation</h3>
            <div style="display: grid; gap: 16px; margin-bottom: 24px;">
              <!-- Pilot License -->
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🛂 Pilot License</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  ${docs.licenseType ? `<div><strong>Type:</strong> ${docs.licenseType}</div>` : ''}
                  ${docs.licenseNumber ? `<div><strong>Number:</strong> ${docs.licenseNumber}</div>` : ''}
                  ${docs.licenseExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.licenseExpiry)}</div>` : ''}
                </div>
              </div>
              
              <!-- Medical Certificate -->
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🏥 Medical Certificate</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  ${docs.medicalClass ? `<div><strong>Class:</strong> ${docs.medicalClass}</div>` : ''}
                  ${docs.medicalAuthority ? `<div><strong>Authority:</strong> ${docs.medicalAuthority}</div>` : ''}
                  ${docs.medicalExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.medicalExpiry)}</div>` : ''}
                </div>
              </div>
              
              <!-- Radio Operator License -->
              ${docs.rolType && docs.rolType !== 'Attached to License' ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">📻 Radio Operator License</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div><strong>Type:</strong> ${docs.rolType}</div>
                  ${docs.rolNumber ? `<div><strong>Number:</strong> ${docs.rolNumber}</div>` : ''}
                  ${docs.rolAuthority ? `<div><strong>Authority:</strong> ${docs.rolAuthority}</div>` : ''}
                  ${docs.rolExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.rolExpiry)}</div>` : ''}
                </div>
              </div>
              ` : docs.rolType === 'Attached to License' ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">📻 Radio Operator License</h4>
                <div style="color: #16a34a; font-weight: 500;">✅ Attached to Pilot License</div>
              </div>
              ` : ''}
              
              <!-- English Proficiency -->
              ${docs.englishLevel ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🌐 English Proficiency</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div><strong>Level:</strong> ${docs.englishLevel}</div>
                  ${docs.englishTestType && docs.englishTestType !== 'Attached to License' ? `<div><strong>Test Type:</strong> ${docs.englishTestType}</div>` : ''}
                  ${docs.englishTestType === 'Attached to License' ? `<div style="color: #16a34a; font-weight: 500;">✅ Attached to License</div>` : ''}
                  ${docs.englishExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.englishExpiry)}</div>` : ''}
                </div>
              </div>
              ` : ''}
              
              <!-- Emirates ID -->
              ${docs.emiratesIdStatus && docs.emiratesIdStatus !== 'Do not have Emirates ID' ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🆔 Emirates ID</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div><strong>Status:</strong> ${docs.emiratesIdStatus}</div>
                  ${docs.emiratesIdNumber ? `<div><strong>Number:</strong> ${docs.emiratesIdNumber}</div>` : ''}
                  ${docs.emiratesIdExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.emiratesIdExpiry)}</div>` : ''}
                </div>
              </div>
              ` : docs.emiratesIdStatus === 'Do not have Emirates ID' ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🆔 Emirates ID</h4>
                <div style="color: #64748b; font-style: italic;">Not currently available</div>
              </div>
              ` : ''}
              
              <!-- Passport -->
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">📘 Passport</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  ${docs.passportNumber ? `<div><strong>Number:</strong> ${docs.passportNumber}</div>` : ''}
                  ${docs.passportNationality ? `<div><strong>Nationality:</strong> ${docs.passportNationality}</div>` : ''}
                  ${docs.passportExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.passportExpiry)}</div>` : ''}
                </div>
              </div>
              
              <!-- UAE Visa -->
              ${docs.visaStatus && docs.visaStatus !== 'No Current UAE Visa' ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🛂 UAE Visa</h4>
                <div style="display: grid; gap: 8px; font-size: 13px;">
                  <div><strong>Status:</strong> ${docs.visaStatus}</div>
                  ${docs.visaExpiry ? `<div><strong>Expiry:</strong> ${toDDMMMYYYY(docs.visaExpiry)}</div>` : ''}
                </div>
              </div>
              ` : docs.visaStatus === 'No Current UAE Visa' ? `
              <div style="background: #f8fafc; padding: 16px; border-radius: 8px;">
                <h4 style="margin: 0 0 12px; color: var(--flydubai-blue);">🛂 UAE Visa</h4>
                <div style="color: #64748b; font-style: italic;">No current UAE visa</div>
              </div>
              ` : ''}
            </div>
          `;
        }
        
        html += '</div>';
        
        const reviewContent = document.getElementById('reviewContent');
        if (reviewContent) {
          reviewContent.innerHTML = html;
        }
      }

      // Collect form data
      function collectFormData() {
        console.log('📊 Collecting form data...');
        
        // Step 1: Personal Information
        formData.personalInfo = {
          pilotName: document.getElementById('pilotName')?.value || '',
          designation: document.getElementById('designation')?.value || '',
          dateOfBirth: document.getElementById('dateOfBirth')?.value || '',
          nationality: document.getElementById('nationality')?.value || '',
          contactEmail: document.getElementById('contactEmail')?.value || '',
          doj: document.getElementById('doj')?.value || '',
          countryCode: document.getElementById('countryCode')?.value || '',
          phoneNumber: document.getElementById('phoneNumber')?.value || ''
        };
        
        // Step 2: Flight Experience
        const sections = document.querySelectorAll('#sections .section');
        const aircraftSections = [];
        
        sections.forEach(section => {
          const aircraftType = section.querySelector('.ac-type')?.value || '';
          const notes = section.querySelector('.ac-notes')?.value || '';
          
          const timeInputs = section.querySelectorAll('.hhmm');
          const dateInputs = section.querySelectorAll('.date-inp');
          
          if (aircraftType) {
            const sectionData = {
              aircraftType: aircraftType,
              notes: notes,
              flightHours: {
                picTotal: timeInputs[0]?.value || '0:00',
                picBlock: timeInputs[1]?.value || '0:00',
                sicTotal: timeInputs[2]?.value || '0:00',
                sicBlock: timeInputs[3]?.value || '0:00',
                multiPilot: timeInputs[4]?.value || '0:00',
                night: timeInputs[5]?.value || '0:00'
              },
              dates: {
                picFrom: dateInputs[0]?.value || '',
                picTo: dateInputs[1]?.value || '',
                sicFrom: dateInputs[2]?.value || '',
                sicTo: dateInputs[3]?.value || ''
              }
            };
            
            aircraftSections.push(sectionData);
          }
        });
        
        // Collect summary hours
        const summaryInputs = document.querySelectorAll('.summary .hhmm');
        const summaryHours = {};
        if (summaryInputs.length >= 9) {
          summaryHours.pic = summaryInputs[0]?.value || '0:00';
          summaryHours.sic = summaryInputs[1]?.value || '0:00';
          summaryHours.solo = summaryInputs[2]?.value || '0:00';
          summaryHours.instrument = summaryInputs[3]?.value || '0:00';
          summaryHours.sim = summaryInputs[4]?.value || '0:00';
          summaryHours.night = summaryInputs[5]?.value || '0:00';
          summaryHours.instructor = summaryInputs[6]?.value || '0:00';
          summaryHours.p1us = summaryInputs[7]?.value || '0:00';
          summaryHours.grandTotal = summaryInputs[8]?.value || '0:00';
        }
        
        formData.flightExperience = {
          aircraftSections: aircraftSections,
          summaryHours: summaryHours
        };
        
        // Step 3: Documentation
        formData.documentation = {
          // Pilot License
          licenseType: document.getElementById('licenseType')?.value || '',
          licenseNumber: document.getElementById('licenseNumber')?.value || '',
          licenseIssue: document.getElementById('licenseIssue')?.value || '',
          licenseExpiry: document.getElementById('licenseExpiry')?.value || '',
          licenseFile: document.getElementById('licenseFile')?.files[0]?.name || '',
          
          // Medical Certificate
          medicalClass: document.getElementById('medicalClass')?.value || '',
          medicalAuthority: document.getElementById('medicalAuthority')?.value || '',
          medicalIssue: document.getElementById('medicalIssue')?.value || '',
          medicalExpiry: document.getElementById('medicalExpiry')?.value || '',
          medicalFile: document.getElementById('medicalFile')?.files[0]?.name || '',
          
          // Radio Operator License (ROL)
          rolType: document.getElementById('rolType')?.value || '',
          rolNumber: document.getElementById('rolNumber')?.value || '',
          rolIssue: document.getElementById('rolIssue')?.value || '',
          rolExpiry: document.getElementById('rolExpiry')?.value || '',
          rolAuthority: document.getElementById('rolAuthority')?.value || '',
          rolAuthorityOther: document.getElementById('rolAuthorityOther')?.value || '',
          rolFile: document.getElementById('rolFile')?.files[0]?.name || '',
          
          // English Proficiency Certificate
          englishLevel: document.getElementById('englishLevel')?.value || '',
          englishTestType: document.getElementById('englishTestType')?.value || '',
          englishTestDate: document.getElementById('englishTestDate')?.value || '',
          englishExpiry: document.getElementById('englishExpiry')?.value || '',
          englishFile: document.getElementById('englishFile')?.files[0]?.name || '',
          
          // License Verification Letter
          licenseVerificationAuthority: document.getElementById('licenseVerificationAuthority')?.value || '',
          licenseVerificationAuthorityOther: document.getElementById('licenseVerificationAuthorityOther')?.value || '',
          licenseVerificationDate: document.getElementById('licenseVerificationDate')?.value || '',
          licenseVerificationFile: document.getElementById('licenseVerificationFile')?.files[0]?.name || '',
          
          // No Incident/Accident Letter
          incidentLetterAuthority: document.getElementById('incidentLetterAuthority')?.value || '',
          incidentLetterAuthorityOther: document.getElementById('incidentLetterAuthorityOther')?.value || '',
          incidentLetterDate: document.getElementById('incidentLetterDate')?.value || '',
          incidentLetterFile: document.getElementById('incidentLetterFile')?.files[0]?.name || '',
          
          // Flight Hours Verification Letter
          flightHoursAuthority: document.getElementById('flightHoursAuthority')?.value || '',
          flightHoursIssue: document.getElementById('flightHoursIssue')?.value || '',
          flightHoursFile: document.getElementById('flightHoursFile')?.files[0]?.name || '',
          
          // Emirates ID
          emiratesIdStatus: document.getElementById('emiratesIdStatus')?.value || '',
          emiratesIdNumber: document.getElementById('emiratesIdNumber')?.value || '',
          emiratesIdIssue: document.getElementById('emiratesIdIssue')?.value || '',
          emiratesIdExpiry: document.getElementById('emiratesIdExpiry')?.value || '',
          emiratesIdFile: document.getElementById('emiratesIdFile')?.files[0]?.name || '',
          
          // Passport
          passportNumber: document.getElementById('passportNumber')?.value || '',
          passportNationality: document.getElementById('passportNationality')?.value || '',
          passportIssue: document.getElementById('passportIssue')?.value || '',
          passportExpiry: document.getElementById('passportExpiry')?.value || '',
          passportFile: document.getElementById('passportFile')?.files[0]?.name || '',
          
          // UAE Visa & Work Permit
          visaStatus: document.getElementById('visaStatus')?.value || '',
          visaExpiry: document.getElementById('visaExpiry')?.value || '',
          visaFile: document.getElementById('visaFile')?.files[0]?.name || ''
        };
        
        // Step 4: Declaration
        const canvas = document.getElementById('sigCanvas');
        let signatureData = null;
        if (canvas) {
          signatureData = canvas.toDataURL();
        }
        
        formData.declaration = {
          agreed: document.getElementById('declaration')?.checked || false,
          signatureDate: document.getElementById('sigDate')?.value || '',
          typedSignature: document.getElementById('typedSig')?.value || '',
          signatureData: signatureData
        };
      }

      // Save form data to localStorage
      function saveFormData() {
        collectFormData();
        
        try {
          const saveData = {
            formData: formData,
            currentStep: currentStep,
            sessionId: generateSessionId(),
            lastSaved: Date.now(),
            expiresAt: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
          };
          
          localStorage.setItem('pilotFormData', JSON.stringify(saveData));
          showAutoSaveStatus('Saved', 'saved');
        } catch (error) {
          console.error('Error saving form data:', error);
          showAutoSaveStatus('Error saving', 'error');
        }
      }

      // Load form data from localStorage
      function loadFormData() {
        try {
          const savedData = localStorage.getItem('pilotFormData');
          if (!savedData) return false;
          
          const data = JSON.parse(savedData);
          
          // Check if data hasn't expired
          if (Date.now() >= data.expiresAt) {
            localStorage.removeItem('pilotFormData');
            return false;
          }
          
          formData = data.formData || {};
          
          return true;
        } catch (error) {
          console.error('Error loading form data:', error);
          localStorage.removeItem('pilotFormData');
          return false;
        }
      }

      // Populate form fields with saved data
      function populateFormFields() {
        console.log('📝 Populating form fields...');
        
        // Step 1: Personal Information
        if (formData.personalInfo) {
          const info = formData.personalInfo;
          const personalFields = [
            'pilotName', 'designation', 'dateOfBirth', 'nationality',
            'contactEmail', 'doj', 'countryCode', 'phoneNumber'
          ];
          
          personalFields.forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element && info[fieldId]) {
              element.value = info[fieldId];
            }
          });
        }
        
        // Step 2: Flight Experience
        if (formData.flightExperience) {
          const flightExp = formData.flightExperience;
          
          // Populate summary hours
          if (flightExp.summaryHours) {
            const summaryInputs = document.querySelectorAll('.summary .hhmm');
            if (summaryInputs.length >= 9) {
              summaryInputs[0].value = flightExp.summaryHours.pic || '0:00';
              summaryInputs[1].value = flightExp.summaryHours.sic || '0:00';
              summaryInputs[2].value = flightExp.summaryHours.solo || '0:00';
              summaryInputs[3].value = flightExp.summaryHours.instrument || '0:00';
              summaryInputs[4].value = flightExp.summaryHours.sim || '0:00';
              summaryInputs[5].value = flightExp.summaryHours.night || '0:00';
              summaryInputs[6].value = flightExp.summaryHours.instructor || '0:00';
              summaryInputs[7].value = flightExp.summaryHours.p1us || '0:00';
              summaryInputs[8].value = flightExp.summaryHours.grandTotal || '0:00';
            }
          }
          
          // Note: Aircraft sections are recreated during initialization
          // so their data is populated when they're created
        }
        
        // Step 3: Documentation
        if (formData.documentation) {
          const docs = formData.documentation;
          const docFields = [
            // Pilot License
            'licenseType', 'licenseNumber', 'licenseIssue', 'licenseExpiry',
            // Medical Certificate  
            'medicalClass', 'medicalAuthority', 'medicalIssue', 'medicalExpiry',
            // Radio Operator License (ROL)
            'rolType', 'rolNumber', 'rolIssue', 'rolExpiry', 'rolAuthority', 'rolAuthorityOther',
            // English Proficiency Certificate
            'englishLevel', 'englishTestType', 'englishTestDate', 'englishExpiry',
            // License Verification Letter
            'licenseVerificationAuthority', 'licenseVerificationAuthorityOther', 'licenseVerificationDate',
            // No Incident/Accident Letter
            'incidentLetterAuthority', 'incidentLetterAuthorityOther', 'incidentLetterDate',
            // Flight Hours Verification Letter
            'flightHoursAuthority', 'flightHoursIssue',
            // Emirates ID
            'emiratesIdStatus', 'emiratesIdNumber', 'emiratesIdIssue', 'emiratesIdExpiry',
            // Passport
            'passportNumber', 'passportNationality', 'passportIssue', 'passportExpiry',
            // UAE Visa & Work Permit
            'visaStatus', 'visaExpiry'
          ];
          
          docFields.forEach(fieldId => {
            const element = document.getElementById(fieldId);
            if (element && docs[fieldId]) {
              element.value = docs[fieldId];
            }
          });
          
          // Trigger conditional field visibility after populating values
          if (docs.rolType) window.toggleROLFields();
          if (docs.englishTestType) window.toggleEnglishTestDate();
          if (docs.emiratesIdStatus) window.toggleEmiratesIdFields();
        }
        
        // Step 4: Declaration
        if (formData.declaration) {
          const decl = formData.declaration;
          
          const sigDate = document.getElementById('sigDate');
          if (sigDate && decl.signatureDate) {
            sigDate.value = decl.signatureDate;
          }
          
          const typedSig = document.getElementById('typedSig');
          if (typedSig && decl.typedSignature) {
            typedSig.value = decl.typedSignature;
          }
          
          // Restore signature canvas if data exists
          if (decl.signatureData) {
            const canvas = document.getElementById('sigCanvas');
            if (canvas) {
              const ctx = canvas.getContext('2d');
              const img = new Image();
              img.onload = function() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(img, 0, 0);
              };
              img.src = decl.signatureData;
            }
          }
        }
      }

      // Auto-save status
      function showAutoSaveStatus(message, type = 'saved') {
        const statusEl = document.getElementById('autoSaveStatus');
        if (statusEl) {
          statusEl.textContent = message;
          statusEl.style.display = 'block';
          statusEl.style.background = type === 'error' ? '#fef2f2' : '#f0fdf4';
          statusEl.style.color = type === 'error' ? '#dc2626' : '#059669';
          
          setTimeout(() => {
            statusEl.style.display = 'none';
          }, 2000);
        }
      }

      // Setup auto-save
      function setupAutoSave() {
        setInterval(() => {
          saveFormData();
        }, 30000); // Save every 30 seconds
      }

      // Check for recovery
      function checkForRecovery() {
        const hasData = localStorage.getItem('pilotFormData');
        if (hasData) {
          const banner = document.getElementById('recoveryBanner');
          if (banner) {
            banner.classList.add('show');
          }
        }
      }

      // Recovery functions
      window.recoverSession = function() {
        const hasData = loadFormData();
        if (hasData) {
          populateFormFields();
          showAutoSaveStatus('Session recovered', 'saved');
        }
        const banner = document.getElementById('recoveryBanner');
        if (banner) {
          banner.classList.remove('show');
        }
      };

      window.clearSession = function() {
        localStorage.removeItem('pilotFormData');
        const banner = document.getElementById('recoveryBanner');
        if (banner) {
          banner.classList.remove('show');
        }
        showAutoSaveStatus('Session cleared', 'saved');
      };

      // Utility functions
      function generateSessionId() {
        return Date.now().toString(36) + Math.random().toString(36).substr(2);
      }

      // Date validation
      function checkValidity(docType) {
        const today = new Date();
        const expiryInput = document.getElementById(docType + 'Expiry');
        const statusDiv = document.getElementById(docType + 'Status');
        const dojInput = document.getElementById('doj');
        
        if (!expiryInput || !expiryInput.value || !statusDiv) return;
        
        const expiryDate = new Date(expiryInput.value);
        const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
        
        statusDiv.innerHTML = '';
        
        // Check if document expires before today
        if (daysUntilExpiry < 0) {
          statusDiv.innerHTML = '<span class="status-indicator status-expired">EXPIRED</span>';
          return;
        }
        
        // Check validity against joining date if available
        if (dojInput && dojInput.value) {
          const joiningDate = new Date(dojInput.value);
          const daysAfterJoining = Math.ceil((expiryDate - joiningDate) / (1000 * 60 * 60 * 24));
          
          // Passport must be valid for at least 6 months (180 days) after joining
          if (docType === 'passport' && daysAfterJoining < 180) {
            statusDiv.innerHTML = '<span class="status-indicator status-expired">EXPIRES TOO SOON AFTER JOINING (Need 6+ months)</span>';
            return;
          }
          
          // License, Medical, ROL must be valid for at least 90 days after joining
          if (['license', 'medical', 'rol'].includes(docType) && daysAfterJoining < 90) {
            statusDiv.innerHTML = '<span class="status-indicator status-expired">EXPIRES TOO SOON AFTER JOINING (Need 90+ days)</span>';
            return;
          }
        }
        
        // Emirates ID and UAE Visa only need to be valid at submission (no DOJ requirement)
        // They are handled by the basic expiry check only
        
        // English Proficiency - only validate if not "Attached to License"
        if (docType === 'english') {
          const englishTestType = document.getElementById('englishTestType')?.value;
          if (englishTestType === 'Attached to License') {
            statusDiv.innerHTML = '<span class="status-indicator status-valid">ATTACHED TO LICENSE</span>';
            return;
          }
        }
        
        // Show appropriate status message
        if (daysUntilExpiry <= 30) {
          statusDiv.innerHTML = `<span class="status-indicator status-warning">EXPIRES IN ${daysUntilExpiry} DAYS</span>`;
        } else if (daysUntilExpiry <= 90) {
          statusDiv.innerHTML = `<span class="status-indicator status-caution">EXPIRES IN ${daysUntilExpiry} DAYS</span>`;
        } else {
          statusDiv.innerHTML = `<span class="status-indicator status-valid">VALID (${daysUntilExpiry} days remaining)</span>`;
        }
      }

      // Submit form
      async function submitForm() {
        console.log('📨 === SUBMITTING FORM ===');
        
        // Show loading state
        const nextBtn = document.getElementById('nextBtn');
        const originalText = nextBtn.textContent;
        nextBtn.textContent = 'Submitting...';
        nextBtn.disabled = true;
        
        try {
          // Collect current form data before submission
          collectFormData();
          
          // Prepare form data with files
          const formDataToSubmit = new FormData();
          
          // Log form data size for debugging
          const formDataJSON = JSON.stringify(formData);
          console.log('📊 Form data size:', (formDataJSON.length / 1024).toFixed(2) + ' KB');
          console.log('📊 Form data keys:', Object.keys(formData));
          
          // Add all form fields
          formDataToSubmit.append('formData', formDataJSON);
          
          // Add all uploaded files with size logging
          const fileInputs = document.querySelectorAll('input[type="file"]');
          let totalFileSize = 0;
          fileInputs.forEach(input => {
            if (input.files && input.files[0]) {
              const file = input.files[0];
              totalFileSize += file.size;
              formDataToSubmit.append(input.id, file);
              console.log(`📎 Added file: ${input.id} - ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
            }
          });
          console.log('📊 Total file size:', (totalFileSize / 1024).toFixed(2) + ' KB');
          
          console.log('🚀 Sending form data to server...');
          
          // Submit to API
          const response = await fetch('/api/submit-form', {
            method: 'POST',
            body: formDataToSubmit
          });
          
          const result = await response.json();
          
          console.log('📬 Server response:', {
            ok: response.ok,
            status: response.status,
            result: result
          });
          
          if (response.ok) {
            console.log('✅ Form submitted successfully');
            showSubmissionSuccess(result);
            
            // Clear saved data after successful submit
            localStorage.removeItem('pilotFormData');
            
          } else {
            console.error('❌ Form submission failed:', result);
            showDetailedSubmissionError(response.status, result, formDataJSON, totalFileSize);
          }
          
        } catch (error) {
          console.error('❌ Network error during submission:', error);
          showNetworkError(error, JSON.stringify(formData), 0);
        } finally {
          // Reset button state
          nextBtn.textContent = originalText;
          nextBtn.disabled = false;
        }
      }
      
      function showSubmissionSuccess(result) {
        const successHtml = `
          <div style="max-width: 600px; margin: 40px auto; padding: 32px; background: white; border-radius: 12px; box-shadow: var(--shadow); text-align: center;">
            <div style="color: #16a34a; font-size: 48px; margin-bottom: 16px;">✅</div>
            <h2 style="color: var(--flydubai-navy); margin-bottom: 16px;">Application Submitted Successfully!</h2>
            <p style="color: var(--muted); margin-bottom: 24px; line-height: 1.6;">
              Your pilot documentation application has been submitted to flydubai Flight Operations. 
              You will receive a confirmation email shortly with your application details and next steps.
            </p>
            ${result.submissionId ? `
              <div style="background: #f0f9ff; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                <strong>Application ID:</strong> ${result.submissionId}
              </div>
            ` : ''}
            <button onclick="location.reload()" style="background: var(--flydubai-blue); color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
              Submit Another Application
            </button>
          </div>
        `;
        
        document.body.innerHTML = successHtml;
      }
      
      function showDetailedSubmissionError(status, result, formDataJSON, totalFileSize) {
        alert(`Submission failed with status ${status}. Please check your internet connection and try again. If the problem persists, contact support.`);
      }
      
      function showNetworkError(error, formDataJSON, totalFileSize) {
        alert(`Network error during submission: ${error.message}. Please check your internet connection and try again.`);
      }

      // Initialize signature date to today
      const sigDateElement = document.getElementById('sigDate');
      if (sigDateElement) {
        sigDateElement.value = new Date().toISOString().split('T')[0];
      }

      // Initialize signature functionality
      (function initSignature(){
        const canvas = document.getElementById('sigCanvas');
        if(!canvas) return;
        
        const ctx = canvas.getContext('2d');
        
        function setupCanvas(){
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          const rect = canvas.getBoundingClientRect();
          const canvasWidth = rect.width > 0 ? rect.width : 300;
          canvas.width = canvasWidth * ratio;
          canvas.height = 150 * ratio;
          ctx.setTransform(ratio,0,0,ratio,0,0);
          ctx.lineWidth = 2;
          ctx.lineJoin='round';
          ctx.lineCap='round';
          ctx.strokeStyle = '#111827';
        }
        
        function clearCanvas(){
          ctx.clearRect(0,0,canvas.width,canvas.height);
        }
        
        function pos(e){
          const r = canvas.getBoundingClientRect();
          const p = e.touches ? e.touches[0] : e;
          return {x: p.clientX - r.left, y: p.clientY - r.top};
        }
        
        let drawing = false, lastX = 0, lastY = 0;
        
        function start(e){
          drawing = true;
          const p = pos(e);
          lastX = p.x;
          lastY = p.y;
          e.preventDefault();
        }
        
        function move(e){
          if(!drawing) return;
          const p = pos(e);
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(p.x, p.y);
          ctx.stroke();
          lastX = p.x;
          lastY = p.y;
          e.preventDefault();
        }
        
        function end(){
          drawing = false;
        }
        
        setupCanvas();
        window.addEventListener('resize', setupCanvas);
        
        // Mouse events
        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mousemove', move);
        window.addEventListener('mouseup', end);
        
        // Touch events
        canvas.addEventListener('touchstart', start, {passive:false});
        canvas.addEventListener('touchmove', move, {passive:false});
        window.addEventListener('touchend', end);

        // Clear button
        const clearBtn = document.getElementById('sigClear');
        if (clearBtn) {
          clearBtn.addEventListener('click', clearCanvas);
        }

        // Apply typed signature
        const applyBtn = document.getElementById('sigApply');
        if (applyBtn) {
          applyBtn.addEventListener('click', () => {
            const txt = document.getElementById('typedSig')?.value?.trim();
            if(!txt) return;
            clearCanvas();
            ctx.font = '24px cursive';
            ctx.fillStyle = '#111827';
            const metrics = ctx.measureText(txt);
            const cssW = canvas.getBoundingClientRect().width;
            const x = Math.max(10, (cssW - metrics.width)/2);
            ctx.fillText(txt, x, 80);
          });
        }

        // Upload signature
        const uploadBtn = document.getElementById('sigUpload');
        if (uploadBtn) {
          uploadBtn.addEventListener('change', (ev) => {
            const file = ev.target.files && ev.target.files[0];
            if(!file) return;
            const img = new Image();
            img.onload = () => {
              clearCanvas();
              const cssW = canvas.getBoundingClientRect().width;
              const cssH = 150;
              const scale = Math.min(cssW*0.9 / img.width, cssH*0.9 / img.height);
              const w = img.width * scale;
              const h = img.height * scale;
              const x = (cssW - w)/2;
              const y = (cssH - h)/2;
              ctx.drawImage(img, x, y, w, h);
            };
            img.src = URL.createObjectURL(file);
          });
        }
      })();

      // Make functions globally available
      window.nextStep = nextStep;
      window.previousStep = previousStep;
      window.removeSection = removeSection;

      // Initialize the form
      initializeForm();
      
      console.log('✅ Mobile form initialization complete');
    });
  </script>
</body>
</html>