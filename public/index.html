<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>flydubai Pilot Onboarding System</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    :root{ 
      /* flydubai Official Brand Colors */
      --bg: linear-gradient(135deg, #6d28d9 0%, #7c3aed 12%, #8b5cf6 25%, #a855f7 37%, #c084fc 50%, #6366f1 62%, #8b5cf6 75%, #9333ea 87%, #7c3aed 100%);
      --card: #ffffff; 
      --ink: #0f172a; 
      --muted: #64748b; 
      --accent: #3b82f6; 
      --accent-light: #60a5fa;
      --line: #e2e8f0; 
      --flydubai-blue: #3b82f6;
      --flydubai-orange: #f97316;
      --flydubai-navy: #1e3a8a;
      --flydubai-light-blue: #dbeafe;
      --aviation-silver: #94a3b8;
      --success: #059669;
      --warning: #d97706;
      --expired: #dc2626;
      --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4), 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    * { box-sizing: border-box; }
    
    html, body {
      height: 100%;
      scroll-behavior: smooth;
      margin: 0;
      padding: 0;
    }
    
    body {
      background: var(--bg);
      background-attachment: fixed;
      background-size: 100% 100vh;
      color: var(--ink);
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      line-height: 1.6;
      font-weight: 400;
      min-height: 100vh;
    }
    
    .container {
      max-width: 1200px;
      margin: 12px auto;
      padding: 12px;
    }
    
    .card {
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: 24px;
      box-shadow: var(--shadow);
      overflow: hidden;
      position: relative;
      margin-bottom: 12px;
    }
    
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 50%, var(--flydubai-blue) 100%);
    }
    
    /* Header */
    .header {
      padding: 16px 40px;
      border-bottom: 2px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 30%, #f8fafc 70%, #f1f5f9 100%);
      position: relative;
      min-height: 100px;
    }
    
    .header .logo {
      width: 400px;
      height: 80px;
      background-image: url('Flydubai-Logo.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: left center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: var(--flydubai-navy);
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      line-height: 1.2;
      text-align: center;
    }
    
    /* Progress Bar */
    .progress-container {
      padding: 16px 40px;
      background: #f8fafc;
      border-bottom: 1px solid var(--line);
    }
    
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e2e8f0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 16px;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 100%);
      border-radius: 4px;
      transition: width 0.3s ease;
      width: 0%;
    }
    
    .progress-steps {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      font-weight: 500;
    }
    
    .step {
      display: flex;
      align-items: center;
      color: var(--muted);
    }
    
    .step.active {
      color: var(--flydubai-blue);
      font-weight: 600;
    }
    
    .step.completed {
      color: var(--success);
    }
    
    .step-number {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--line);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: 700;
      margin-right: 8px;
    }
    
    .step.active .step-number {
      background: var(--flydubai-blue);
    }
    
    .step.completed .step-number {
      background: var(--success);
    }
    
    /* Form Steps */
    .form-step {
      display: none;
      padding: 24px;
      animation: fadeIn 0.3s ease;
    }
    
    .form-step.active {
      display: block;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .step-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--flydubai-navy);
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .step-subtitle {
      font-size: 16px;
      color: var(--muted);
      margin-bottom: 20px;
      line-height: 1.5;
    }
    
    /* Form Elements */
    .form-grid {
      display: grid;
      gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      margin-bottom: 20px;
    }
    
    .form-section {
      margin-bottom: 32px;
      padding: 24px;
      background: #fafbfc;
      border: 1px solid var(--line);
      border-radius: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
    }
    
    .form-section:hover {
      border-color: var(--flydubai-blue);
      box-shadow: 0 4px 8px rgba(59, 130, 246, 0.1);
    }
    
    /* Add visual divider between document sections */
    .form-section:not(:last-child)::after {
      content: '';
      position: absolute;
      bottom: -16px;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 2px;
      background: linear-gradient(90deg, transparent, var(--flydubai-orange), transparent);
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--flydubai-navy);
      margin-bottom: 8px;
      padding-bottom: 4px;
      border-bottom: 2px solid var(--line);
    }
    
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 14px;
      color: var(--flydubai-navy);
      letter-spacing: 0.025em;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 14px 16px;
      border-radius: 12px;
      border: 2px solid var(--line);
      background: #ffffff;
      color: var(--ink);
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      transition: all 0.2s ease-in-out;
      font-family: inherit;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--flydubai-blue);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }

    /* Date picker specific styling for personal information */
    .form-step[data-step="1"] input[type="date"] {
      width: 200px !important;
      cursor: pointer;
      position: relative;
    }

    /* Make the entire date input clickable - personal information specific */
    .form-step[data-step="1"] input[type="date"]::-webkit-calendar-picker-indicator {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: auto;
      height: auto;
      color: transparent;
      background: transparent;
      cursor: pointer;
    }

    /* Firefox date picker styling - personal information specific */
    .form-step[data-step="1"] input[type="date"]::-moz-calendar-picker-indicator {
      cursor: pointer;
    }

    /* Universal date picker styling - make all date inputs clickable anywhere */
    input[type="date"] {
      cursor: pointer;
      position: relative;
    }

    /* Make the entire date input clickable for all date fields */
    input[type="date"]::-webkit-calendar-picker-indicator {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: auto;
      height: auto;
      color: transparent;
      background: transparent;
      cursor: pointer;
    }

    /* Firefox date picker styling for all date fields */
    input[type="date"]::-moz-calendar-picker-indicator {
      cursor: pointer;
    }

    /* Ensure consistent field widths in personal information section */
    /* Column 1: Full name and Email (300px) */
    .form-step[data-step="1"] #pilotName,
    .form-step[data-step="1"] #contactEmail {
      width: 300px !important;
      box-sizing: border-box;
    }

    /* Column 2: Date of Birth and Date of Joining (180px) */
    .form-step[data-step="1"] #dateOfBirth,
    .form-step[data-step="1"] #doj {
      width: 180px !important;
      box-sizing: border-box;
    }

    /* Column 3: Designation and Country Code (220px) */
    .form-step[data-step="1"] #designation,
    .form-step[data-step="1"] #countryCode {
      width: 220px !important;
      box-sizing: border-box;
    }

    /* Column 4: Nationality and Phone Number (280px) */
    .form-step[data-step="1"] #nationality,
    .form-step[data-step="1"] #phoneNumber {
      width: 280px !important;
      box-sizing: border-box;
    }
    
    .required {
      color: var(--expired);
    }
    
    /* File Upload */
    .upload-area {
      border: 2px dashed var(--line);
      border-radius: 12px;
      padding: 32px;
      text-align: center;
      background: #f8fafc;
      transition: all 0.2s ease;
      cursor: pointer;
    }
    
    .upload-area:hover {
      border-color: var(--flydubai-blue);
      background: var(--flydubai-light-blue);
    }
    
    .upload-area.dragover {
      border-color: var(--flydubai-orange);
      background: #fef3f2;
    }
    
    .upload-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }
    
    .file-list {
      margin-top: 16px;
    }
    
    .file-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: white;
      border: 1px solid var(--line);
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    .file-info {
      display: flex;
      align-items: center;
    }
    
    .file-icon {
      margin-right: 12px;
      font-size: 20px;
    }
    
    .file-details {
      flex: 1;
    }
    
    .file-name {
      font-weight: 500;
      margin-bottom: 2px;
    }
    
    .file-size {
      font-size: 12px;
      color: var(--muted);
    }
    
    .file-status {
      display: flex;
      align-items: center;
      font-size: 12px;
      font-weight: 500;
    }
    
    .file-status.uploading {
      color: var(--warning);
    }
    
    .file-status.completed {
      color: var(--success);
    }
    
    .file-status.error {
      color: var(--expired);
    }
    
    /* Buttons */
    .btn {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid var(--line);
      padding: 12px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.025em;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: inherit;
    }
    
    .btn:hover {
      border-color: var(--flydubai-blue);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .btn.primary {
      background: linear-gradient(135deg, var(--flydubai-blue) 0%, var(--accent-light) 100%);
      border-color: var(--flydubai-blue);
      color: #ffffff;
      font-weight: 700;
    }
    
    .btn.primary:hover {
      box-shadow: 0 6px 20px rgba(30, 64, 175, 0.4);
    }
    
    .btn.secondary {
      background: linear-gradient(135deg, var(--flydubai-orange) 0%, #fb923c 100%);
      border-color: var(--flydubai-orange);
      color: #ffffff;
      font-weight: 700;
    }
    
    .btn.secondary:hover {
      box-shadow: 0 6px 20px rgba(249, 115, 22, 0.4);
    }
    
    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
    
    /* Navigation */
    .form-navigation {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 24px 40px;
      border-top: 1px solid var(--line);
      background: #f8fafc;
    }
    
    .nav-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .nav-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .auto-save-status {
      font-size: 12px;
      color: var(--muted);
      display: flex;
      align-items: center;
    }
    
    .auto-save-status.saving {
      color: var(--warning);
    }
    
    .auto-save-status.saved {
      color: var(--success);
    }
    
    /* Recovery Banner */
    .recovery-banner {
      background: linear-gradient(135deg, #fef3f2 0%, #fee2e2 100%);
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 16px 20px;
      margin-bottom: 24px;
      display: none;
    }
    
    .recovery-banner.show {
      display: block;
    }
    
    .recovery-content {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .recovery-message {
      display: flex;
      align-items: center;
      font-weight: 500;
      color: var(--expired);
    }
    
    .recovery-actions {
      display: flex;
      gap: 12px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        margin: 10px;
        padding: 10px;
      }
      
      .header {
        padding: 16px 20px;
        flex-direction: column;
        text-align: center;
      }
      
      .header h1 {
        position: static;
        transform: none;
        margin-top: 12px;
      }
      
      .header .logo {
        width: 280px;
        height: 56px;
      }
      
      .form-step {
        padding: 20px;
      }
      
      .form-navigation {
        padding: 16px 20px;
        flex-direction: column;
        gap: 16px;
      }
      
      .nav-left, .nav-right {
        width: 100%;
        justify-content: center;
      }
      
      .form-grid {
        grid-template-columns: 1fr;
      }
      
      .progress-steps {
        font-size: 10px;
      }
      
      .step-number {
        width: 16px;
        height: 16px;
        font-size: 8px;
      }
    }
    
    /* Loading States */
    .loading {
      opacity: 0.6;
      pointer-events: none;
    }
    
    .spinner {
      border: 2px solid #f3f3f3;
      border-top: 2px solid var(--flydubai-blue);
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 1s linear infinite;
      margin-right: 8px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Original Form Specific Styles */
    .section {
      margin-bottom: 30px;
    }

    .section table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 20px;
      background: white;
    }

    .section table th,
    .section table td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
      vertical-align: middle;
    }

    .section table th {
      background-color: var(--flydubai-blue);
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    .section table tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    .section table input[type="text"],
    .section table input[type="date"],
    .section table select {
      width: 100%;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 13px;
      box-shadow: none;
      transform: none;
    }

    .section table input[type="text"]:focus,
    .section table input[type="date"]:focus,
    .section table select:focus {
      border-color: var(--flydubai-blue);
      box-shadow: 0 0 3px rgba(59, 130, 246, 0.2);
      transform: none;
    }

    .footer-fields {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
      padding: 15px;
      background-color: #f0f8ff;
      border-radius: 8px;
      border: 1px solid var(--line);
    }

    .footer-field {
      flex: 1;
      min-width: 200px;
    }

    .footer-field label {
      display: block;
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--flydubai-navy);
      font-size: 14px;
    }

    .footer-field input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      box-shadow: none;
      transform: none;
    }

    .footer-field input:focus {
      border-color: var(--flydubai-blue);
      box-shadow: 0 0 3px rgba(59, 130, 246, 0.2);
      transform: none;
    }

    .heavy-jet-indicator {
      display: inline-block;
      background-color: #28a745;
      color: white;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
      margin-left: 10px;
      vertical-align: middle;
    }

    .other-notes {
      margin-top: 10px;
      display: none;
    }

    .other-notes input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
      box-shadow: none;
      transform: none;
    }

    .other-notes input:focus {
      border-color: var(--flydubai-blue);
      box-shadow: 0 0 3px rgba(59, 130, 246, 0.2);
      transform: none;
    }

    .aircraft-section {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #f9f9f9;
    }

    .aircraft-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
    }

    .aircraft-header h4 {
      margin: 0;
      color: var(--flydubai-navy);
      font-size: 16px;
    }

    .remove-aircraft {
      background: #dc2626;
      color: white;
      border: none;
      padding: 4px 8px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-left: auto;
    }

    .remove-aircraft:hover {
      background: #b91c1c;
    }

    /* Original form styles from flighttimeexpform.html */
    .section-h {
      font-size: 18px;
      font-weight: 600;
      color: var(--flydubai-navy);
      margin-bottom: 16px;
      border-bottom: 2px solid var(--flydubai-blue);
      padding-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .grand{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin: 16px 0;
    }

    .kpi{
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid var(--line);
      padding: 16px 20px;
      border-radius: 16px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      position: relative;
      overflow: hidden;
      font-size: 16px;
      font-weight: 500;
      color: var(--flydubai-navy);
    }
    
    .kpi::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: var(--flydubai-orange);
    }
    
    .kpi b{
      font-size: 20px;
      font-weight: 700;
      color: var(--flydubai-blue);
      font-family: 'Courier New', monospace;
      display: block;
      margin-top: 4px;
    }

    .footer-fields{
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .footer-fields label{
      font-weight: 700;
      text-align: center;
      color: var(--flydubai-navy);
      margin-bottom: 12px;
    }
    
    .date-cell{
      display: flex;
      align-items: center;
      gap: 8px;
      justify-content: center;
    }
    
    .date-print{
      display: none;
      padding: 10px 16px;
      border: 2px dashed var(--line);
      border-radius: 12px;
      color: var(--flydubai-navy);
      font-weight: 600;
      background: #f8fafc;
    }

    h2.section-h{
      margin: 0 0 20px 0;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: -0.025em;
      color: var(--flydubai-navy);
      text-transform: uppercase;
      position: relative;
      padding: 16px 24px;
      background: linear-gradient(135deg, #e0f2fe 0%, #f0f9ff 100%);
      border-left: 4px solid var(--flydubai-blue);
      border-radius: 8px;
      margin-left: -24px;
      margin-right: -24px;
      margin-top: -24px;
      margin-bottom: 24px;
    }
    

    h3.section-h{
      margin: 12px 0 8px;
      font-size: 16px;
      font-weight: 600;
      color: var(--flydubai-navy);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .summary {
      margin: 20px 0;
      padding: 16px;
      background: linear-gradient(135deg, #fefefe 0%, #f9fafb 100%);
      border-radius: 16px;
      border: 2px solid var(--line);
    }

    .summary table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 16px;
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 8px;
    }
    
    .status-valid {
      background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      color: white;
    }
    
    .status-expired {
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      color: white;
    }
    
    .status-warning {
      background: linear-gradient(135deg, #d97706 0%, #fbbf24 100%);
      color: white;
    }

    .requirement-note {
      background: linear-gradient(135deg, #fef7ed 0%, #fed7aa 100%);
      border: 2px solid var(--flydubai-orange);
      border-radius: 12px;
      padding: 16px;
      margin-top: 16px;
      font-size: 13px;
      font-weight: 500;
      color: var(--flydubai-navy);
      line-height: 1.5;
    }

    .requirement-note::before {
      content: "üìã ";
      font-weight: 700;
      margin-right: 4px;
    }

    /* Complete original form styling from flighttimeexpform.html */
    .ac-notes.required-empty {
      border-color: #dc2626 !important;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
    }

    .validation-error {
      border-color: #dc2626 !important;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
    }

    .error-message {
      color: #dc2626;
      font-size: 12px;
      font-weight: 500;
      margin-top: 4px;
      display: block;
    }

    .section{
      border: 2px solid var(--line);
      border-radius: 20px;
      padding: 20px;
      margin-top: 16px;
      background: linear-gradient(135deg, #ffffff 0%, #fafbff 100%);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      position: relative;
      overflow: hidden;
    }
    
    .section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--flydubai-blue) 0%, var(--flydubai-orange) 100%);
    }
    
    .section-title{
      display: flex;
      align-items: center;
      gap: 16px;
      justify-content: space-between;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid var(--line);
    }
    
    .section-title h3{
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--flydubai-navy);
      letter-spacing: -0.025em;
    }

    .form-step[data-step="2"] table{
      width: 100% !important;
      border-collapse: collapse !important;
      margin-top: 20px !important;
      margin-bottom: 20px !important;
      table-layout: fixed !important;
      background: #ffffff !important;
      border-radius: 16px !important;
      overflow: hidden !important;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1) !important;
    }
    
    .form-step[data-step="2"] th, .form-step[data-step="2"] td{
      border: 1px solid #ddd !important;
      border-bottom: 1px solid var(--line) !important;
      padding: 16px 12px !important;
      vertical-align: middle !important;
      text-align: center !important;
    }
    
    .form-step[data-step="2"] th{
      font-size: 14px !important;
      font-weight: 700 !important;
      text-transform: uppercase !important;
      letter-spacing: 0.05em !important;
      text-align: center !important;
      background: linear-gradient(135deg, var(--flydubai-blue) 0%, var(--flydubai-navy) 100%) !important;
      color: #ffffff !important;
      position: relative;
      padding: 20px 12px !important;
      line-height: 1.3;
      vertical-align: middle !important;
    }

    .form-step[data-step="2"] .flight-role {
      font-size: 16px;
      font-weight: 700;
      text-align: center;
      color: var(--flydubai-navy);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 18px 16px;
      vertical-align: middle;
    }
    
    .form-step[data-step="2"] th:first-child {
      border-top-left-radius: 16px;
    }
    
    .form-step[data-step="2"] th:last-child {
      border-top-right-radius: 16px;
    }
    
    .form-step[data-step="2"] th b{
      font-weight: 700;
      display: block;
      margin-bottom: 2px;
    }
    
    .form-step[data-step="2"] tbody tr:hover {
      background-color: rgba(30, 58, 138, 0.02);
    }
    
    .form-step[data-step="2"] .hhmm{
      width: 96px;
      max-width: 100%;
      display: block;
      margin: 0 auto;
      text-align: center;
      font-weight: 600;
      font-family: 'Courier New', monospace;
    }
    
    .form-step[data-step="2"] td input[type="text"].hhmm{
      width: 96px !important;
      padding: 10px 8px !important;
      font-family: 'Courier New', monospace !important;
      font-weight: 600 !important;
      text-align: center !important;
      border: 3px solid #cbd5e1 !important;
      border-radius: 12px !important;
      background: #ffffff !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), inset 0 1px 3px rgba(0, 0, 0, 0.05) !important;
      transform: none !important;
    }
    
    /* Enhanced focus styling for time fields - matching original */
    .form-step[data-step="2"] td input[type="text"].hhmm:focus{
      border: 3px solid var(--flydubai-blue) !important;
      box-shadow: 0 0 15px rgba(59, 130, 246, 0.4) !important;
      outline: none !important;
    }
    
    /* Time field hover effect - matching original */
    .form-step[data-step="2"] td input[type="text"].hhmm:hover{
      border-color: var(--flydubai-light-blue) !important;
    }
    
    .form-step[data-step="2"] td input[type="date"]{
      width: 150px !important;
      display: block !important;
      margin: 0 auto !important;
      text-align: center !important;
      padding: 10px 8px !important;
      border: 3px solid #cbd5e1 !important;
      border-radius: 12px !important;
      background: #ffffff !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), inset 0 1px 3px rgba(0, 0, 0, 0.05) !important;
      transform: none !important;
    }

    .form-step[data-step="2"] td input[type="text"],
    .form-step[data-step="2"] td input[type="date"],
    .form-step[data-step="2"] td select {
      width: 100% !important;
      padding: 10px 8px !important;
      border: 3px solid #cbd5e1 !important;
      border-radius: 12px !important;
      font-size: 14px !important;
      background: #ffffff !important;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15), inset 0 1px 3px rgba(0, 0, 0, 0.05) !important;
      transform: none !important;
    }

    .grid {
      display: grid;
      gap: 24px;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      align-items: start;
    }
    
    .controls {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      margin-top: 20px;
      justify-content: center;
    }
    
    .btn {
      background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
      border: 2px solid var(--line);
      padding: 14px 24px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.025em;
      transition: all 0.2s ease-in-out;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--ink);
    }
    
    .btn:hover {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .summary table th,
    .summary table td {
      border: 1px solid #ddd;
      padding: 12px 8px;
      text-align: center;
      vertical-align: middle;
    }

    .summary table th {
      background-color: var(--flydubai-blue);
      color: white;
      font-weight: bold;
      font-size: 14px;
    }

    .summary table input[type="text"] {
      width: 80px;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      text-align: center;
      font-size: 13px;
    }

    .controls.no-print {
      text-align: center;
      margin: 16px 0;
    }

    .controls.no-print .btn {
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    /* Specific styling for remove button */
    .btn.warn, .btn[data-remove-section] {
      padding: 6px 16px !important;
      font-size: 12px !important;
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%) !important;
      border-color: #fca5a5 !important;
      color: #dc2626 !important;
    }

    .btn.warn:hover, .btn[data-remove-section]:hover {
      background: linear-gradient(135deg, #fecaca 0%, #f87171 100%) !important;
      border-color: #f87171 !important;
      box-shadow: 0 4px 12px rgba(220, 38, 38, 0.3) !important;
    }
    /* Signature section */
    #signSection .sig-pad{ 
      border: 2px dashed var(--flydubai-red);
      border-radius: 16px;
      background: #fff;
      padding: 16px;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    #sigCanvas{ 
      width: 100%;
      height: 160px;
      background: #fff;
      border-radius: 8px;
      cursor: crosshair;
    }
    
    #sigControls{ 
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    @media print{ #sigControls{ display:none !important } }

    .btn.warn {
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      border-color: #dc2626;
      color: white;
      font-weight: 700;
    }

    .btn.warn:hover {
      box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
    }

    /* limit signature date width so it doesn't reach signature pad */
    #signSection #sigDate{ max-width:180px }
    
    /* Signature section grid override */
    #signSection .grid{
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }
    /* Initially hide all content until password is verified */
    .content-container {
      display: none;
    }
    
    .password-protecting {
      display: block;
    }
  </style>
</head>
<body style="margin: 0; padding: 0;">
  <script>
    // ===== Password Protection =====
    // Check if this is an authenticated reload (temporary session flag)
    const urlParams = new URLSearchParams(window.location.search);
    let isAuthenticated = urlParams.has('authenticated');
    
    console.log('üîê Password Protection Status:', isAuthenticated ? 'AUTHENTICATED' : 'REQUIRES PASSWORD');
    
    if (!isAuthenticated) {
      // Check for session recovery data immediately
      setTimeout(() => {
        const hasSessionData = localStorage.getItem('formData') || localStorage.getItem('aircraftSections');
        if (hasSessionData) {
          console.log('üìã Previous session data detected');
          window.hasSessionToRecover = true;
        }
        
        // Clear content and show password form
        document.body.innerHTML = '';
        document.body.style.margin = '0';
        document.body.style.padding = '0';
      }, 10);
    } else {
      // Clean URL after authentication
      window.history.replaceState({}, document.title, window.location.pathname);
    }
    
    (function() {
      if (isAuthenticated) return; // Skip password form if already authenticated
      
      const FORM_PASSWORD = "FlightTime2025";
      let attempts = 0; // Reset attempts on each visit
      const maxAttempts = 3;
      
      function showPasswordForm() {
        const errorMessage = attempts > 0 ? `<div style="color: #dc2626; margin-bottom: 16px; padding: 12px; background: #fef2f2; border-radius: 8px; border: 1px solid #fecaca;">
          <strong>Incorrect access code.</strong> ${maxAttempts - attempts} attempt(s) remaining.
        </div>` : '';
        
        const sessionRecoveryMessage = window.hasSessionToRecover ? `<div style="color: #059669; margin-bottom: 16px; padding: 12px; background: #ecfdf5; border-radius: 8px; border: 1px solid #a7f3d0;">
          <div style="display: flex; align-items: center; margin-bottom: 8px;">
            <span style="font-size: 18px;">üìã</span>
            <span style="margin-left: 8px; font-weight: 600;">Previous session found!</span>
          </div>
          <div style="font-size: 14px;">Your previous form data will be restored after authentication.</div>
        </div>` : '';
        
        document.body.innerHTML = `
          <div style="display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg, #6d28d9 0%, #7c3aed 12%, #8b5cf6 25%, #a855f7 37%, #c084fc 50%, #6366f1 62%, #8b5cf6 75%, #9333ea 87%, #7c3aed 100%); padding: 20px;">
            <div style="background: white; padding: 40px; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4); width: 100%; max-width: 400px;">
              <div style="text-align: center; margin-bottom: 32px;">
                <h2 style="color: #7c3aed; margin-bottom: 12px; font-size: 28px; font-weight: 700;">Access Code Required</h2>
                <p style="color: #6b7280; margin: 0;">Enter your access code to continue to the pilot application form.</p>
              </div>
              
              ${sessionRecoveryMessage}
              ${errorMessage}
              
              <form id="passwordForm" style="display: flex; flex-direction: column; gap: 20px;">
                <div>
                  <label for="passwordInput" style="display: block; margin-bottom: 8px; color: #374151; font-weight: 600; font-size: 14px;">Access Code</label>
                  <input 
                    type="password" 
                    id="passwordInput" 
                    placeholder="Enter access code"
                    style="width: 100%; padding: 16px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 16px; transition: all 0.3s ease; box-sizing: border-box;"
                    onfocus="this.style.borderColor='#7c3aed'; this.style.boxShadow='0 0 0 3px rgba(124, 58, 237, 0.1)'"
                    onblur="this.style.borderColor='#e5e7eb'; this.style.boxShadow='none'"
                    required
                  />
                </div>
                <button 
                  type="submit" 
                  style="background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%); color: white; border: none; padding: 16px 32px; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 16px; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 0.5px;"
                  onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 25px -5px rgba(124, 58, 237, 0.4)'"
                  onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                >
                  Access Form
                </button>
              </form>
            </div>
          </div>
        `;
        
        // Focus on the password input
        setTimeout(() => {
          const passwordInput = document.getElementById('passwordInput');
          if (passwordInput) passwordInput.focus();
        }, 100);
        
        // Handle form submission
        const passwordForm = document.getElementById('passwordForm');
        if (passwordForm) {
          passwordForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userPassword = document.getElementById('passwordInput')?.value;
            
            if (userPassword === FORM_PASSWORD) {
              // Reload page with authenticated parameter
              const newUrl = window.location.pathname + '?authenticated=true';
              window.location.href = newUrl;
              
            } else {
              attempts++;
              if (attempts >= maxAttempts) {
                document.body.innerHTML = `
                  <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);">
                    <div style="text-align: center; background: white; padding: 40px; border-radius: 20px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.4);">
                      <h2 style="color: #dc2626; margin-bottom: 20px; font-size: 28px; font-weight: 700;">Access Denied</h2>
                      <p style="color: #6b7280; margin-bottom: 20px;">Too many incorrect attempts. Please contact your administrator for the correct access code.</p>
                      <p style="color: #6b7280; font-size: 14px;">Contact: jason.cameron@flydubai.com</p>
                    </div>
                  </div>
                `;
              } else {
                showPasswordForm();
              }
            }
          });
        }
      }
      
      // Show password form after session check
      setTimeout(() => {
        showPasswordForm();
      }, 50);
    })();
  </script>

  <div class="container">
    <div class="card">
      <!-- Header -->
      <div class="header">
        <div class="logo"></div>
        <h1>Pilot Onboarding System</h1>
      </div>

      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-steps">
          <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <span>Personal Info</span>
          </div>
          <div class="step" data-step="2">
            <div class="step-number">2</div>
            <span>Flight Experience</span>
          </div>
          <div class="step" data-step="3">
            <div class="step-number">3</div>
            <span>Documentation</span>
          </div>
          <div class="step" data-step="4">
            <div class="step-number">4</div>
            <span>Review & Submit</span>
          </div>
        </div>
      </div>

      <!-- Recovery Banner -->
      <div class="recovery-banner" id="recoveryBanner">
        <div class="recovery-content">
          <div class="recovery-message">
            <span>üìã</span>
            <span style="margin-left: 8px;">Previous session found. Would you like to continue where you left off?</span>
          </div>
          <div class="recovery-actions">
            <button class="btn" onclick="clearSession()">Start Fresh</button>
            <button class="btn primary" onclick="recoverSession()">Continue</button>
          </div>
        </div>
      </div>

      <!-- Step 1: Personal Information -->
      <div class="form-step active" data-step="1">
        <h2 class="step-title">üë®‚Äç‚úàÔ∏è Personal Information</h2>
        <p class="step-subtitle">Let's start with your basic information. All fields marked with <span class="required">*</span> are required.</p>
        
        <!-- Row 1: Name, Date of Birth, Designation, Nationality -->
        <div style="display: grid; gap: 20px; grid-template-columns: 300px 180px 220px 280px; margin-bottom: 20px;">
          <div>
            <label for="pilotName">Full Name <span class="required">*</span></label>
            <input id="pilotName" type="text" placeholder="e.g., Jane D. Pilot" required>
          </div>
          <div>
            <label for="dateOfBirth">Date of Birth <span class="required">*</span></label>
            <input id="dateOfBirth" type="date" required>
          </div>
          <div>
            <label for="designation">flydubai Designation <span class="required">*</span></label>
            <select id="designation" required>
              <option value="">Select‚Ä¶</option>
              <option>Captain</option>
              <option>First Officer</option>
              <option>Second Officer</option>
              <option>Cadet</option>
              <option>Ab-Initio</option>
            </select>
          </div>
          <div>
            <label for="nationality">Nationality <span class="required">*</span></label>
            <select id="nationality" required>
              <option value="">Select your nationality</option>
              <option value="AF">Afghanistan</option>
              <option value="AL">Albania</option>
              <option value="DZ">Algeria</option>
              <option value="AS">American Samoa</option>
              <option value="AD">Andorra</option>
              <option value="AO">Angola</option>
              <option value="AI">Anguilla</option>
              <option value="AQ">Antarctica</option>
              <option value="AG">Antigua and Barbuda</option>
              <option value="AR">Argentina</option>
              <option value="AM">Armenia</option>
              <option value="AW">Aruba</option>
              <option value="AU">Australia</option>
              <option value="AT">Austria</option>
              <option value="AZ">Azerbaijan</option>
              <option value="BS">Bahamas</option>
              <option value="BH">Bahrain</option>
              <option value="BD">Bangladesh</option>
              <option value="BB">Barbados</option>
              <option value="BY">Belarus</option>
              <option value="BE">Belgium</option>
              <option value="BZ">Belize</option>
              <option value="BJ">Benin</option>
              <option value="BM">Bermuda</option>
              <option value="BT">Bhutan</option>
              <option value="BO">Bolivia</option>
              <option value="BA">Bosnia and Herzegovina</option>
              <option value="BW">Botswana</option>
              <option value="BV">Bouvet Island</option>
              <option value="BR">Brazil</option>
              <option value="IO">British Indian Ocean Territory</option>
              <option value="BN">Brunei Darussalam</option>
              <option value="BG">Bulgaria</option>
              <option value="BF">Burkina Faso</option>
              <option value="BI">Burundi</option>
              <option value="KH">Cambodia</option>
              <option value="CM">Cameroon</option>
              <option value="CA">Canada</option>
              <option value="CV">Cape Verde</option>
              <option value="KY">Cayman Islands</option>
              <option value="CF">Central African Republic</option>
              <option value="TD">Chad</option>
              <option value="CL">Chile</option>
              <option value="CN">China</option>
              <option value="CX">Christmas Island</option>
              <option value="CC">Cocos (Keeling) Islands</option>
              <option value="CO">Colombia</option>
              <option value="KM">Comoros</option>
              <option value="CG">Congo</option>
              <option value="CD">Congo, Democratic Republic</option>
              <option value="CK">Cook Islands</option>
              <option value="CR">Costa Rica</option>
              <option value="CI">Cote D'Ivoire</option>
              <option value="HR">Croatia</option>
              <option value="CU">Cuba</option>
              <option value="CY">Cyprus</option>
              <option value="CZ">Czech Republic</option>
              <option value="DK">Denmark</option>
              <option value="DJ">Djibouti</option>
              <option value="DM">Dominica</option>
              <option value="DO">Dominican Republic</option>
              <option value="EC">Ecuador</option>
              <option value="EG">Egypt</option>
              <option value="SV">El Salvador</option>
              <option value="GQ">Equatorial Guinea</option>
              <option value="ER">Eritrea</option>
              <option value="EE">Estonia</option>
              <option value="ET">Ethiopia</option>
              <option value="FK">Falkland Islands (Malvinas)</option>
              <option value="FO">Faroe Islands</option>
              <option value="FJ">Fiji</option>
              <option value="FI">Finland</option>
              <option value="FR">France</option>
              <option value="GF">French Guiana</option>
              <option value="PF">French Polynesia</option>
              <option value="TF">French Southern Territories</option>
              <option value="GA">Gabon</option>
              <option value="GM">Gambia</option>
              <option value="GE">Georgia</option>
              <option value="DE">Germany</option>
              <option value="GH">Ghana</option>
              <option value="GI">Gibraltar</option>
              <option value="GR">Greece</option>
              <option value="GL">Greenland</option>
              <option value="GD">Grenada</option>
              <option value="GP">Guadeloupe</option>
              <option value="GU">Guam</option>
              <option value="GT">Guatemala</option>
              <option value="GN">Guinea</option>
              <option value="GW">Guinea-Bissau</option>
              <option value="GY">Guyana</option>
              <option value="HT">Haiti</option>
              <option value="HM">Heard Island & Mcdonald Islands</option>
              <option value="VA">Holy See (Vatican City State)</option>
              <option value="HN">Honduras</option>
              <option value="HK">Hong Kong</option>
              <option value="HU">Hungary</option>
              <option value="IS">Iceland</option>
              <option value="IN">India</option>
              <option value="ID">Indonesia</option>
              <option value="IR">Iran, Islamic Republic Of</option>
              <option value="IQ">Iraq</option>
              <option value="IE">Ireland</option>
              <option value="IL">Israel</option>
              <option value="IT">Italy</option>
              <option value="JM">Jamaica</option>
              <option value="JP">Japan</option>
              <option value="JO">Jordan</option>
              <option value="KZ">Kazakhstan</option>
              <option value="KE">Kenya</option>
              <option value="KI">Kiribati</option>
              <option value="KR">Korea</option>
              <option value="KW">Kuwait</option>
              <option value="KG">Kyrgyzstan</option>
              <option value="LA">Lao People's Democratic Republic</option>
              <option value="LV">Latvia</option>
              <option value="LB">Lebanon</option>
              <option value="LS">Lesotho</option>
              <option value="LR">Liberia</option>
              <option value="LY">Libyan Arab Jamahiriya</option>
              <option value="LI">Liechtenstein</option>
              <option value="LT">Lithuania</option>
              <option value="LU">Luxembourg</option>
              <option value="MO">Macao</option>
              <option value="MK">Macedonia</option>
              <option value="MG">Madagascar</option>
              <option value="MW">Malawi</option>
              <option value="MY">Malaysia</option>
              <option value="MV">Maldives</option>
              <option value="ML">Mali</option>
              <option value="MT">Malta</option>
              <option value="MH">Marshall Islands</option>
              <option value="MQ">Martinique</option>
              <option value="MR">Mauritania</option>
              <option value="MU">Mauritius</option>
              <option value="YT">Mayotte</option>
              <option value="MX">Mexico</option>
              <option value="FM">Micronesia, Federated States Of</option>
              <option value="MD">Moldova</option>
              <option value="MC">Monaco</option>
              <option value="MN">Mongolia</option>
              <option value="MS">Montserrat</option>
              <option value="MA">Morocco</option>
              <option value="MZ">Mozambique</option>
              <option value="MM">Myanmar</option>
              <option value="NA">Namibia</option>
              <option value="NR">Nauru</option>
              <option value="NP">Nepal</option>
              <option value="NL">Netherlands</option>
              <option value="AN">Netherlands Antilles</option>
              <option value="NC">New Caledonia</option>
              <option value="NZ">New Zealand</option>
              <option value="NI">Nicaragua</option>
              <option value="NE">Niger</option>
              <option value="NG">Nigeria</option>
              <option value="NU">Niue</option>
              <option value="NF">Norfolk Island</option>
              <option value="MP">Northern Mariana Islands</option>
              <option value="NO">Norway</option>
              <option value="OM">Oman</option>
              <option value="PK">Pakistan</option>
              <option value="PW">Palau</option>
              <option value="PS">Palestinian Territory, Occupied</option>
              <option value="PA">Panama</option>
              <option value="PG">Papua New Guinea</option>
              <option value="PY">Paraguay</option>
              <option value="PE">Peru</option>
              <option value="PH">Philippines</option>
              <option value="PN">Pitcairn</option>
              <option value="PL">Poland</option>
              <option value="PT">Portugal</option>
              <option value="PR">Puerto Rico</option>
              <option value="QA">Qatar</option>
              <option value="RE">Reunion</option>
              <option value="RO">Romania</option>
              <option value="RU">Russian Federation</option>
              <option value="RW">Rwanda</option>
              <option value="SH">Saint Helena</option>
              <option value="KN">Saint Kitts And Nevis</option>
              <option value="LC">Saint Lucia</option>
              <option value="PM">Saint Pierre And Miquelon</option>
              <option value="VC">Saint Vincent And Grenadines</option>
              <option value="WS">Samoa</option>
              <option value="SM">San Marino</option>
              <option value="ST">Sao Tome And Principe</option>
              <option value="SA">Saudi Arabia</option>
              <option value="SN">Senegal</option>
              <option value="CS">Serbia And Montenegro</option>
              <option value="SC">Seychelles</option>
              <option value="SL">Sierra Leone</option>
              <option value="SG">Singapore</option>
              <option value="SK">Slovakia</option>
              <option value="SI">Slovenia</option>
              <option value="SB">Solomon Islands</option>
              <option value="SO">Somalia</option>
              <option value="ZA">South Africa</option>
              <option value="GS">South Georgia And Sandwich Isl.</option>
              <option value="ES">Spain</option>
              <option value="LK">Sri Lanka</option>
              <option value="SD">Sudan</option>
              <option value="SR">Suriname</option>
              <option value="SJ">Svalbard And Jan Mayen</option>
              <option value="SZ">Swaziland</option>
              <option value="SE">Sweden</option>
              <option value="CH">Switzerland</option>
              <option value="SY">Syrian Arab Republic</option>
              <option value="TW">Taiwan</option>
              <option value="TJ">Tajikistan</option>
              <option value="TZ">Tanzania</option>
              <option value="TH">Thailand</option>
              <option value="TL">Timor-Leste</option>
              <option value="TG">Togo</option>
              <option value="TK">Tokelau</option>
              <option value="TO">Tonga</option>
              <option value="TT">Trinidad And Tobago</option>
              <option value="TN">Tunisia</option>
              <option value="TR">Turkey</option>
              <option value="TM">Turkmenistan</option>
              <option value="TC">Turks And Caicos Islands</option>
              <option value="TV">Tuvalu</option>
              <option value="UG">Uganda</option>
              <option value="UA">Ukraine</option>
              <option value="AE">United Arab Emirates</option>
              <option value="GB">United Kingdom</option>
              <option value="US">United States</option>
              <option value="UM">United States Outlying Islands</option>
              <option value="UY">Uruguay</option>
              <option value="UZ">Uzbekistan</option>
              <option value="VU">Vanuatu</option>
              <option value="VE">Venezuela</option>
              <option value="VN">Viet Nam</option>
              <option value="VG">Virgin Islands, British</option>
              <option value="VI">Virgin Islands, U.S.</option>
              <option value="WF">Wallis And Futuna</option>
              <option value="EH">Western Sahara</option>
              <option value="YE">Yemen</option>
              <option value="ZM">Zambia</option>
              <option value="ZW">Zimbabwe</option>
            </select>
          </div>
        </div>

        <!-- Row 2: Email, Date of Joining, Country Code, Phone -->
        <div style="display: grid; gap: 20px; grid-template-columns: 300px 180px 220px 280px; margin-bottom: 20px;">
          <div>
            <label for="contactEmail">Email Address <span class="required">*</span></label>
            <input id="contactEmail" type="email" placeholder="your.email@example.com" 
                   pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}" 
                   title="Please enter a valid email address (e.g., name@example.com)" 
                   required>
          </div>
          <div>
            <label for="doj">Date of Joining <span class="required">*</span></label>
            <input id="doj" type="date" required>
          </div>
          <div>
            <label for="countryCode">Country Code <span class="required">*</span></label>
            <select id="countryCode" required>
              <option value="">Select Code</option>
              <option value="+971">üá¶üá™ +971 UAE</option>
              <option value="+1">üá∫üá∏ +1 USA</option>
              <option value="+44">üá¨üáß +44 UK</option>
              <option value="+1">üá®üá¶ +1 Canada</option>
              <option value="+61">üá¶üá∫ +61 Australia</option>
              <option value="+49">üá©üá™ +49 Germany</option>
              <option value="+33">üá´üá∑ +33 France</option>
              <option value="+34">üá™üá∏ +34 Spain</option>
              <option value="+39">üáÆüáπ +39 Italy</option>
              <option value="+31">üá≥üá± +31 Netherlands</option>
              <option value="+46">üá∏üá™ +46 Sweden</option>
              <option value="+47">üá≥üá¥ +47 Norway</option>
              <option value="+45">üá©üá∞ +45 Denmark</option>
              <option value="+358">üá´üáÆ +358 Finland</option>
              <option value="+41">üá®üá≠ +41 Switzerland</option>
              <option value="+43">üá¶üáπ +43 Austria</option>
              <option value="+32">üáßüá™ +32 Belgium</option>
              <option value="+353">üáÆüá™ +353 Ireland</option>
              <option value="+351">üáµüáπ +351 Portugal</option>
              <option value="+30">üá¨üá∑ +30 Greece</option>
              <option value="+966">üá∏üá¶ +966 Saudi Arabia</option>
              <option value="+974">üá∂üá¶ +974 Qatar</option>
              <option value="+965">üá∞üáº +965 Kuwait</option>
              <option value="+973">üáßüá≠ +973 Bahrain</option>
              <option value="+968">üá¥üá≤ +968 Oman</option>
              <option value="+20">üá™üá¨ +20 Egypt</option>
              <option value="+962">üáØüá¥ +962 Jordan</option>
              <option value="+961">üá±üáß +961 Lebanon</option>
              <option value="+963">üá∏üáæ +963 Syria</option>
              <option value="+964">üáÆüá∂ +964 Iraq</option>
              <option value="+91">üáÆüá≥ +91 India</option>
              <option value="+92">üáµüá∞ +92 Pakistan</option>
              <option value="+880">üáßüá© +880 Bangladesh</option>
              <option value="+94">üá±üá∞ +94 Sri Lanka</option>
              <option value="+63">üáµüá≠ +63 Philippines</option>
              <option value="+62">üáÆüá© +62 Indonesia</option>
              <option value="+60">üá≤üáæ +60 Malaysia</option>
              <option value="+65">üá∏üá¨ +65 Singapore</option>
              <option value="+66">üáπüá≠ +66 Thailand</option>
              <option value="+84">üáªüá≥ +84 Vietnam</option>
              <option value="+86">üá®üá≥ +86 China</option>
              <option value="+81">üáØüáµ +81 Japan</option>
              <option value="+82">üá∞üá∑ +82 South Korea</option>
              <option value="+27">üáøüá¶ +27 South Africa</option>
              <option value="+234">üá≥üá¨ +234 Nigeria</option>
              <option value="+254">üá∞üá™ +254 Kenya</option>
              <option value="+251">üá™üáπ +251 Ethiopia</option>
              <option value="+233">üá¨üá≠ +233 Ghana</option>
              <option value="+212">üá≤üá¶ +212 Morocco</option>
              <option value="+55">üáßüá∑ +55 Brazil</option>
              <option value="+54">üá¶üá∑ +54 Argentina</option>
              <option value="+56">üá®üá± +56 Chile</option>
              <option value="+57">üá®üá¥ +57 Colombia</option>
              <option value="+52">üá≤üáΩ +52 Mexico</option>
              <option value="+58">üáªüá™ +58 Venezuela</option>
              <option value="+51">üáµüá™ +51 Peru</option>
              <option value="+593">üá™üá® +593 Ecuador</option>
              <option value="+64">üá≥üáø +64 New Zealand</option>
              <option value="+90">üáπüá∑ +90 Turkey</option>
              <option value="+98">üáÆüá∑ +98 Iran</option>
              <option value="+972">üáÆüá± +972 Israel</option>
            </select>
          </div>
          <div>
            <label for="phoneNumber">Phone Number <span class="required">*</span></label>
            <input id="phoneNumber" type="tel" placeholder="50 123 4567" required>
          </div>
        </div>
      </div>

      <!-- Step 2: Flight Experience -->
      <div class="form-step" data-step="2">
        <h2 class="section-h">Flight Experience by Aircraft Type</h2>
        <div id="sections"></div>
        <div class="controls no-print">
          <button class="btn" id="btnAddSection">+ Add another aircraft type</button>
        </div>

        <!-- Grand totals for all aircraft types -->
        <div class="section" id="grandTotals">
          <div class="section-title">
            <h3>GRAND TOTALS (All Aircraft Types)</h3>
          </div>
          <div class="grand">
            <div class="kpi">Combined Block Hours: <b id="gtCombined">0:00</b></div>
            <div class="kpi">Multi‚ÄëPilot Block Hours: <b id="gtMP">0:00</b></div>
            <div class="kpi">Night Hours: <b id="gtNight">0:00</b></div>
          </div>
        </div>

        <!-- SUMMARY SECTION -->
        <div class="summary">
          <h2 class="section-h">FLYING EXPERIENCE SUMMARY</h2>
          <h3 class="section-h" style="margin-top:6px">GENERAL</h3>
          <div class="section">
            <table>
              <thead>
                <tr>
                  <th><b>PIC/P1</b></th>
                  <th><b>SIC/P2</b></th>
                  <th><b>SOLO</b></th>
                  <th><b>INSTRUMENT</b></th>
                  <th><b>SIM</b></th>
                  <th><b>NIGHT</b></th>
                  <th><b>INSTRUCTOR</b></th>
                  <th><b>P1 U/S</b></th>
                  <th><b>GRAND TOTAL</b></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                  <td><input type="text" class="hhmm" placeholder="0:00"></td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Step 3: Documentation -->
      <div class="form-step" data-step="3">
        <div class="form-section">
          <h2 class="section-h">üõÇ Pilot License (ATPL/CPL/MPL)</h2>
          <div class="grid" style="grid-template-columns: 320px 200px 170px 170px;">
            <div>
              <label>License Type</label>
              <select id="licenseType">
                <option value="">Select License Type</option>
                <option value="ATPL">ATPL (Airline Transport Pilot License)</option>
                <option value="CPL">CPL (Commercial Pilot License)</option>
                <option value="MPL">MPL (Multi-Crew Pilot License)</option>
              </select>
            </div>
            <div>
              <label>License Number</label>
              <input type="text" id="licenseNumber" placeholder="Enter license number" />
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="licenseIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="licenseExpiry" onchange="checkValidity('license')" />
            </div>
          </div>
          <div class="grid" style="margin-top: 16px;">
            <div>
              <label>Upload Document</label>
              <input type="file" id="licenseFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div id="licenseStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Current valid pilot license (ATPL/CPL/MPL) with appropriate aircraft type ratings. License must be valid for the duration of employment and recognized by UAE GCAA or convertible to UAE license.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">üìª Radio Operator License</h2>
          <div class="grid" style="grid-template-columns: 250px 300px 170px 170px;">
            <div>
              <label>ROL Certificate Number</label>
              <input type="text" id="rolNumber" placeholder="Enter ROL certificate number" />
            </div>
            <div>
              <label>Issuing Radio Authority</label>
              <select id="rolAuthority">
                <option value="">Select Radio Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction G√©n√©rale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad A√©rea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Avia√ß√£o Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="AAC Austria">AAC (Austro Control - Austria)</option>
                <option value="DGAC Belgium">DGAC (Direction G√©n√©rale Transport A√©rien - Belgium)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Denmark">CAA Denmark (Danish Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Swedish Transport Agency)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority Norway)</option>
                <option value="CAA Finland">CAA Finland (Finnish Transport and Communications Agency)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (National Transport Authority)</option>
                <option value="CAA Romania">CAA Romania (Romanian Civil Aeronautical Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Administration)</option>
                <option value="CAA Greece">CAA Greece (Hellenic Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Croatian Civil Aviation Agency)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Agency)</option>
                <option value="CAA Slovakia">CAA Slovakia (Transport Authority)</option>
                <option value="CAA Russia">CAA Russia (Federal Air Transport Agency)</option>
                <option value="CAA Ukraine">CAA Ukraine (State Aviation Administration)</option>
                
                <!-- Americas -->
                <option value="TCCA Canada">TCCA (Transport Canada Civil Aviation)</option>
                <option value="ANAC Brazil">ANAC (Ag√™ncia Nacional de Avia√ß√£o Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administraci√≥n Nacional de Aviaci√≥n Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Direcci√≥n General de Aeron√°utica Civil - Chile)</option>
                <option value="UAEAC Colombia">UAEAC (Unidad Administrativa Especial de Aeron√°utica Civil - Colombia)</option>
                <option value="DGAC Ecuador">DGAC (Direcci√≥n General de Aviaci√≥n Civil - Ecuador)</option>
                <option value="DGAC Peru">DGAC (Direcci√≥n General de Aeron√°utica Civil - Peru)</option>
                <option value="DINAC Venezuela">DINAC (Instituto Nacional de Aeron√°utica Civil - Venezuela)</option>
                <option value="DGAC Mexico">DGAC (Direcci√≥n General de Aeron√°utica Civil - Mexico)</option>
                <option value="JCAA Jamaica">JCAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA South Africa">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Egypt">ECAA (Egyptian Civil Aviation Authority)</option>
                <option value="GACA Ghana">GACA (Ghana Civil Aviation Authority)</option>
                <option value="CCAA Ethiopia">CCAA (Ethiopian Civil Aviation Authority)</option>
                <option value="DGAC Morocco">DGAC (Direction G√©n√©rale de l'Aviation Civile - Morocco)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Other/Manual Entry -->
                <option value="Other">Other Radio Authority (Specify below)</option>
              </select>
              <div id="rolAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="rolAuthorityOther" placeholder="Please specify radio authority" />
              </div>
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="rolIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="rolExpiry" onchange="checkValidity('rol')" />
            </div>
          </div>
          <div class="grid" style="margin-top: 16px; grid-template-columns: 250px 300px 170px 170px;">
            <div>
              <label>Upload Document</label>
              <input type="file" id="rolFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div id="rolStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid Radio Operator License (ROL) certificate with appropriate endorsements for commercial aviation operations. Certificate must be current and recognized internationally.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">üåê English Proficiency Certificate (if applicable)</h2>
          <div class="grid">
            <div>
              <label>Proficiency Level</label>
              <select id="englishLevel">
                <option value="">Select ICAO Level</option>
                <option value="Level 4">Level 4 (Operational)</option>
                <option value="Level 5">Level 5 (Extended)</option>
                <option value="Level 6">Level 6 (Expert)</option>
              </select>
            </div>
            <div>
              <label>Test Type</label>
              <select id="englishTestType" onchange="toggleEnglishTestDate()">
                <option value="">Select Test Type</option>
                <option value="ICAO English Test">ICAO English Test</option>
                <option value="Aviation English Test">Aviation English Test</option>
                <option value="TEA (Test of English for Aviation)">TEA (Test of English for Aviation)</option>
                <option value="IELTS">IELTS (Academic)</option>
                <option value="Native Speaker">Native English Speaker</option>
                <option value="Attached to License">Attached to License (ELP Endorsement)</option>
                <option value="Other">Other Approved Test</option>
              </select>
            </div>
            <div id="englishTestDateDiv">
              <label>Test Date</label>
              <input type="date" id="englishTestDate" />
            </div>
            <div id="englishUploadDiv">
              <label>Upload Certificate</label>
              <input type="file" id="englishFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div class="requirement-note">
            <strong>Requirement:</strong> ICAO Level 4 or higher English proficiency certificate. Native English speakers may provide alternative documentation. Certificate must be current and valid for commercial aviation operations.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">üè• Medical Certificate</h2>
          <div class="grid" style="grid-template-columns: 250px 300px 170px 170px;">
            <div>
              <label>Medical Class</label>
              <select id="medicalClass">
                <option value="">Select Medical Class</option>
                <option value="Class 1">Class 1 Medical Certificate</option>
              </select>
            </div>
            <div>
              <label>Issuing Medical Authority</label>
              <select id="medicalAuthority">
                <option value="">Select Aviation Medical Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction G√©n√©rale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad A√©rea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Avia√ß√£o Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="AAC Austria">AAC (Austro Control - Austria)</option>
                <option value="DGAC Belgium">DGAC (Direction G√©n√©rale Transport A√©rien - Belgium)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Denmark">CAA Denmark (Danish Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Swedish Transport Agency)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority Norway)</option>
                <option value="CAA Finland">CAA Finland (Finnish Transport and Communications Agency)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (National Transport Authority)</option>
                <option value="CAA Romania">CAA Romania (Romanian Civil Aeronautical Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Administration)</option>
                <option value="CAA Greece">CAA Greece (Hellenic Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Croatian Civil Aviation Agency)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Agency)</option>
                <option value="CAA Slovakia">CAA Slovakia (Transport Authority)</option>
                <option value="CAA Russia">CAA Russia (Federal Air Transport Agency)</option>
                <option value="CAA Ukraine">CAA Ukraine (State Aviation Administration)</option>
                
                <!-- Americas -->
                <option value="TCCA Canada">TCCA (Transport Canada Civil Aviation)</option>
                <option value="ANAC Brazil">ANAC (Ag√™ncia Nacional de Avia√ß√£o Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administraci√≥n Nacional de Aviaci√≥n Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Direcci√≥n General de Aeron√°utica Civil - Chile)</option>
                <option value="UAEAC Colombia">UAEAC (Unidad Administrativa Especial de Aeron√°utica Civil - Colombia)</option>
                <option value="DGAC Ecuador">DGAC (Direcci√≥n General de Aviaci√≥n Civil - Ecuador)</option>
                <option value="DGAC Peru">DGAC (Direcci√≥n General de Aeron√°utica Civil - Peru)</option>
                <option value="DINAC Venezuela">DINAC (Instituto Nacional de Aeron√°utica Civil - Venezuela)</option>
                <option value="DGAC Mexico">DGAC (Direcci√≥n General de Aeron√°utica Civil - Mexico)</option>
                <option value="JCAA Jamaica">JCAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA South Africa">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Egypt">ECAA (Egyptian Civil Aviation Authority)</option>
                <option value="GACA Ghana">GACA (Ghana Civil Aviation Authority)</option>
                <option value="CCAA Ethiopia">CCAA (Ethiopian Civil Aviation Authority)</option>
                <option value="DGAC Morocco">DGAC (Direction G√©n√©rale de l'Aviation Civile - Morocco)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Other/Manual Entry -->
                <option value="Other">Other Aviation Medical Authority (Specify below)</option>
              </select>
              <div id="medicalAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="medicalAuthorityOther" placeholder="Please specify aviation medical authority" />
              </div>
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="medicalIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="medicalExpiry" onchange="checkValidity('medical')" />
            </div>
          </div>
          <div class="grid" style="margin-top: 16px; grid-template-columns: 250px 300px 170px 170px;">
            <div>
              <label>Upload Document</label>
              <input type="file" id="medicalFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div id="medicalStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid Class 1 medical certificate issued within the last 12 months. Must meet ICAO medical standards and be valid for commercial aviation operations. Class 2 medical certificates are not accepted.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">üìò Passport</h2>
          <div class="grid">
            <div>
              <label>Passport Number</label>
              <input type="text" id="passportNumber" placeholder="Enter passport number" />
            </div>
            <div>
              <label>Passport Nationality</label>
              <select id="passportNationality" style="width: 200px;">
                <option value="">Select Passport Nationality</option>
                <option value="American">American (USA)</option>
                <option value="British">British (UK)</option>
                <option value="Canadian">Canadian</option>
                <option value="Australian">Australian</option>
                <option value="German">German</option>
                <option value="French">French</option>
                <option value="Spanish">Spanish</option>
                <option value="Italian">Italian</option>
                <option value="Dutch">Dutch (Netherlands)</option>
                <option value="Swedish">Swedish</option>
                <option value="Norwegian">Norwegian</option>
                <option value="Danish">Danish</option>
                <option value="Finnish">Finnish</option>
                <option value="Swiss">Swiss</option>
                <option value="Austrian">Austrian</option>
                <option value="Belgian">Belgian</option>
                <option value="Irish">Irish</option>
                <option value="Portuguese">Portuguese</option>
                <option value="Greek">Greek</option>
                <option value="Emirati">Emirati (UAE)</option>
                <option value="Saudi">Saudi Arabian</option>
                <option value="Qatari">Qatari</option>
                <option value="Kuwaiti">Kuwaiti</option>
                <option value="Bahraini">Bahraini</option>
                <option value="Omani">Omani</option>
                <option value="Egyptian">Egyptian</option>
                <option value="Jordanian">Jordanian</option>
                <option value="Lebanese">Lebanese</option>
                <option value="Syrian">Syrian</option>
                <option value="Iraqi">Iraqi</option>
                <option value="Indian">Indian</option>
                <option value="Pakistani">Pakistani</option>
                <option value="Bangladeshi">Bangladeshi</option>
                <option value="Sri Lankan">Sri Lankan</option>
                <option value="Filipino">Filipino (Philippines)</option>
                <option value="Indonesian">Indonesian</option>
                <option value="Malaysian">Malaysian</option>
                <option value="Thai">Thai</option>
                <option value="Vietnamese">Vietnamese</option>
                <option value="Singaporean">Singaporean</option>
                <option value="South Korean">South Korean</option>
                <option value="Japanese">Japanese</option>
                <option value="Chinese">Chinese</option>
                <option value="Russian">Russian</option>
                <option value="Ukrainian">Ukrainian</option>
                <option value="Polish">Polish</option>
                <option value="Czech">Czech</option>
                <option value="Hungarian">Hungarian</option>
                <option value="Romanian">Romanian</option>
                <option value="Bulgarian">Bulgarian</option>
                <option value="Croatian">Croatian</option>
                <option value="Serbian">Serbian</option>
                <option value="Slovenian">Slovenian</option>
                <option value="Slovak">Slovak</option>
                <option value="South African">South African</option>
                <option value="Nigerian">Nigerian</option>
                <option value="Kenyan">Kenyan</option>
                <option value="Ethiopian">Ethiopian</option>
                <option value="Moroccan">Moroccan</option>
                <option value="Tunisian">Tunisian</option>
                <option value="Algerian">Algerian</option>
                <option value="Brazilian">Brazilian</option>
                <option value="Argentinian">Argentinian</option>
                <option value="Chilean">Chilean</option>
                <option value="Colombian">Colombian</option>
                <option value="Mexican">Mexican</option>
                <option value="Venezuelan">Venezuelan</option>
                <option value="Peruvian">Peruvian</option>
                <option value="Ecuadorian">Ecuadorian</option>
                <option value="New Zealand">New Zealand</option>
                <option value="Turkish">Turkish</option>
                <option value="Iranian">Iranian</option>
                <option value="Israeli">Israeli</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="passportIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="passportExpiry" onchange="checkValidity('passport')" />
            </div>
          </div>
          <div class="grid" style="margin-top: 16px; grid-template-columns: 250px 300px 170px 170px;">
            <div>
              <label>Upload Document</label>
              <input type="file" id="passportFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
            <div></div>
            <div></div>
          </div>
          <div id="passportStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid passport with minimum 6 months validity remaining after expected date of joining. Passport must have sufficient blank pages for visa stamps and be in good condition.
          </div>
        </div>


        <div class="form-section">
          <h2 class="section-h">üìã License Verification Letter</h2>
          <div class="grid">
            <div>
              <label>Issuing Aviation Authority</label>
              <select id="licenseVerificationAuthority">
                <option value="">Select Aviation Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction G√©n√©rale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad A√©rea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Avia√ß√£o Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="AAC Austria">AAC (Austro Control - Austria)</option>
                <option value="DGAC Belgium">DGAC (Direction G√©n√©rale Transport A√©rien - Belgium)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Denmark">CAA Denmark (Danish Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Swedish Transport Agency)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority Norway)</option>
                <option value="CAA Finland">CAA Finland (Finnish Transport and Communications Agency)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (National Transport Authority)</option>
                <option value="CAA Romania">CAA Romania (Romanian Civil Aeronautical Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Administration)</option>
                <option value="CAA Greece">CAA Greece (Hellenic Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Croatian Civil Aviation Agency)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Agency)</option>
                <option value="CAA Slovakia">CAA Slovakia (Transport Authority)</option>
                <option value="CAA Russia">CAA Russia (Federal Air Transport Agency)</option>
                <option value="CAA Ukraine">CAA Ukraine (State Aviation Administration)</option>
                
                <!-- Americas -->
                <option value="TCCA Canada">TCCA (Transport Canada Civil Aviation)</option>
                <option value="ANAC Brazil">ANAC (Ag√™ncia Nacional de Avia√ß√£o Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administraci√≥n Nacional de Aviaci√≥n Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Direcci√≥n General de Aeron√°utica Civil - Chile)</option>
                <option value="UAEAC Colombia">UAEAC (Unidad Administrativa Especial de Aeron√°utica Civil - Colombia)</option>
                <option value="DGAC Ecuador">DGAC (Direcci√≥n General de Aviaci√≥n Civil - Ecuador)</option>
                <option value="DGAC Peru">DGAC (Direcci√≥n General de Aeron√°utica Civil - Peru)</option>
                <option value="DINAC Venezuela">DINAC (Instituto Nacional de Aeron√°utica Civil - Venezuela)</option>
                <option value="DGAC Mexico">DGAC (Direcci√≥n General de Aeron√°utica Civil - Mexico)</option>
                <option value="JCAA Jamaica">JCAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA South Africa">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Egypt">ECAA (Egyptian Civil Aviation Authority)</option>
                <option value="GACA Ghana">GACA (Ghana Civil Aviation Authority)</option>
                <option value="CCAA Ethiopia">CCAA (Ethiopian Civil Aviation Authority)</option>
                <option value="DGAC Morocco">DGAC (Direction G√©n√©rale de l'Aviation Civile - Morocco)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Other/Manual Entry -->
                <option value="Other">Other Aviation Authority (Specify below)</option>
              </select>
              <div id="licenseVerificationAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="licenseVerificationAuthorityOther" placeholder="Please specify aviation authority" />
              </div>
            </div>
            <div>
              <label>Verification Letter Date</label>
              <input type="date" id="licenseVerificationDate" />
            </div>
            <div>
              <label>Upload Verification Letter</label>
              <input type="file" id="licenseVerificationFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
          </div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Official letter from the aviation authority that issued your license confirming its validity, ratings, and any restrictions. Required for license conversion to UAE GCAA license.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">‚úÖ No Incident/Accident Letter</h2>
          <div class="grid" style="grid-template-columns: 400px 170px 300px 250px;">
            <div>
              <label>Issuing Aviation Authority</label>
              <select id="incidentLetterAuthority">
                <option value="">Select Aviation Authority</option>
                <!-- Major International Authorities -->
                <option value="EASA">EASA (European Union Aviation Safety Agency)</option>
                <option value="FAA USA">FAA (Federal Aviation Administration - USA)</option>
                <option value="ICAO">ICAO (International Civil Aviation Organization)</option>
                
                <!-- Middle East & Gulf -->
                <option value="GCAA UAE">GCAA UAE (General Civil Aviation Authority)</option>
                <option value="GACA Saudi">GACA (General Authority of Civil Aviation - Saudi Arabia)</option>
                <option value="CAA Qatar">CAA Qatar (Civil Aviation Authority)</option>
                <option value="DGCA Kuwait">DGCA Kuwait (Directorate General of Civil Aviation)</option>
                <option value="CAA Bahrain">CAA Bahrain (Civil Aviation Affairs)</option>
                <option value="CAA Oman">CAA Oman (Civil Aviation Authority)</option>
                <option value="DGCA Jordan">DGCA Jordan (Directorate General of Civil Aviation)</option>
                <option value="DGCA Lebanon">DGCA Lebanon (Directorate General of Civil Aviation)</option>
                <option value="CAA Egypt">CAA Egypt (Egyptian Civil Aviation Authority)</option>
                <option value="DGCA Iraq">DGCA Iraq (Iraqi Civil Aviation Authority)</option>
                <option value="CAA Iran">CAA Iran (Civil Aviation Organization)</option>
                <option value="DGCA Syria">DGCA Syria (Syrian Civil Aviation Authority)</option>
                <option value="CAA Turkey">CAA Turkey (Directorate General of Civil Aviation)</option>
                <option value="CAA Israel">CAA Israel (Civil Aviation Authority)</option>
                
                <!-- Asia Pacific -->
                <option value="DGCA India">DGCA India (Directorate General of Civil Aviation)</option>
                <option value="CASA Australia">CASA (Civil Aviation Safety Authority - Australia)</option>
                <option value="CAAC China">CAAC (Civil Aviation Administration of China)</option>
                <option value="JCAB Japan">JCAB (Japan Civil Aviation Bureau)</option>
                <option value="KCAB Korea">KCAB (Korea Civil Aviation Bureau)</option>
                <option value="CAAS Singapore">CAAS (Civil Aviation Authority of Singapore)</option>
                <option value="DCA Malaysia">DCA Malaysia (Department of Civil Aviation)</option>
                <option value="CAAT Thailand">CAAT (Civil Aviation Authority of Thailand)</option>
                <option value="DGCA Indonesia">DGCA Indonesia (Directorate General of Civil Aviation)</option>
                <option value="CAAP Philippines">CAAP (Civil Aviation Authority of Philippines)</option>
                <option value="CAA Vietnam">CAA Vietnam (Civil Aviation Authority)</option>
                <option value="DGCA Pakistan">DGCA Pakistan (Civil Aviation Authority)</option>
                <option value="DGCA Bangladesh">DGCA Bangladesh (Civil Aviation Authority)</option>
                <option value="CAAN Nepal">CAAN (Civil Aviation Authority of Nepal)</option>
                <option value="DGCA Sri Lanka">DGCA Sri Lanka (Civil Aviation Authority)</option>
                <option value="DGCA Myanmar">DGCA Myanmar (Department of Civil Aviation)</option>
                <option value="CAA New Zealand">CAA New Zealand (Civil Aviation Authority)</option>
                
                <!-- Europe -->
                <option value="CAA UK">CAA UK (Civil Aviation Authority - United Kingdom)</option>
                <option value="LBA Germany">LBA (Luftfahrt-Bundesamt - Germany)</option>
                <option value="DGAC France">DGAC (Direction G√©n√©rale de l'Aviation Civile - France)</option>
                <option value="ENAC Italy">ENAC (Ente Nazionale per l'Aviazione Civile - Italy)</option>
                <option value="AESA Spain">AESA (Agencia Estatal de Seguridad A√©rea - Spain)</option>
                <option value="ANAC Portugal">ANAC (Autoridade Nacional da Avia√ß√£o Civil - Portugal)</option>
                <option value="BCAA Netherlands">BCAA (Inspectie Leefomgeving en Transport - Netherlands)</option>
                <option value="FOCA Switzerland">FOCA (Federal Office of Civil Aviation - Switzerland)</option>
                <option value="AAC Austria">AAC (Austro Control - Austria)</option>
                <option value="DGAC Belgium">DGAC (Direction G√©n√©rale Transport A√©rien - Belgium)</option>
                <option value="CAA Ireland">CAA Ireland (Irish Aviation Authority)</option>
                <option value="CAA Denmark">CAA Denmark (Danish Civil Aviation Authority)</option>
                <option value="CAA Sweden">CAA Sweden (Swedish Transport Agency)</option>
                <option value="CAA Norway">CAA Norway (Civil Aviation Authority Norway)</option>
                <option value="CAA Finland">CAA Finland (Finnish Transport and Communications Agency)</option>
                <option value="CAA Poland">CAA Poland (Civil Aviation Authority)</option>
                <option value="CAA Czech">CAA Czech (Civil Aviation Authority)</option>
                <option value="CAA Hungary">CAA Hungary (National Transport Authority)</option>
                <option value="CAA Romania">CAA Romania (Romanian Civil Aeronautical Authority)</option>
                <option value="CAA Bulgaria">CAA Bulgaria (Civil Aviation Administration)</option>
                <option value="CAA Greece">CAA Greece (Hellenic Civil Aviation Authority)</option>
                <option value="CAA Croatia">CAA Croatia (Croatian Civil Aviation Agency)</option>
                <option value="CAA Slovenia">CAA Slovenia (Civil Aviation Agency)</option>
                <option value="CAA Slovakia">CAA Slovakia (Transport Authority)</option>
                <option value="CAA Russia">CAA Russia (Federal Air Transport Agency)</option>
                <option value="CAA Ukraine">CAA Ukraine (State Aviation Administration)</option>
                
                <!-- Americas -->
                <option value="TCCA Canada">TCCA (Transport Canada Civil Aviation)</option>
                <option value="ANAC Brazil">ANAC (Ag√™ncia Nacional de Avia√ß√£o Civil - Brazil)</option>
                <option value="ANAC Argentina">ANAC (Administraci√≥n Nacional de Aviaci√≥n Civil - Argentina)</option>
                <option value="DGAC Chile">DGAC (Direcci√≥n General de Aeron√°utica Civil - Chile)</option>
                <option value="UAEAC Colombia">UAEAC (Unidad Administrativa Especial de Aeron√°utica Civil - Colombia)</option>
                <option value="DGAC Ecuador">DGAC (Direcci√≥n General de Aviaci√≥n Civil - Ecuador)</option>
                <option value="DGAC Peru">DGAC (Direcci√≥n General de Aeron√°utica Civil - Peru)</option>
                <option value="DINAC Venezuela">DINAC (Instituto Nacional de Aeron√°utica Civil - Venezuela)</option>
                <option value="DGAC Mexico">DGAC (Direcci√≥n General de Aeron√°utica Civil - Mexico)</option>
                <option value="JCAA Jamaica">JCAA (Jamaica Civil Aviation Authority)</option>
                
                <!-- Africa -->
                <option value="SACAA South Africa">SACAA (South African Civil Aviation Authority)</option>
                <option value="NCAA Nigeria">NCAA (Nigerian Civil Aviation Authority)</option>
                <option value="KCAA Kenya">KCAA (Kenya Civil Aviation Authority)</option>
                <option value="ECAA Egypt">ECAA (Egyptian Civil Aviation Authority)</option>
                <option value="GACA Ghana">GACA (Ghana Civil Aviation Authority)</option>
                <option value="CCAA Ethiopia">CCAA (Ethiopian Civil Aviation Authority)</option>
                <option value="DGAC Morocco">DGAC (Direction G√©n√©rale de l'Aviation Civile - Morocco)</option>
                <option value="CAA Tanzania">CAA Tanzania (Tanzania Civil Aviation Authority)</option>
                <option value="CAA Uganda">CAA Uganda (Civil Aviation Authority)</option>
                <option value="CAA Zimbabwe">CAA Zimbabwe (Civil Aviation Authority)</option>
                
                <!-- Previous Employer/Other -->
                <option value="Previous Airline/Employer">Previous Airline/Employer</option>
                <option value="Other">Other Authority (Specify below)</option>
              </select>
              <div id="incidentLetterAuthorityOtherDiv" style="margin-top: 8px; display: none;">
                <input type="text" id="incidentLetterAuthorityOther" placeholder="Please specify authority" />
              </div>
            </div>
            <div>
              <label>Letter Issue Date</label>
              <input type="date" id="incidentLetterDate" />
            </div>
            <div>
              <label>Upload Letter</label>
              <input type="file" id="incidentLetterFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
          </div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Official letter confirming no aviation incidents, accidents, or violations on record. Must be issued by relevant aviation authority or previous employer within the last 6 months.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">‚è±Ô∏è Flight Hours Verification Letter</h2>
          <div class="grid">
            <div>
              <label>Issuing Authority/Company</label>
              <input type="text" id="flightHoursAuthority" placeholder="Previous airline, flight school, or aviation authority" />
            </div>
            <div>
              <label>Letter Issue Date</label>
              <input type="date" id="flightHoursIssue" />
            </div>
            <div>
              <label>Upload Verification Letter</label>
              <input type="file" id="flightHoursFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
          </div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Official letter from previous employer or aviation authority verifying your total flight hours, aircraft types flown, and positions held. Must be on company letterhead with official signature and stamp.
          </div>
        </div>

        <div class="form-section">
          <h2 class="section-h">üÜî Emirates ID (if applicable)</h2>
          <div class="grid">
            <div>
              <label>Emirates ID Number</label>
              <input type="text" id="emiratesIdNumber" placeholder="784-YYYY-XXXXXXX-X" />
            </div>
            <div>
              <label>Issue Date</label>
              <input type="date" id="emiratesIdIssue" />
            </div>
            <div>
              <label>Expiry Date</label>
              <input type="date" id="emiratesIdExpiry" onchange="checkValidity('emiratesId')" />
            </div>
            <div>
              <label>Upload Emirates ID Copy</label>
              <input type="file" id="emiratesIdFile" accept=".pdf,.jpg,.png" />
            </div>
          </div>
          <div id="emiratesIdStatus"></div>
          <div class="requirement-note">
            <strong>Note:</strong> Only required if you currently hold UAE residence. If you don't have Emirates ID, leave this section blank. New Emirates ID will be processed after employment confirmation.
          </div>
        </div>


        <div class="form-section">
          <h2 class="section-h">üõÇ UAE Visa & Work Permit</h2>
          <div class="grid">
            <div>
              <label>Current Visa Status</label>
              <select id="visaStatus">
                <option value="">Select Visa Status</option>
                <option value="Tourist Visa">Tourist Visa</option>
                <option value="Visit Visa">Visit Visa</option>
                <option value="Residence Visa">Residence Visa</option>
                <option value="Employment Visa">Employment Visa</option>
                <option value="No Current UAE Visa">No Current UAE Visa</option>
              </select>
            </div>
            <div>
              <label>Visa Expiry Date</label>
              <input type="date" id="visaExpiry" onchange="checkValidity('visa')" />
            </div>
            <div>
              <label>Upload Current Visa Copy</label>
              <input type="file" id="visaFile" accept=".pdf,.jpg,.png" />
            </div>
            <div></div>
          </div>
          <div id="visaStatus"></div>
          <div class="requirement-note">
            <strong>Requirement:</strong> Valid UAE entry visa or residence permit. If currently outside UAE, company will provide visa assistance. Work permit will be processed after job offer acceptance.
          </div>
        </div>
      </div>

      <!-- Step 4: Review & Submit -->
      <div class="form-step" data-step="4">
        <h2 class="step-title">üîç Review & Submit</h2>
        <p class="step-subtitle">Please review all your information before submitting your application.</p>
        
        <div class="form-section">
          <div class="section-title">Application Summary</div>
          <div id="applicationSummary">
            <!-- Summary will be populated by JavaScript -->
          </div>
        </div>

        <!-- Declaration & Signature -->
        <div class="section" id="signSection">
          <div class="section-title"><h3>‚úçÔ∏è Declaration & Digital Signature</h3></div>
          <div style="background:linear-gradient(135deg,#fef7ed 0%,#fed7aa 100%);padding:20px;border-radius:12px;border:2px solid var(--flydubai-red);margin-bottom:24px;">
            <p style="font-size:14px;line-height:1.7;color:var(--flydubai-navy);margin:0;font-weight:500;text-align:justify;">
              <strong>DECLARATION:</strong> I solemnly declare and affirm that all documentation, certifications, and validity periods contained herein are true, accurate, and complete in accordance with UAE GCAA regulations, ICAO standards, and applicable civil aviation requirements. I acknowledge that this declaration is made under penalty of regulatory sanctions and understand that any material misrepresentation, omission, or falsification may result in suspension or revocation of aviation privileges, termination of employment, and disciplinary proceedings pursuant to UAE aviation law. I further acknowledge my continuing obligation to maintain current and valid documentation in compliance with UAE employment and aviation regulatory requirements.
            </p>
          </div>
          <div class="grid">
            <div>
              <label>Date</label>
              <input type="date" id="sigDate" />
              <span class="date-print" id="sigDatePrint"></span>
            </div>
            <div>
              <label>Digital Signature</label>
              <div class="sig-pad">
                <canvas id="sigCanvas"></canvas>
                <div id="sigControls" class="controls no-print">
                  <input type="text" id="typedSig" placeholder="Type name to render as signature" style="flex:1;min-width:220px;padding:10px 12px;border:1px solid var(--line);border-radius:10px" />
                  <button class="btn" id="sigApply">Apply Typed</button>
                  <label class="btn" for="sigUpload">Upload Image</label>
                  <input id="sigUpload" type="file" accept="image/*" style="display:none" />
                  <button class="btn warn" id="sigClear">Clear</button>
                </div>
              </div>
              <div class="muted" style="font-size:12px;margin-top:6px">You can draw, apply a typed name, or upload a signature image.</div>
            </div>
          </div>

          <label style="display: flex; align-items: flex-start; gap: 12px; margin-top: 24px;">
            <input type="checkbox" id="declaration" required style="width: auto; margin-top: 4px;">
            <span>I confirm that I have read and understood the declaration above, and that my digital signature represents my agreement to all terms stated herein.</span>
          </label>
        </div>
      </div>

      <!-- Navigation -->
      <div class="form-navigation">
        <div class="nav-left">
          <div class="auto-save-status" id="autoSaveStatus">
            <span class="spinner" style="display: none;"></span>
            <span class="status-text">Ready</span>
          </div>
        </div>
        <div class="nav-right">
          <button class="btn" id="prevBtn" onclick="previousStep()" style="display: none;">Previous</button>
          <button class="btn primary" id="nextBtn" onclick="nextStep()">Next Step</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Time Parsing and Calculation Functions (from original) =====
    function parseHHMM(str){ 
      if(!str) return 0; 
      const m = String(str).trim().match(/^\s*(\d+)\s*:\s*(\d{1,2})\s*$/); 
      if(!m) return 0; 
      let h = parseInt(m[1],10)||0; 
      let mm = parseInt(m[2],10)||0; 
      h += Math.floor(mm/60); 
      mm = mm % 60; 
      return h*60 + mm; 
    }

    // Date formatting function
    function toDDMMMYYYY(dateStr) {
      if (!dateStr) return '';
      const date = new Date(dateStr);
      if (isNaN(date.getTime())) return '';
      
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                     'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      const day = date.getDate().toString().padStart(2, '0');
      const month = months[date.getMonth()];
      const year = date.getFullYear();
      
      return `${day} ${month} ${year}`;
    }
    
    function toHHMM(totalMinutes){ 
      totalMinutes = Math.max(0, Math.floor(totalMinutes||0)); 
      const h = Math.floor(totalMinutes/60); 
      const m = totalMinutes % 60; 
      return h+":"+(m<10?"0"+m:m); 
    }
    
    function padHHMM(el){ 
      const v = el.value.trim(); 
      console.log(`üîß padHHMM processing: "${v}" for field ${el.className}`);
      
      // Handle special cases for time entry shortcuts
      if (v.match(/^\d{1,4}$/)) {
        const num = parseInt(v, 10);
        if (v.length === 1) {
          // 1 becomes 00:01 (single digit minutes)
          el.value = `0:0${v}`;
          console.log(`  ‚úÖ Single digit converted: "${v}" ‚Üí "0:0${v}"`);
          return;
        } else if (v.length === 2) {
          // 23 becomes 00:23 (minutes)
          el.value = `0:${v}`;
          return;
        } else if (v.length === 3) {
          // 100 becomes 01:00 (hours:minutes)
          const hours = Math.floor(num / 100);
          const minutes = num % 100;
          if (minutes < 60) {
            el.value = `${hours}:${minutes.toString().padStart(2, '0')}`;
            return;
          }
        } else if (v.length === 4) {
          // 1234 becomes 12:34
          const hours = Math.floor(num / 100);
          const minutes = num % 100;
          if (minutes < 60) {
            el.value = `${hours}:${minutes.toString().padStart(2, '0')}`;
            return;
          }
        }
      }
      
      // Standard parsing for HH:MM format
      const mins = parseHHMM(v); 
      el.value = mins ? toHHMM(mins) : ""; 
    }

    // ===== English Proficiency Functions =====
    function toggleEnglishTestDate() {
      const testType = document.getElementById('englishTestType').value;
      const testDateDiv = document.getElementById('englishTestDateDiv');
      const englishLevel = document.getElementById('englishLevel');
      const englishLevelDiv = englishLevel ? englishLevel.parentElement : null;
      
      if (testType === 'Attached to License') {
        testDateDiv.style.display = 'none';
        if (englishLevelDiv) englishLevelDiv.style.display = 'none';
        document.getElementById('englishTestDate').value = ''; // Clear the field
        if (englishLevel) englishLevel.value = ''; // Clear proficiency level
      } else {
        testDateDiv.style.display = 'block';
        if (englishLevelDiv) englishLevelDiv.style.display = 'block';
      }
    }

    // ===== Multi-Step Form System =====
    let currentStep = 1;
    const totalSteps = 4;
    let formData = {};
    let sessionId = generateSessionId();
    let autoSaveTimer;

    // Generate unique session ID
    function generateSessionId() {
      return 'pilot_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    // Initialize form system
    function initializeForm() {
      console.log('üöÄ === FORM INITIALIZATION START ===');
      console.log('üìç Current step:', currentStep);
      console.log('üìç Total steps:', totalSteps);
      console.log('üÜî Session ID:', sessionId);
      
      loadFormData();
      checkForRecovery();
      updateProgress();
      setupAutoSave();
      setupEventListeners();
      
      console.log('‚úÖ === FORM INITIALIZATION COMPLETE ===');
    }

    // Check for previous session
    function checkForRecovery() {
      console.log('üîç Checking for previous session...');
      const savedData = localStorage.getItem('pilotFormData');
      console.log('üíæ Raw saved data:', savedData);
      
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          console.log('üìä Parsed data keys:', Object.keys(data));
          console.log('üìä Session ID exists:', !!data.sessionId);
          console.log('üìä Last saved timestamp:', data.lastSaved);
          
          const timeDiff = Date.now() - (data.lastSaved || 0);
          const isValidSession = data.sessionId && timeDiff < 7 * 24 * 60 * 60 * 1000; // 7 days
          
          console.log('‚è∞ Time since last save:', Math.round(timeDiff / (1000 * 60 * 60)), 'hours');
          console.log('‚è∞ Time diff (ms):', timeDiff);
          console.log('‚è∞ Max age (ms):', 7 * 24 * 60 * 60 * 1000);
          console.log('üîê Session ID:', data.sessionId);
          console.log('‚úÖ Valid session check:', isValidSession);
          
          if (isValidSession) {
            console.log('üéØ Showing recovery banner');
            const banner = document.getElementById('recoveryBanner');
            if (banner) {
              banner.classList.add('show');
              console.log('‚úÖ Recovery banner shown');
            } else {
              console.error('‚ùå Recovery banner element not found');
            }
          } else {
            console.log('‚ùå Session too old or invalid, clearing...');
            console.log('‚ùå Reason: sessionId exists?', !!data.sessionId, 'timeDiff < max?', timeDiff < 7 * 24 * 60 * 60 * 1000);
            localStorage.removeItem('pilotFormData');
          }
        } catch (error) {
          console.error('‚ùå Error parsing saved data:', error);
          localStorage.removeItem('pilotFormData');
        }
      } else {
        console.log('üì≠ No saved data found in localStorage');
      }
    }

    // Recover previous session
    function recoverSession() {
      console.log('üîÑ Recovering session...');
      const savedData = localStorage.getItem('pilotFormData');
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          formData = data.formData || {};
          currentStep = data.currentStep || 1;
          sessionId = data.sessionId || generateSessionId();
          
          populateFormFields();
          showStep(currentStep);
          document.getElementById('recoveryBanner').classList.remove('show');
          showAutoSaveStatus('Restored previous session', 'saved');
          
          // Check if there were previously uploaded files and show notification
          const hasUploadedFiles = data.formData?.documentation && Object.values(data.formData.documentation).some(value => 
            typeof value === 'string' && value.includes('.') && value.length > 3
          );
          
          if (hasUploadedFiles) {
            showFileRestorationNotification();
          }
          
          console.log('‚úÖ Session recovered successfully');
        } catch (error) {
          console.error('‚ùå Error recovering session:', error);
          clearSession();
        }
      }
    }

    // Clear session and start fresh
    function clearSession() {
      console.log('üóëÔ∏è Clearing session...');
      localStorage.removeItem('pilotFormData');
      formData = {};
      currentStep = 1;
      sessionId = generateSessionId();
      
      // Clear all form fields
      document.querySelectorAll('input, select, textarea').forEach(field => {
        if (field.type === 'checkbox' || field.type === 'radio') {
          field.checked = false;
        } else {
          field.value = '';
        }
      });
      
      showStep(1);
      document.getElementById('recoveryBanner').classList.remove('show');
      showAutoSaveStatus('Starting fresh session', 'saved');
      console.log('‚úÖ Session cleared successfully');
    }


    // Setup auto-save functionality
    function setupAutoSave() {
      // Auto-save every 30 seconds
      setInterval(() => {
        if (hasFormChanges()) {
          saveFormData();
        }
      }, 30000);
    }

    // Setup event listeners
    function setupEventListeners() {
      // Add change listeners to all form inputs
      document.addEventListener('input', (e) => {
        if (e.target.matches('input, select, textarea')) {
          // Trigger auto-save after 2 seconds of no typing
          clearTimeout(autoSaveTimer);
          showAutoSaveStatus('Typing...', 'saving');
          
          autoSaveTimer = setTimeout(() => {
            collectFormData();
            saveFormData();
          }, 2000);
        }
      });
    }

    // Collect current form data
    function collectFormData() {
      console.log('üìù === COLLECTING FORM DATA ===');
      console.log('üìç Current step:', currentStep);
      console.log('üìù Previous form data keys:', Object.keys(formData));
      
      // Step 1: Personal Information
      if (currentStep >= 1) {
        console.log('üìã Collecting Step 1: Personal Information');
        const personalInfo = {
          pilotName: document.getElementById('pilotName')?.value || '',
          designation: document.getElementById('designation')?.value || '',
          doj: document.getElementById('doj')?.value || '',
          nationality: document.getElementById('nationality')?.value || '',
          contactEmail: document.getElementById('contactEmail')?.value || '',
          dateOfBirth: document.getElementById('dateOfBirth')?.value || '',
          countryCode: document.getElementById('countryCode')?.value || '',
          phoneNumber: document.getElementById('phoneNumber')?.value || ''
        };
        
        console.log('üë§ Personal info collected:', personalInfo);
        console.log('üè≥Ô∏è Country code specifically:', {
          element: document.getElementById('countryCode'),
          value: document.getElementById('countryCode')?.value,
          selectedOption: document.getElementById('countryCode')?.selectedOptions[0]?.textContent
        });
        formData.personalInfo = personalInfo;
      }
      
      // Step 2: Flight Experience
      console.log('üîç Checking flight experience collection condition:', {
        currentStep,
        shouldCollect: currentStep >= 2,
        stepComparison: `${currentStep} >= 2`
      });
      
      if (currentStep >= 2) {
        console.log('üîç === COLLECTING FLIGHT EXPERIENCE DATA ===');
        const sectionsFound = document.querySelectorAll('#sections .form-section, #sections .section');
        console.log('üìä Total sections found:', sectionsFound.length);
        console.log('üìä Section selectors used:', '#sections .form-section, #sections .section');
        
        const aircraftSections = [];
        sectionsFound.forEach((section, index) => {
          console.log(`üõ©Ô∏è Processing section ${index + 1}:`, {
            className: section.className,
            hasAircraftType: !!section.querySelector('.ac-type'),
            hasNotes: !!section.querySelector('.ac-notes'),
            timeInputs: section.querySelectorAll('.hhmm').length,
            dateInputs: section.querySelectorAll('.date-inp').length
          });
          const aircraftType = section.querySelector('.ac-type')?.value || '';
          const notes = section.querySelector('.ac-notes')?.value || '';
          const inputs = section.querySelectorAll('.hhmm');
          const dateInputs = section.querySelectorAll('.date-inp');
          
          // Map the actual 6 fields in the current form structure
          const flightHours = {
            picTotal: inputs[0]?.value || '0:00',    // PIC Total Hours
            picBlock: inputs[1]?.value || '0:00',    // PIC Block Hours (last 12 months)
            sicTotal: inputs[2]?.value || '0:00',    // SIC Total Hours
            sicBlock: inputs[3]?.value || '0:00',    // SIC Block Hours (last 12 months)
            multiPilot: inputs[4]?.value || '0:00',  // Multi-Pilot Hours
            night: inputs[5]?.value || '0:00'        // Night Hours
          };
          
          const dates = {
            picFrom: dateInputs[0]?.value || '',     // PIC first flight date
            picTo: dateInputs[1]?.value || '',       // PIC last flight date  
            sicFrom: dateInputs[2]?.value || '',     // SIC first flight date
            sicTo: dateInputs[3]?.value || ''        // SIC last flight date
          };
          
          console.log(`‚úàÔ∏è Section ${index + 1} collected:`, {
            aircraftType,
            notes,
            flightHours,
            dates,
            hasData: !!(aircraftType || notes || Object.values(flightHours).some(h => h !== '0:00') || dates.picFrom || dates.picTo || dates.sicFrom || dates.sicTo)
          });
          console.log(`üîç Section ${index + 1} detailed flight hours:`, {
            picTotal: flightHours.picTotal,
            picBlock: flightHours.picBlock, 
            sicTotal: flightHours.sicTotal,
            sicBlock: flightHours.sicBlock,
            multiPilot: flightHours.multiPilot,
            night: flightHours.night
          });
          console.log(`üìÖ Section ${index + 1} detailed dates:`, {
            picFrom: dates.picFrom,
            picTo: dates.picTo,
            sicFrom: dates.sicFrom,
            sicTo: dates.sicTo
          });
          
          aircraftSections.push({
            aircraftType,
            notes,
            flightHours,
            dates
          });
        });
        
        // Collect summary flight hours - use specific selector for summary table only
        const summaryInputs = document.querySelectorAll('.form-step[data-step="2"] .summary table tbody input.hhmm');
        console.log('üìä === COLLECTING SUMMARY HOURS ===');
        console.log('üìä Found summary table inputs:', summaryInputs.length);
        console.log('üìä Summary input values:', Array.from(summaryInputs).map(input => input.value || '0:00'));
        
        const summaryHours = {
          pic: summaryInputs[0]?.value || '0:00',
          sic: summaryInputs[1]?.value || '0:00',
          solo: summaryInputs[2]?.value || '0:00',
          instrument: summaryInputs[3]?.value || '0:00',
          sim: summaryInputs[4]?.value || '0:00',
          night: summaryInputs[5]?.value || '0:00',
          instructor: summaryInputs[6]?.value || '0:00',
          p1us: summaryInputs[7]?.value || '0:00',
          grandTotal: summaryInputs[8]?.value || '0:00'
        };
        
        console.log('üìä Collected summary hours:', summaryHours);
        
        formData.flightExperience = {
          aircraftSections,
          summaryHours,
          grandTotals: {
            combined: document.getElementById('gtCombined')?.textContent || '0:00',
            multiPilot: document.getElementById('gtMP')?.textContent || '0:00',
            night: document.getElementById('gtNight')?.textContent || '0:00'
          }
        };
        console.log('‚úàÔ∏è Flight experience final data:', {
          sectionsCount: aircraftSections.length,
          sectionsWithData: aircraftSections.filter(s => s.aircraftType || Object.values(s.flightHours).some(h => h !== '0:00')).length,
          summaryHours,
          grandTotals: formData.flightExperience.grandTotals
        });
      }
      
      // Step 3: Documentation
      if (currentStep >= 3) {
        console.log('üìÑ Collecting Step 3: Documentation');
        formData.documentation = {
          // Pilot License
          licenseType: document.getElementById('licenseType')?.value || '',
          licenseNumber: document.getElementById('licenseNumber')?.value || '',
          licenseIssue: document.getElementById('licenseIssue')?.value || '',
          licenseExpiry: document.getElementById('licenseExpiry')?.value || '',
          licenseFile: document.getElementById('licenseFile')?.files[0]?.name || '',
          
          // Medical Certificate
          medicalClass: document.getElementById('medicalClass')?.value || '',
          medicalAuthority: document.getElementById('medicalAuthority')?.value || '',
          medicalIssue: document.getElementById('medicalIssue')?.value || '',
          medicalExpiry: document.getElementById('medicalExpiry')?.value || '',
          medicalFile: document.getElementById('medicalFile')?.files[0]?.name || '',
          
          // Radio Operator License
          rolNumber: document.getElementById('rolNumber')?.value || '',
          rolAuthority: document.getElementById('rolAuthority')?.value || '',
          rolIssue: document.getElementById('rolIssue')?.value || '',
          rolExpiry: document.getElementById('rolExpiry')?.value || '',
          rolFile: document.getElementById('rolFile')?.files[0]?.name || '',
          
          // Passport
          passportNumber: document.getElementById('passportNumber')?.value || '',
          passportNationality: document.getElementById('passportNationality')?.value || '',
          passportIssue: document.getElementById('passportIssue')?.value || '',
          passportExpiry: document.getElementById('passportExpiry')?.value || '',
          passportFile: document.getElementById('passportFile')?.files[0]?.name || '',
          
          // UAE Visa & Work Permit
          visaStatus: document.getElementById('visaStatus')?.value || '',
          visaExpiry: document.getElementById('visaExpiry')?.value || '',
          visaFile: document.getElementById('visaFile')?.files[0]?.name || '',
          
          // Flight Hours Verification Letter
          flightHoursAuthority: document.getElementById('flightHoursAuthority')?.value || '',
          flightHoursIssue: document.getElementById('flightHoursIssue')?.value || '',
          flightHoursFile: document.getElementById('flightHoursFile')?.files[0]?.name || '',
          
          // License Verification Letter
          licenseVerificationAuthority: document.getElementById('licenseVerificationAuthority')?.value || '',
          licenseVerificationDate: document.getElementById('licenseVerificationDate')?.value || '',
          licenseVerificationFile: document.getElementById('licenseVerificationFile')?.files[0]?.name || '',
          
          // No Incident/Accident Letter
          incidentLetterAuthority: document.getElementById('incidentLetterAuthority')?.value || '',
          incidentLetterDate: document.getElementById('incidentLetterDate')?.value || '',
          incidentLetterFile: document.getElementById('incidentLetterFile')?.files[0]?.name || '',
          
          // Emirates ID
          emiratesIdNumber: document.getElementById('emiratesIdNumber')?.value || '',
          emiratesIdIssue: document.getElementById('emiratesIdIssue')?.value || '',
          emiratesIdExpiry: document.getElementById('emiratesIdExpiry')?.value || '',
          emiratesIdFile: document.getElementById('emiratesIdFile')?.files[0]?.name || '',
          
          
          // English Proficiency Certificate
          englishLevel: document.getElementById('englishLevel')?.value || '',
          englishTestType: document.getElementById('englishTestType')?.value || '',
          englishTestDate: document.getElementById('englishTestDate')?.value || '',
          englishFile: document.getElementById('englishFile')?.files[0]?.name || ''
        };
        console.log('üìÑ Documentation data collected:', Object.keys(formData.documentation).length, 'fields');
      }
      
      // Step 4: Review & Submit
      if (currentStep >= 4) {
        // Collect signature data with safe handling
        const canvas = document.getElementById('sigCanvas');
        let signatureData = '';
        if (canvas) {
          try {
            // Check if canvas has content (not just blank)
            const ctx = canvas.getContext('2d');
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const hasSignature = imageData.data.some(channel => channel !== 0);
            
            if (hasSignature) {
              // Use compressed JPEG format to reduce data size
              signatureData = canvas.toDataURL('image/jpeg', 0.8);
            }
          } catch (error) {
            console.error('Error collecting signature data:', error);
            signatureData = '';
          }
        }
        
        formData.declaration = {
          agreed: document.getElementById('declaration')?.checked || false,
          signatureDate: document.getElementById('sigDate')?.value || '',
          signatureData: signatureData,
          typedSignature: document.getElementById('typedSig')?.value || ''
        };
        console.log('‚úçÔ∏è Signature data collected:', {
          hasAgreed: formData.declaration.agreed,
          hasSignatureDate: !!formData.declaration.signatureDate,
          hasSignatureData: !!formData.declaration.signatureData,
          hasTypedSignature: !!formData.declaration.typedSignature
        });
      }
    }

    // Save form data to localStorage including files
    function saveFormData() {
      console.log('üíæ === SAVING FORM DATA ===');
      console.log('üÜî Session ID:', sessionId);
      console.log('üìç Current step:', currentStep);
      console.log('üìù Form data keys:', Object.keys(formData));
      console.log('üìù Form data structure:', formData);
      
      // Save file information for restoration
      const fileInputs = document.querySelectorAll('input[type="file"]');
      const uploadedFiles = {};
      
      fileInputs.forEach(input => {
        if (input.files && input.files.length > 0) {
          const file = input.files[0];
          uploadedFiles[input.id] = {
            name: file.name,
            size: file.size,
            type: file.type,
            lastModified: file.lastModified,
            uploadedAt: Date.now()
          };
          console.log(`üìé Saving file info: ${input.id} - ${file.name}`);
        }
      });
      
      const saveData = {
        sessionId: sessionId,
        currentStep: currentStep,
        formData: formData,
        uploadedFiles: uploadedFiles,
        lastSaved: Date.now(),
        expiresAt: Date.now() + (30 * 24 * 60 * 60 * 1000) // 30 days
      };
      
      console.log('üíΩ Save data structure:', {
        hasSessionId: !!saveData.sessionId,
        currentStep: saveData.currentStep,
        formDataSize: JSON.stringify(saveData.formData).length,
        uploadedFilesCount: Object.keys(uploadedFiles).length,
        lastSaved: new Date(saveData.lastSaved).toLocaleString(),
        expiresAt: new Date(saveData.expiresAt).toLocaleString()
      });
      
      try {
        localStorage.setItem('pilotFormData', JSON.stringify(saveData));
        console.log('‚úÖ Data successfully saved to localStorage');
        showAutoSaveStatus('All changes saved', 'saved');
      } catch (error) {
        console.error('‚ùå Error saving to localStorage:', error);
        showAutoSaveStatus('Error saving changes', 'error');
      }
      
      console.log('‚úÖ === FORM DATA SAVE COMPLETE ===');
    }

    // Load form data from localStorage
    function loadFormData() {
      console.log('üì• === LOADING FORM DATA ===');
      const savedData = localStorage.getItem('pilotFormData');
      console.log('üíæ Raw localStorage data:', savedData ? 'EXISTS' : 'NOT FOUND');
      
      if (savedData) {
        try {
          const data = JSON.parse(savedData);
          console.log('üìä Loaded data keys:', Object.keys(data));
          console.log('üìä Data structure:', {
            hasFormData: !!data.formData,
            currentStep: data.currentStep,
            sessionId: data.sessionId ? 'EXISTS' : 'MISSING',
            lastSaved: data.lastSaved ? new Date(data.lastSaved).toLocaleString() : 'MISSING',
            expiresAt: data.expiresAt ? new Date(data.expiresAt).toLocaleString() : 'MISSING'
          });
          
          // Check if data hasn't expired
          const now = Date.now();
          const isExpired = now >= data.expiresAt;
          console.log('‚è∞ Expiry check:', {
            now: new Date(now).toLocaleString(),
            expiresAt: new Date(data.expiresAt).toLocaleString(),
            isExpired: isExpired
          });
          
          if (!isExpired) {
            formData = data.formData || {};
            console.log('üìù Form data loaded:', Object.keys(formData));
            
            // Store uploaded files info for restoration indicators
            if (data.uploadedFiles) {
              window.savedUploadedFiles = data.uploadedFiles;
              console.log('üìé File upload history loaded:', Object.keys(data.uploadedFiles));
            }
            
            console.log('‚úÖ Data successfully loaded');
            return true;
          } else {
            console.log('üóëÔ∏è Data expired, clearing...');
            localStorage.removeItem('pilotFormData');
          }
        } catch (error) {
          console.error('‚ùå Error parsing saved data:', error);
          localStorage.removeItem('pilotFormData');
        }
      } else {
        console.log('üì≠ No saved data found');
      }
      
      console.log('‚ùå No valid data loaded');
      return false;
    }

    // Populate form fields with saved data
    function populateFormFields() {
      console.log('üìù === POPULATING FORM FIELDS ===');
      console.log('üìä Form data to populate:', formData);
      
      // Step 1: Personal Information
      if (formData.personalInfo) {
        console.log('üë§ Populating personal information...');
        const info = formData.personalInfo;
        
        const personalFields = [
          { id: 'pilotName', value: info.pilotName },
          { id: 'designation', value: info.designation },
          { id: 'doj', value: info.doj },
          { id: 'nationality', value: info.nationality },
          { id: 'contactEmail', value: info.contactEmail },
          { id: 'dateOfBirth', value: info.dateOfBirth },
          { id: 'countryCode', value: info.countryCode },
          { id: 'phoneNumber', value: info.phoneNumber }
        ];
        
        personalFields.forEach(field => {
          const element = document.getElementById(field.id);
          if (element && field.value) {
            element.value = field.value;
            console.log(`‚úÖ ${field.id}: ${field.value}`);
            
            // Special logging for country code
            if (field.id === 'countryCode') {
              console.log('üè≥Ô∏è Country code restoration:', {
                savedValue: field.value,
                elementValue: element.value,
                selectedOption: element.selectedOptions[0]?.textContent,
                allOptions: Array.from(element.options).map(opt => ({ value: opt.value, text: opt.textContent }))
              });
            }
          } else if (!element) {
            console.log(`‚ö†Ô∏è Element not found: ${field.id}`);
          } else {
            console.log(`‚ö†Ô∏è No value to restore for ${field.id}:`, field.value);
          }
        });
      }
      
      // Step 2: Flight Experience - Restore Aircraft Sections  
      if (formData.flightExperience && formData.flightExperience.aircraftSections) {
        console.log('üîÑ === RESTORING FLIGHT EXPERIENCE SECTIONS ===');
        const sections = formData.flightExperience.aircraftSections;
        console.log('üìä Sections to restore:', sections.length);
        console.log('üìä Sections data:', sections);
        
        // Clear existing sections first
        console.log('üóëÔ∏è Clearing existing sections...');
        sectionsWrap.innerHTML = '';
        sectionCounter = 0;
        
        sections.forEach((sectionData, index) => {
          console.log(`üõ©Ô∏è Restoring section ${index + 1}:`, sectionData);
          console.log(`üîç Section ${index + 1} restoration - flight hours to restore:`, sectionData.flightHours);
          console.log(`üìÖ Section ${index + 1} restoration - dates to restore:`, sectionData.dates);
          
          // Determine if this is a locked section based on aircraft type
          const isLocked = sectionData.aircraftType === 'Boeing 737 NG/MAX' || sectionData.aircraftType === 'Boeing 737 Classic (300-500)';
          const b737Type = sectionData.aircraftType === 'Boeing 737 NG/MAX' ? 'ng-max' : 
                          sectionData.aircraftType === 'Boeing 737 Classic (300-500)' ? 'classic' : null;
          
          const section = makeAircraftSection({
            label: `Aircraft Type ${index + 1}`,
            typeText: isLocked ? sectionData.aircraftType : '',
            locked: isLocked,
            b737Type: b737Type
          });
          
          sectionsWrap.appendChild(section);
          
          // Populate aircraft type if not locked
          if (!isLocked) {
            const aircraftSelect = section.querySelector('.ac-type');
            if (aircraftSelect && sectionData.aircraftType) {
              aircraftSelect.value = sectionData.aircraftType;
            }
          }
          
          // Populate notes
          const notesField = section.querySelector('.ac-notes');
          if (notesField && sectionData.notes) {
            notesField.value = sectionData.notes;
          }
          
          // Populate flight hours
          const hourInputs = section.querySelectorAll('.hhmm');
          const hours = sectionData.flightHours;
          console.log(`üîÑ Restoring section ${index + 1} hours:`, hours);
          console.log(`üîÑ Found ${hourInputs.length} hour input fields`);
          
          if (hours && hourInputs.length >= 6) {
            hourInputs[0].value = hours.picTotal || '0:00';    // PIC Total Hours
            hourInputs[1].value = hours.picBlock || '0:00';    // PIC Block Hours
            hourInputs[2].value = hours.sicTotal || '0:00';    // SIC Total Hours
            hourInputs[3].value = hours.sicBlock || '0:00';    // SIC Block Hours
            hourInputs[4].value = hours.multiPilot || '0:00';  // Multi-Pilot Hours
            hourInputs[5].value = hours.night || '0:00';       // Night Hours
            
            console.log(`‚úÖ Hours populated for section ${index + 1}:`, {
              picTotal: hourInputs[0].value,
              picBlock: hourInputs[1].value,
              sicTotal: hourInputs[2].value,
              sicBlock: hourInputs[3].value,
              multiPilot: hourInputs[4].value,
              night: hourInputs[5].value
            });
          } else {
            console.log(`‚ö†Ô∏è Cannot populate hours for section ${index + 1}:`, {
              hasHours: !!hours,
              hourInputsCount: hourInputs.length
            });
          }
          
          // Populate date fields
          const dateInputs = section.querySelectorAll('.date-inp');
          const dates = sectionData.dates;
          console.log(`üìÖ Restoring section ${index + 1} dates:`, dates);
          console.log(`üìÖ Found ${dateInputs.length} date input fields`);
          
          if (dates && dateInputs.length >= 4) {
            dateInputs[0].value = dates.picFrom || '';     // PIC first flight date
            dateInputs[1].value = dates.picTo || '';       // PIC last flight date
            dateInputs[2].value = dates.sicFrom || '';     // SIC first flight date  
            dateInputs[3].value = dates.sicTo || '';       // SIC last flight date
            
            // Update the date display spans if they exist
            dateInputs.forEach(dateInput => {
              const span = dateInput.closest('.date-cell')?.querySelector('.date-print');
              if (span && dateInput.value) {
                span.textContent = toDDMMMYYYY(dateInput.value);
              }
            });
            
            console.log(`‚úÖ Dates populated for section ${index + 1}:`, {
              picFrom: dateInputs[0].value,
              picTo: dateInputs[1].value,
              sicFrom: dateInputs[2].value,
              sicTo: dateInputs[3].value
            });
          } else {
            console.log(`‚ö†Ô∏è Cannot populate dates for section ${index + 1}:`, {
              hasDates: !!dates,
              dateInputsCount: dateInputs.length
            });
          }
        });
        
        // Add event listeners to all restored time fields
        console.log('üîß Adding event listeners to restored time fields...');
        const restoredTimeFields = sectionsWrap.querySelectorAll('.hhmm');
        console.log(`üîß Found ${restoredTimeFields.length} time fields in restored sections`);
        restoredTimeFields.forEach((field, index) => {
          // Add specific blur event listener to ensure processing works
          field.addEventListener('blur', function() {
            console.log(`üéØ Direct blur event on restored time field: ${this.className}, value: "${this.value}"`);
            padHHMM(this);
            computeAll();
          });
          
          // Note: Enter key navigation is handled by the global document handler
          
          console.log(`  - Restored time field ${index + 1}: ${field.className} event listeners added`);
        });
        
        // Restore summary hours if available
        if (formData.flightExperience.summaryHours) {
          console.log('üìä Populating summary hours...');
          console.log('üìä Summary data to restore:', formData.flightExperience.summaryHours);
          
          const summaryInputs = document.querySelectorAll('.form-step[data-step="2"] .summary table tbody input.hhmm');
          console.log('üìä Found summary inputs for restoration:', summaryInputs.length);
          console.log('üìä Summary inputs:', Array.from(summaryInputs).map(input => input.placeholder));
          
          const summaryHours = formData.flightExperience.summaryHours;
          
          if (summaryInputs.length >= 9) {
            console.log('üìä Restoring individual summary fields...');
            
            summaryInputs[0].value = summaryHours.pic || '0:00';
            console.log('üìä PIC/P1:', summaryInputs[0].value);
            
            summaryInputs[1].value = summaryHours.sic || '0:00';
            console.log('üìä SIC/P2:', summaryInputs[1].value);
            
            summaryInputs[2].value = summaryHours.solo || '0:00';
            console.log('üìä Solo:', summaryInputs[2].value);
            
            summaryInputs[3].value = summaryHours.instrument || '0:00';
            console.log('üìä Instrument:', summaryInputs[3].value);
            
            summaryInputs[4].value = summaryHours.sim || '0:00';
            console.log('üìä Sim:', summaryInputs[4].value);
            
            summaryInputs[5].value = summaryHours.night || '0:00';
            console.log('üìä Night:', summaryInputs[5].value);
            
            summaryInputs[6].value = summaryHours.instructor || '0:00';
            console.log('üìä Instructor:', summaryInputs[6].value);
            
            summaryInputs[7].value = summaryHours.p1us || '0:00';
            console.log('üìä P1 U/S:', summaryInputs[7].value);
            
            summaryInputs[8].value = summaryHours.grandTotal || '0:00';
            console.log('üìä Grand Total:', summaryInputs[8].value);
            
            console.log('‚úÖ All summary hours restored successfully');
          } else {
            console.log('‚ö†Ô∏è Expected 9 summary inputs but found:', summaryInputs.length);
            console.log('‚ö†Ô∏è Available inputs:', Array.from(summaryInputs));
          }
        } else {
          console.log('‚ö†Ô∏è No summary hours data found in formData');
        }
        
        // Recompute totals after populating all sections
        setTimeout(() => {
          if (typeof computeAll === 'function') {
            computeAll();
          }
        }, 100);
      }
      
      // Step 3: Documentation - populate all document fields
      if (formData.documentation) {
        console.log('üìÑ Populating documentation fields...');
        const docs = formData.documentation;
        
        // Populate all document fields that exist in the form
        const docFields = [
          // Pilot License
          { id: 'licenseType', value: docs.licenseType },
          { id: 'licenseNumber', value: docs.licenseNumber },
          { id: 'licenseIssue', value: docs.licenseIssue },
          { id: 'licenseExpiry', value: docs.licenseExpiry },
          
          // Medical Certificate
          { id: 'medicalClass', value: docs.medicalClass },
          { id: 'medicalAuthority', value: docs.medicalAuthority },
          { id: 'medicalIssue', value: docs.medicalIssue },
          { id: 'medicalExpiry', value: docs.medicalExpiry },
          
          // Radio Operator License
          { id: 'rolNumber', value: docs.rolNumber },
          { id: 'rolAuthority', value: docs.rolAuthority },
          { id: 'rolIssue', value: docs.rolIssue },
          { id: 'rolExpiry', value: docs.rolExpiry },
          
          // Passport
          { id: 'passportNumber', value: docs.passportNumber },
          { id: 'passportNationality', value: docs.passportNationality },
          { id: 'passportIssue', value: docs.passportIssue },
          { id: 'passportExpiry', value: docs.passportExpiry },
          
          // UAE Visa & Work Permit
          { id: 'visaStatus', value: docs.visaStatus },
          { id: 'visaExpiry', value: docs.visaExpiry },
          
          // Flight Hours Verification Letter
          { id: 'flightHoursAuthority', value: docs.flightHoursAuthority },
          { id: 'flightHoursIssue', value: docs.flightHoursIssue },
          
          // License Verification Letter
          { id: 'licenseVerificationAuthority', value: docs.licenseVerificationAuthority },
          { id: 'licenseVerificationDate', value: docs.licenseVerificationDate },
          
          // No Incident/Accident Letter
          { id: 'incidentLetterAuthority', value: docs.incidentLetterAuthority },
          { id: 'incidentLetterDate', value: docs.incidentLetterDate },
          
          // Emirates ID
          { id: 'emiratesIdNumber', value: docs.emiratesIdNumber },
          { id: 'emiratesIdIssue', value: docs.emiratesIdIssue },
          { id: 'emiratesIdExpiry', value: docs.emiratesIdExpiry },
          
          
          // English Proficiency Certificate
          { id: 'englishLevel', value: docs.englishLevel },
          { id: 'englishTestType', value: docs.englishTestType },
          { id: 'englishTestDate', value: docs.englishTestDate }
        ];
        
        docFields.forEach(field => {
          const element = document.getElementById(field.id);
          if (element && field.value) {
            element.value = field.value;
            console.log(`‚úÖ ${field.id}: ${field.value}`);
          } else if (!element && field.value) {
            console.log(`‚ö†Ô∏è Element not found: ${field.id}`);
          }
        });
        
        console.log('üìÑ Documentation fields populated:', docFields.filter(f => f.value).length, 'of', docFields.length);
      }
      
      // Step 4: Declaration - Always start unchecked for final confirmation
      const declarationCheckbox = document.getElementById('declaration');
      if (declarationCheckbox) {
        declarationCheckbox.checked = false; // Force unchecked for review confirmation
        console.log(`‚úÖ Declaration checkbox reset to unchecked for final confirmation`);
      }
      
      // Step 4: Restore file upload indicators
      if (formData.documentation) {
        console.log('üìé Restoring file upload indicators...');
        restoreFileUploadIndicators(formData.documentation);
      }
      
      // Step 4: Restore signature and declaration data
      if (formData.declaration) {
        console.log('‚úçÔ∏è Restoring signature and declaration data...');
        const decl = formData.declaration;
        
        // Restore declaration checkbox
        const declarationBox = document.getElementById('declaration');
        if (declarationBox && decl.agreed) {
          declarationBox.checked = decl.agreed;
        }
        
        // Restore signature date
        const sigDate = document.getElementById('sigDate');
        if (sigDate && decl.signatureDate) {
          sigDate.value = decl.signatureDate;
          // Update the display span
          const sigDatePrint = document.getElementById('sigDatePrint');
          if (sigDatePrint) {
            sigDatePrint.textContent = toDDMMMYYYY(decl.signatureDate);
          }
        }
        
        // Restore typed signature field
        const typedSig = document.getElementById('typedSig');
        if (typedSig && decl.typedSignature) {
          typedSig.value = decl.typedSignature;
        }
        
        // Restore signature canvas if signature data exists
        if (decl.signatureData) {
          const canvas = document.getElementById('sigCanvas');
          if (canvas) {
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.onload = function() {
              ctx.clearRect(0, 0, canvas.width, canvas.height);
              ctx.drawImage(img, 0, 0);
            };
            img.src = decl.signatureData;
          }
        }
        
        console.log('‚úÖ Signature and declaration data restored');
      }
      
      console.log('‚úÖ === FORM FIELDS POPULATION COMPLETE ===');
    }
    
    // Restore file upload indicators for previously uploaded files
    function restoreFileUploadIndicators(documentation) {
      console.log('üìé === RESTORING FILE UPLOAD INDICATORS ===');
      console.log('üìé Documentation data:', documentation);
      console.log('üìé Saved uploaded files:', window.savedUploadedFiles);
      const fileFields = [
        { id: 'licenseFile', key: 'licenseFile', label: 'Pilot License' },
        { id: 'medicalFile', key: 'medicalFile', label: 'Medical Certificate' },
        { id: 'rolFile', key: 'rolFile', label: 'Radio Operator License' },
        { id: 'passportFile', key: 'passportFile', label: 'Passport' },
        { id: 'visaFile', key: 'visaFile', label: 'UAE Visa' },
        { id: 'flightHoursFile', key: 'flightHoursFile', label: 'Flight Hours Verification' },
        { id: 'licenseVerificationFile', key: 'licenseVerificationFile', label: 'License Verification' },
        { id: 'incidentLetterFile', key: 'incidentLetterFile', label: 'No Incident Letter' },
        { id: 'emiratesIdFile', key: 'emiratesIdFile', label: 'Emirates ID' },
        { id: 'englishFile', key: 'englishFile', label: 'English Proficiency' }
      ];
      
      fileFields.forEach(({ id, key, label }) => {
        // Check if file was previously uploaded and is still missing
        const savedFile = window.savedUploadedFiles && window.savedUploadedFiles[id];
        const currentFile = document.getElementById(id)?.files?.[0];
        
        // Only show indicator if file was previously uploaded but is not currently selected
        if (savedFile && !currentFile) {
          const fileInput = document.getElementById(id);
          if (fileInput) {
            // Create or update the file restoration indicator
            let indicator = fileInput.parentElement.querySelector('.file-restoration-indicator');
            if (!indicator) {
              indicator = document.createElement('div');
              indicator.className = 'file-restoration-indicator';
              indicator.style.cssText = `
                margin-top: 8px;
                padding: 8px 12px;
                background: #fff3cd;
                border: 1px solid #ffc107;
                border-radius: 6px;
                font-size: 12px;
                color: #856404;
              `;
              fileInput.parentElement.appendChild(indicator);
            }
            
            indicator.innerHTML = `
              <div style="display: flex; align-items: center; gap: 8px;">
                <span style="color: #dc6545;">‚ö†Ô∏è</span>
                <div>
                  <div style="font-weight: 600;">Previously uploaded: ${savedFile.name}</div>
                  <div style="font-size: 11px; opacity: 0.8;">Please re-upload this file to continue</div>
                </div>
              </div>
            `;
            
            // Hide the indicator when a new file is selected
            fileInput.addEventListener('change', function() {
              if (this.files && this.files[0]) {
                // Validate file size before proceeding
                if (!validateFileSize(this)) {
                  return; // Stop processing if file size validation fails
                }
                
                indicator.style.display = 'none';
                // Update saved files info
                if (window.savedUploadedFiles) {
                  delete window.savedUploadedFiles[this.id];
                }
                // Save the form data to persist the file upload
                saveFormData();
                console.log(`üìé File re-uploaded for ${this.id}, indicator hidden`);
              }
            });
            
            // Also remove indicator if the file input is cleared
            fileInput.addEventListener('input', function() {
              if (!this.files || this.files.length === 0) {
                indicator.style.display = 'none';
              }
            });
            
            console.log(`üìé Added restoration indicator for ${label}: ${savedFile.name}`);
          }
        }
      });
    }
    
    // Show notification about file restoration requirements
    function showFileRestorationNotification() {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 80px;
        right: 20px;
        background: #fef3c7;
        border: 2px solid #f59e0b;
        border-radius: 12px;
        padding: 16px 20px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        z-index: 10000;
        max-width: 400px;
        font-size: 14px;
        color: #92400e;
      `;
      
      notification.innerHTML = `
        <div style="display: flex; align-items: start; gap: 12px;">
          <span style="font-size: 20px; margin-top: 2px;">üìé</span>
          <div>
            <div style="font-weight: 600; margin-bottom: 8px;">Files Need Re-uploading</div>
            <div style="line-height: 1.4; margin-bottom: 12px;">
              Your form data has been restored, but uploaded files need to be re-selected for security reasons. 
              Look for yellow warning boxes next to file upload fields.
            </div>
            <button onclick="this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode)" 
                    style="background: #f59e0b; border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 600;">
              Got it
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(notification);
      
      // Auto-remove after 15 seconds
      setTimeout(() => {
        if (notification.parentNode) {
          notification.parentNode.removeChild(notification);
        }
      }, 15000);
    }

    // Check if form has unsaved changes
    function hasFormChanges() {
      const currentData = { ...formData };
      collectFormData();
      return JSON.stringify(currentData) !== JSON.stringify(formData);
    }

    // Show auto-save status
    function showAutoSaveStatus(message, type) {
      const statusEl = document.getElementById('autoSaveStatus');
      const spinner = statusEl.querySelector('.spinner');
      const text = statusEl.querySelector('.status-text');
      
      statusEl.className = `auto-save-status ${type}`;
      text.textContent = message;
      
      if (type === 'saving') {
        spinner.style.display = 'inline-block';
      } else {
        spinner.style.display = 'none';
      }
      
      // Clear status after 3 seconds
      setTimeout(() => {
        if (statusEl.classList.contains(type)) {
          statusEl.className = 'auto-save-status';
          text.textContent = 'Ready';
          spinner.style.display = 'none';
        }
      }, 3000);
    }

    // Navigate to next step
    function nextStep() {
      console.log('‚û°Ô∏è === NEXT STEP NAVIGATION ===');
      console.log('üìç Current step before validation:', currentStep);
      console.log('üìç Total steps:', totalSteps);
      
      const isValid = validateCurrentStep();
      console.log('‚úÖ Step validation result:', isValid);
      
      if (isValid) {
        console.log('üìù Collecting form data...');
        collectFormData();
        console.log('üíæ Saving form data...');
        saveFormData();
        
        if (currentStep < totalSteps) {
          console.log('üîÑ Moving from step', currentStep, 'to step', currentStep + 1);
          currentStep++;
          showStep(currentStep);
        } else {
          console.log('üèÅ Final step reached - performing final validation before submission...');
          
          // Perform comprehensive final validation before submission
          const finalValidation = performFinalValidation();
          if (finalValidation.isValid) {
            console.log('‚úÖ Final validation passed - submitting form...');
            submitForm();
          } else {
            console.log('‚ùå Final validation failed:', finalValidation.errors);
            showValidationErrors(finalValidation.errors);
            return;
          }
        }
      } else {
        console.log('‚ùå Validation failed, staying on step:', currentStep);
      }
      console.log('‚úÖ === NEXT STEP NAVIGATION COMPLETE ===');
    }

    // Navigate to previous step  
    function previousStep() {
      console.log('‚¨ÖÔ∏è === PREVIOUS STEP NAVIGATION ===');
      console.log('üìç Current step:', currentStep);
      
      console.log('üìù Collecting form data...');
      collectFormData();
      console.log('üíæ Saving form data...');
      saveFormData();
      
      if (currentStep > 1) {
        console.log('üîÑ Moving from step', currentStep, 'to step', currentStep - 1);
        currentStep--;
        showStep(currentStep);
      } else {
        console.log('üèÅ Already at first step:', currentStep);
      }
      console.log('‚úÖ === PREVIOUS STEP NAVIGATION COMPLETE ===');
    }

    // Show specific step
    function showStep(step) {
      console.log('üîÑ === SHOWING STEP ===');
      console.log('üéØ Target step:', step);
      console.log('üìç Current step variable:', currentStep);
      
      // Hide all steps
      const allSteps = document.querySelectorAll('.form-step');
      console.log('üìã Total step elements found:', allSteps.length);
      
      allSteps.forEach((stepEl, index) => {
        const wasActive = stepEl.classList.contains('active');
        const stepNumber = stepEl.getAttribute('data-step');
        stepEl.classList.remove('active');
        if (wasActive) {
          console.log('üëÅÔ∏è Hiding step element:', stepNumber);
        }
      });
      
      // Show current step
      const currentStepEl = document.querySelector(`.form-step[data-step="${step}"]`);
      console.log('üîç Found step element for step', step, ':', !!currentStepEl);
      
      if (currentStepEl) {
        currentStepEl.classList.add('active');
        console.log('üëÅÔ∏è Showing step element:', step);
        
        // Generate summary if showing review step
        if (step === 4) {
          console.log('üìÑ Generating application summary...');
          collectFormData();
          generateApplicationSummary();
          
          // Re-setup signature canvas now that it's visible
          setTimeout(() => {
            const canvas = document.getElementById('sigCanvas');
            if (canvas) {
              const ctx = canvas.getContext('2d');
              const ratio = Math.max(window.devicePixelRatio || 1, 1);
              const rect = canvas.getBoundingClientRect();
              
              if (rect.width > 0) {
                // Canvas is now visible, set up with proper dimensions
                canvas.width = rect.width * ratio; 
                canvas.height = 160 * ratio;
                ctx.setTransform(ratio,0,0,ratio,0,0); 
                ctx.lineWidth = 2; 
                ctx.lineJoin='round'; 
                ctx.lineCap='round'; 
                ctx.strokeStyle = '#111827';
              }
            }
          }, 100);
        }
      } else {
        console.error('‚ùå Step element not found for step:', step);
      }
      
      updateProgress();
      updateNavigation();
      console.log('‚úÖ === STEP DISPLAY COMPLETE ===');
    }

    // Update progress bar and steps
    function updateProgress() {
      console.log('üìä === UPDATING PROGRESS ===');
      console.log('üìç Current step:', currentStep);
      console.log('üìç Total steps:', totalSteps);
      
      const progress = ((currentStep - 1) / (totalSteps - 1)) * 100;
      console.log('üìä Progress percentage:', progress.toFixed(1) + '%');
      
      const progressFill = document.getElementById('progressFill');
      if (progressFill) {
        progressFill.style.width = `${progress}%`;
        console.log('‚úÖ Progress bar updated');
      } else {
        console.error('‚ùå Progress fill element not found');
      }
      
      // Update step indicators
      const stepElements = document.querySelectorAll('.step');
      console.log('üî¢ Step indicator elements found:', stepElements.length);
      
      stepElements.forEach((stepEl, index) => {
        const stepNumber = index + 1;
        const wasCompleted = stepEl.classList.contains('completed');
        const wasActive = stepEl.classList.contains('active');
        
        stepEl.classList.remove('active', 'completed');
        
        if (stepNumber < currentStep) {
          stepEl.classList.add('completed');
          if (!wasCompleted) console.log(`‚úÖ Step ${stepNumber} marked as completed`);
        } else if (stepNumber === currentStep) {
          stepEl.classList.add('active');
          if (!wasActive) console.log(`üëÅÔ∏è Step ${stepNumber} marked as active`);
        }
      });
      
      console.log('‚úÖ === PROGRESS UPDATE COMPLETE ===');
    }

    // Update navigation buttons
    function updateNavigation() {
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      
      prevBtn.style.display = currentStep > 1 ? 'inline-flex' : 'none';
      nextBtn.textContent = currentStep === totalSteps ? 'Submit Application' : 'Next Step';
    }

    // Perform comprehensive final validation before submission
    function performFinalValidation() {
      console.log('üîç === PERFORMING FINAL VALIDATION ===');
      
      let allErrors = [];
      let isValid = true;
      
      // Validate all steps thoroughly
      console.log('üìã Validating Personal Information...');
      if (!validatePersonalInfo()) {
        allErrors.push('Personal Information is incomplete');
        isValid = false;
      }
      
      console.log('‚úàÔ∏è Validating Flight Experience...');
      if (!validateFlightExperience()) {
        allErrors.push('Flight Experience is incomplete');
        isValid = false;
      }
      
      console.log('üìÑ Validating Documentation...');
      if (!validateDocumentation()) {
        allErrors.push('Required documents are missing');
        isValid = false;
      }
      
      console.log('‚úçÔ∏è Validating Declaration...');
      if (!validateDeclaration()) {
        allErrors.push('Declaration and signature are incomplete');
        isValid = false;
      }
      
      // Additional checks for critical data
      collectFormData(); // Ensure latest data is collected
      
      console.log('üîç Checking collected form data...');
      console.log('Form data structure:', {
        hasPersonalInfo: !!formData.personalInfo,
        hasFlightExperience: !!formData.flightExperience,
        hasDocumentation: !!formData.documentation,
        hasDeclaration: !!formData.declaration
      });
      
      // Check if personal info has actual values (not just empty strings)
      if (!formData.personalInfo || !formData.personalInfo.pilotName || formData.personalInfo.pilotName.trim() === '') {
        allErrors.push('Pilot name is required');
        isValid = false;
      }
      
      // Check for uploaded files
      const fileInputs = document.querySelectorAll('input[type="file"]');
      let hasFiles = false;
      fileInputs.forEach(input => {
        if (input.files && input.files.length > 0) {
          hasFiles = true;
        }
      });
      
      if (!hasFiles) {
        allErrors.push('At least one document must be uploaded');
        isValid = false;
      }
      
      // Check signature
      const canvas = document.getElementById('sigCanvas');
      let hasSignature = false;
      if (canvas) {
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        hasSignature = imageData.data.some(channel => channel !== 0);
      }
      
      if (!hasSignature) {
        allErrors.push('Digital signature is required');
        isValid = false;
      }
      
      console.log('üîç Final validation result:', {
        isValid,
        errorCount: allErrors.length,
        errors: allErrors
      });
      
      return { isValid, errors: allErrors };
    }
    
    // Show validation errors to user
    function showValidationErrors(errors) {
      const errorList = errors.map(error => `<li style="margin: 8px 0;">${error}</li>`).join('');
      
      showErrorModal(
        'Form Incomplete',
        'Your application cannot be submitted because some required information is missing.',
        errors.map(error => `Fix: ${error}`),
        `Found ${errors.length} validation error(s)`
      );
    }

    // Validate current step
    function validateCurrentStep() {
      console.log('üîç === VALIDATING CURRENT STEP ===');
      console.log('üìç Current step:', currentStep);
      
      let isValid = false;
      
      if (currentStep === 1) {
        console.log('‚úÖ Validating Step 1: Personal Information');
        isValid = validatePersonalInfo();
      } else if (currentStep === 2) {
        console.log('‚úÖ Validating Step 2: Flight Experience');
        isValid = validateFlightExperience();
      } else if (currentStep === 3) {
        console.log('‚úÖ Validating Step 3: Documentation');
        isValid = validateDocumentation();
      } else if (currentStep === 4) {
        console.log('‚úÖ Validating Step 4: Declaration');
        isValid = validateDeclaration();
      } else {
        console.log('‚ö†Ô∏è No validation defined for step:', currentStep);
        isValid = true;
      }
      
      console.log('üîç Validation result:', isValid);
      console.log('‚úÖ === STEP VALIDATION COMPLETE ===');
      return isValid;
    }

    // Submit form to server
    async function submitForm() {
      console.log('üì® === SUBMITTING FORM ===');
      
      // Show loading state
      const nextBtn = document.getElementById('nextBtn');
      const originalText = nextBtn.textContent;
      nextBtn.textContent = 'Submitting...';
      nextBtn.disabled = true;
      
      try {
        // Collect current form data before submission
        collectFormData();
        
        // Prepare form data with files
        const formDataToSubmit = new FormData();
        
        // Log form data size for debugging
        const formDataJSON = JSON.stringify(formData);
        console.log('üìä Form data size:', (formDataJSON.length / 1024).toFixed(2) + ' KB');
        console.log('üìä Form data keys:', Object.keys(formData));
        
        // Add all form fields
        formDataToSubmit.append('formData', formDataJSON);
        
        // Add all uploaded files with size logging
        const fileInputs = document.querySelectorAll('input[type="file"]');
        let totalFileSize = 0;
        fileInputs.forEach(input => {
          if (input.files && input.files[0]) {
            const file = input.files[0];
            totalFileSize += file.size;
            formDataToSubmit.append(input.id, file);
            console.log(`üìé Added file: ${input.id} - ${file.name} (${(file.size / 1024).toFixed(1)} KB)`);
          }
        });
        console.log('üìä Total file size:', (totalFileSize / 1024).toFixed(2) + ' KB');
        
        console.log('üöÄ Sending form data to server...');
        
        // Submit to API
        const response = await fetch('/api/submit-form', {
          method: 'POST',
          body: formDataToSubmit
        });
        
        const result = await response.json();
        
        console.log('üì¨ Server response:', {
          ok: response.ok,
          status: response.status,
          statusText: response.statusText,
          result: result
        });
        
        if (response.ok && result.success !== false) {
          console.log('‚úÖ Form submitted successfully:', result);
          
          // Strict validation of successful email sending
          if (result.success === true && result.emailId && result.submissionId) {
            console.log('‚úÖ Email confirmed sent - Message ID:', result.emailId);
            console.log('‚úÖ Submission ID:', result.submissionId);
            showSubmissionSuccess(result);
          } else {
            console.error('‚ö†Ô∏è Response OK but email sending not confirmed:', result);
            console.error('‚ö†Ô∏è Missing required success indicators:', {
              hasSuccess: result.success === true,
              hasEmailId: !!result.emailId,
              hasSubmissionId: !!result.submissionId
            });
            
            showDetailedSubmissionError(500, { 
              error: 'Server processing completed but email delivery not confirmed',
              details: `Missing confirmation: ${!result.emailId ? 'emailId' : ''} ${!result.submissionId ? 'submissionId' : ''}`.trim()
            }, formDataJSON, totalFileSize);
          }
        } else {
          console.error('‚ùå Form submission failed:', result);
          console.error('Response status:', response.status);
          console.error('Response details:', result);
          
          // Show specific error message based on response
          showDetailedSubmissionError(response.status, result, formDataJSON, totalFileSize);
        }
        
      } catch (error) {
        console.error('‚ùå Network error during submission:', error);
        showNetworkError(error, formDataJSON, totalFileSize);
      } finally {
        // Restore button state
        nextBtn.textContent = originalText;
        nextBtn.disabled = false;
      }
      
      console.log('‚úÖ === FORM SUBMISSION COMPLETE ===');
    }
    
    // Show submission success message
    function showSubmissionSuccess(result) {
      const message = document.createElement('div');
      message.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: #10b981;
        color: white;
        padding: 20px 30px;
        border-radius: 12px;
        font-size: 16px;
        font-weight: 600;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 10000;
        text-align: center;
        min-width: 300px;
      `;
      const submissionDetails = result ? `
        <div style="font-size: 12px; font-weight: 400; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(255,255,255,0.3); opacity: 0.8;">
          <div><strong>Submission ID:</strong> ${result.submissionId}</div>
          <div><strong>Email ID:</strong> ${result.emailId ? (result.emailId.includes('@') ? result.emailId.split('@')[0] + '...' : result.emailId) : 'Processing'}</div>
          <div><strong>Time:</strong> ${new Date(result.timestamp).toLocaleString()}</div>
        </div>
      ` : '';
      
      message.innerHTML = `
        <div style="margin-bottom: 10px; font-size: 24px;">‚úÖ</div>
        <div>Application Submitted Successfully!</div>
        <div style="font-size: 14px; font-weight: 400; margin-top: 8px; opacity: 0.9;">
          Your application has been sent to flydubai for review.
        </div>
        ${submissionDetails}
        </div>
      `;
      
      document.body.appendChild(message);
      
      // Remove message after 5 seconds
      setTimeout(() => {
        if (message.parentNode) {
          message.parentNode.removeChild(message);
        }
      }, 5000);
    }
    
    // Show submission error message
    // Show detailed submission error with specific guidance
    function showDetailedSubmissionError(status, result, formDataJSON, totalFileSize) {
      let title = 'Submission Failed';
      let message = '';
      let solutions = [];
      let technicalDetails = '';
      
      // Determine specific error type and provide targeted solutions
      switch (status) {
        case 413:
          title = 'Upload Size Too Large';
          message = 'Your files are too large to upload.';
          solutions = [
            'Reduce file sizes (compress images, use PDF instead of images)',
            'Maximum total size is approximately 10MB',
            'Try uploading fewer documents at once'
          ];
          technicalDetails = `Total files: ${(totalFileSize/1024/1024).toFixed(2)}MB, Form data: ${(formDataJSON.length/1024).toFixed(1)}KB`;
          break;
          
        case 408:
          title = 'Request Timeout';
          message = 'The upload took too long and timed out.';
          solutions = [
            'Check your internet connection',
            'Reduce file sizes to speed up upload',
            'Try again when connection is more stable'
          ];
          technicalDetails = `Total files: ${(totalFileSize/1024/1024).toFixed(2)}MB`;
          break;
          
        case 400:
          title = 'Invalid Form Data';
          message = 'There was an error processing your form data.';
          solutions = [
            'Refresh the page and re-enter your information',
            'Check that all required fields are completed',
            'Try clearing your browser cache'
          ];
          technicalDetails = result.details || 'Form data validation failed';
          break;
          
        case 401:
        case 403:
          title = 'Access Denied';
          message = 'You are not authorized to submit this form.';
          solutions = [
            'Refresh the page and try again',
            'Contact the system administrator'
          ];
          break;
          
        case 429:
          title = 'Too Many Requests';
          message = 'You have submitted too many requests recently.';
          solutions = [
            'Wait a few minutes before trying again',
            'Avoid clicking submit multiple times'
          ];
          break;
          
        case 500:
          title = 'Server Error';
          if (result.error && result.error.includes('Email service')) {
            message = 'Email service is temporarily unavailable.';
            solutions = [
              'Try again in a few minutes',
              'Contact flydubai IT support if error persists'
            ];
          } else if (result.error && result.error.includes('auth')) {
            message = 'Email authentication failed.';
            solutions = [
              'This is a system configuration issue',
              'Contact flydubai IT support immediately'
            ];
            technicalDetails = 'Email service configuration error - contact IT support';
          } else {
            message = 'An internal server error occurred.';
            solutions = [
              'Try again in a few minutes',
              'If error persists, contact flydubai IT support'
            ];
          }
          technicalDetails = result.details || result.error || 'Unknown server error';
          break;
          
        case 502:
        case 503:
        case 504:
          title = 'Service Unavailable';
          message = 'The server is temporarily unavailable.';
          solutions = [
            'Try again in a few minutes',
            'The service may be under maintenance'
          ];
          break;
          
        default:
          title = 'Unexpected Error';
          message = result.error || `Server returned error code ${status}`;
          solutions = [
            'Try refreshing the page and resubmitting',
            'Contact flydubai IT support if error continues'
          ];
          technicalDetails = `Error code ${status}: ${result.details || 'Contact IT support for assistance'}`;
      }
      
      showErrorModal(title, message, solutions, technicalDetails);
    }
    
    // Show network error with specific guidance
    function showNetworkError(error, formDataJSON, totalFileSize) {
      let title = 'Connection Error';
      let message = '';
      let solutions = [];
      let technicalDetails = error.message;
      
      if (error.name === 'TypeError' && error.message.includes('fetch')) {
        message = 'Unable to connect to the server.';
        solutions = [
          'Check your internet connection',
          'Try refreshing the page',
          'Ensure you are not blocking the connection with a firewall or VPN'
        ];
      } else if (error.message.includes('timeout')) {
        message = 'The connection timed out.';
        solutions = [
          'Check your internet connection speed',
          'Reduce file sizes to speed up upload',
          `Current upload size: ${(totalFileSize/1024/1024).toFixed(2)}MB`
        ];
      } else if (error.message.includes('aborted')) {
        message = 'The upload was interrupted.';
        solutions = [
          'Try again with a stable internet connection',
          'Do not close the browser tab during submission'
        ];
      } else {
        message = 'An unexpected network error occurred.';
        solutions = [
          'Check your internet connection',
          'Try again in a few minutes',
          'Contact your IT support if the problem persists'
        ];
      }
      
      showErrorModal(title, message, solutions, technicalDetails);
    }
    
    // Generic error modal with detailed information
    function showErrorModal(title, message, solutions, technicalDetails) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7);
        z-index: 10000;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
      `;
      
      const solutionsList = solutions.map(solution => `<li style="margin: 8px 0;">${solution}</li>`).join('');
      
      modal.innerHTML = `
        <div style="
          background: white;
          border-radius: 12px;
          max-width: 600px;
          width: 100%;
          max-height: 80vh;
          overflow-y: auto;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        ">
          <div style="
            background: #ef4444;
            color: white;
            padding: 20px 30px;
            border-radius: 12px 12px 0 0;
            text-align: center;
          ">
            <div style="font-size: 32px; margin-bottom: 10px;">‚ùå</div>
            <h2 style="margin: 0; font-size: 20px; font-weight: 600;">${title}</h2>
          </div>
          
          <div style="padding: 30px;">
            <div style="margin-bottom: 25px;">
              <h3 style="color: #1f2937; margin: 0 0 10px 0; font-size: 16px;">What happened:</h3>
              <p style="color: #4b5563; margin: 0; line-height: 1.5;">${message}</p>
            </div>
            
            <div style="margin-bottom: 25px;">
              <h3 style="color: #1f2937; margin: 0 0 15px 0; font-size: 16px;">How to fix this:</h3>
              <ul style="color: #4b5563; margin: 0; padding-left: 20px; line-height: 1.6;">
                ${solutionsList}
              </ul>
            </div>
            
            ${technicalDetails ? `
            <details style="margin-bottom: 25px;">
              <summary style="color: #6b7280; cursor: pointer; font-size: 14px; font-weight: 500;">Technical Details</summary>
              <div style="
                background: #f9fafb;
                border: 1px solid #e5e7eb;
                border-radius: 6px;
                padding: 15px;
                margin-top: 10px;
                font-family: monospace;
                font-size: 12px;
                color: #374151;
                word-break: break-all;
              ">
                ${technicalDetails}
              </div>
            </details>
            ` : ''}
            
            <div style="text-align: center;">
              <button onclick="document.body.removeChild(this.closest('[style*=\"position: fixed\"]'))" 
                      style="
                        background: #3b82f6;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                        margin-right: 10px;
                      ">
                Try Again
              </button>
              <button onclick="window.location.reload()" 
                      style="
                        background: #6b7280;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-size: 14px;
                        font-weight: 600;
                        cursor: pointer;
                      ">
                Refresh Page
              </button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    // Validate personal information
    function validatePersonalInfo() {
      const requiredFields = [
        { id: 'pilotName', label: 'Pilot Name' },
        { id: 'designation', label: 'Designation' },
        { id: 'doj', label: 'Date of Joining' },
        { id: 'nationality', label: 'Nationality' },
        { id: 'contactEmail', label: 'Contact Email' },
        { id: 'dateOfBirth', label: 'Date of Birth' },
        { id: 'countryCode', label: 'Country Code' },
        { id: 'phoneNumber', label: 'Phone Number' }
      ];
      let isValid = true;
      let firstInvalidField = null;
      
      // Clear previous validation styling
      requiredFields.forEach(({ id }) => {
        const field = document.getElementById(id);
        field.classList.remove('validation-error');
        const errorMsg = field.parentElement.querySelector('.error-message');
        if (errorMsg) errorMsg.remove();
      });
      
      requiredFields.forEach(({ id, label }) => {
        const field = document.getElementById(id);
        if (!field.value.trim()) {
          field.classList.add('validation-error');
          
          // Add error message
          const errorMsg = document.createElement('span');
          errorMsg.className = 'error-message';
          errorMsg.textContent = `${label} is required`;
          field.parentElement.appendChild(errorMsg);
          
          if (isValid) firstInvalidField = field;
          isValid = false;
          
          // Clear validation styling on input
          field.addEventListener('input', () => {
            field.classList.remove('validation-error');
            const msg = field.parentElement.querySelector('.error-message');
            if (msg) msg.remove();
          }, { once: true });
        }
      });
      
      // Additional email format validation
      const emailField = document.getElementById('contactEmail');
      if (emailField.value.trim()) {
        const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if (!emailRegex.test(emailField.value.trim())) {
          emailField.classList.add('validation-error');
          
          // Add error message
          const errorMsg = document.createElement('span');
          errorMsg.className = 'error-message';
          errorMsg.textContent = 'Please enter a valid email address (e.g., name@example.com)';
          emailField.parentElement.appendChild(errorMsg);
          
          if (isValid) firstInvalidField = emailField;
          isValid = false;
          
          // Clear validation styling on input
          emailField.addEventListener('input', () => {
            emailField.classList.remove('validation-error');
            const msg = emailField.parentElement.querySelector('.error-message');
            if (msg) msg.remove();
          }, { once: true });
        }
      }
      
      if (!isValid) {
        if (firstInvalidField) firstInvalidField.focus();
        alert('Please fill in all required fields and correct any errors before continuing.');
      }
      
      return isValid;
    }

    // Validate flight experience
    // Validation function to check if all "Other" fields are properly filled (from original)
    function validateOtherFields(){
      const sections = document.querySelectorAll('#sections .section');
      let isValid = true;
      
      // Clear previous validation styling
      sections.forEach(section => {
        const notesField = section.querySelector('.ac-notes');
        if(notesField) notesField.classList.remove('required-empty');
      });
      
      for(let section of sections){
        const aircraftSelect = section.querySelector('.ac-type');
        const notesField = section.querySelector('.ac-notes');
        if(aircraftSelect && aircraftSelect.value === 'Other - Specify in Notes'){
          if(!notesField || !notesField.value.trim()){
            const sectionTitle = section.querySelector('.section-title h3').textContent;
            if(notesField) {
              notesField.classList.add('required-empty');
              if(isValid) notesField.focus(); // Focus on first invalid field
            }
            if(isValid) alert(`Please specify the aircraft type in the notes field for ${sectionTitle}`);
            isValid = false;
          }
        }
      }
      
      return isValid;
    }

    function validateFlightExperience() {
      // First validate "Other" fields like the original form
      if (!validateOtherFields()) {
        return false;
      }
      
      // Check if at least one aircraft section has data and validate all fields
      const sections = document.querySelectorAll('#sections .section');
      let hasData = false;
      let hasDateError = false;
      let hasTimeError = false;
      let firstErrorField = null;
      
      sections.forEach((section, index) => {
        const aircraftType = section.querySelector('.ac-type')?.value;
        const inputs = section.querySelectorAll('.hhmm');
        const dateInputs = section.querySelectorAll('.date-inp');
        const sectionTitle = section.querySelector('.section-title h3')?.textContent || `Section ${index + 1}`;
        
        if (aircraftType) {
          hasData = true;
          
          // Validate time fields in this section (all 6 must be filled)
          inputs.forEach((timeInput, timeIndex) => {
            if (timeInput && (!timeInput.value.trim() || timeInput.value === '0:00')) {
              hasTimeError = true;
              if (!firstErrorField) firstErrorField = timeInput;
              
              // Add visual error indication
              timeInput.style.borderColor = '#dc2626';
              timeInput.style.backgroundColor = '#fef2f2';
              timeInput.style.borderWidth = '2px';
              timeInput.style.boxShadow = '0 0 0 1px #dc2626';
              
              // Remove error styling when user starts typing
              timeInput.addEventListener('input', function() {
                this.style.borderColor = '';
                this.style.backgroundColor = '';
                this.style.borderWidth = '';
                this.style.boxShadow = '';
              }, { once: true });
            }
          });
          
          // Validate date fields in this section
          dateInputs.forEach((dateInput, dateIndex) => {
            if (dateInput && !dateInput.value.trim()) {
              hasDateError = true;
              if (!firstErrorField) firstErrorField = dateInput;
              
              // Add visual error indication with stronger styling
              dateInput.style.borderColor = '#dc2626 !important';
              dateInput.style.backgroundColor = '#fef2f2 !important';
              dateInput.style.borderWidth = '2px';
              dateInput.style.boxShadow = '0 0 0 1px #dc2626';
              
              // Also highlight the parent date-cell if it exists
              const dateCell = dateInput.closest('.date-cell');
              if (dateCell) {
                dateCell.style.borderColor = '#dc2626';
                dateCell.style.backgroundColor = '#fef2f2';
                dateCell.style.border = '2px solid #dc2626';
                dateCell.style.borderRadius = '4px';
              }
              
              // Remove error styling when user starts typing
              dateInput.addEventListener('input', function() {
                this.style.borderColor = '';
                this.style.backgroundColor = '';
                this.style.borderWidth = '';
                this.style.boxShadow = '';
                
                // Also clear parent cell styling
                const cell = this.closest('.date-cell');
                if (cell) {
                  cell.style.borderColor = '';
                  cell.style.backgroundColor = '';
                  cell.style.border = '';
                  cell.style.borderRadius = '';
                }
              }, { once: true });
            }
          });
        }
      });
      
      if (!hasData) {
        alert('Please add at least one aircraft type and select it from the dropdown before continuing.');
        return false;
      }
      
      // Validate summary/grand total fields (9 fields: PIC/P1, SIC/P2, Solo, Instrument, Sim, Night, Instructor, P1 U/S, Grand Total)
      const summaryTableInputs = document.querySelectorAll('.form-step[data-step="2"] .summary table tbody input.hhmm');
      summaryTableInputs.forEach((summaryInput, index) => {
        if (summaryInput && (!summaryInput.value.trim() || summaryInput.value === '0:00')) {
          hasTimeError = true;
          if (!firstErrorField) firstErrorField = summaryInput;
          
          // Add visual error indication
          summaryInput.style.borderColor = '#dc2626';
          summaryInput.style.backgroundColor = '#fef2f2';
          summaryInput.style.borderWidth = '2px';
          summaryInput.style.boxShadow = '0 0 0 1px #dc2626';
          
          // Remove error styling when user starts typing
          summaryInput.addEventListener('input', function() {
            this.style.borderColor = '';
            this.style.backgroundColor = '';
            this.style.borderWidth = '';
            this.style.boxShadow = '';
          }, { once: true });
        }
      });
      
      // Validate footer total fields (Multi-Pilot and Night hours)
      const footerMultiPilotField = document.querySelector('.footer-fields .hhmm.mp');
      const footerNightField = document.querySelector('.footer-fields .hhmm.night');
      
      if (footerMultiPilotField && (!footerMultiPilotField.value.trim() || footerMultiPilotField.value === '0:00')) {
        hasTimeError = true;
        if (!firstErrorField) firstErrorField = footerMultiPilotField;
        
        // Add visual error indication
        footerMultiPilotField.style.borderColor = '#dc2626';
        footerMultiPilotField.style.backgroundColor = '#fef2f2';
        footerMultiPilotField.style.borderWidth = '2px';
        footerMultiPilotField.style.boxShadow = '0 0 0 1px #dc2626';
        
        // Remove error styling when user starts typing
        footerMultiPilotField.addEventListener('input', function() {
          this.style.borderColor = '';
          this.style.backgroundColor = '';
          this.style.borderWidth = '';
          this.style.boxShadow = '';
        }, { once: true });
      }
      
      if (footerNightField && (!footerNightField.value.trim() || footerNightField.value === '0:00')) {
        hasTimeError = true;
        if (!firstErrorField) firstErrorField = footerNightField;
        
        // Add visual error indication
        footerNightField.style.borderColor = '#dc2626';
        footerNightField.style.backgroundColor = '#fef2f2';
        footerNightField.style.borderWidth = '2px';
        footerNightField.style.boxShadow = '0 0 0 1px #dc2626';
        
        // Remove error styling when user starts typing
        footerNightField.addEventListener('input', function() {
          this.style.borderColor = '';
          this.style.backgroundColor = '';
          this.style.borderWidth = '';
          this.style.boxShadow = '';
        }, { once: true });
      }

      if (hasTimeError) {
        if (firstErrorField) {
          firstErrorField.focus();
          firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        alert('Please fill in all flight time fields including the total fields at the bottom of the page.');
        return false;
      }
      
      if (hasDateError) {
        if (firstErrorField) {
          firstErrorField.focus();
          firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        alert('Please fill in all required date fields in the flight experience sections.');
        return false;
      }
      
      return true;
    }

    // Validate documentation
    function validateDocumentation() {
      const requiredFields = [
        // Pilot License fields
        { id: 'licenseType', label: 'License Type' },
        { id: 'licenseNumber', label: 'License Number' },
        { id: 'licenseIssue', label: 'License Issue Date' },
        { id: 'licenseExpiry', label: 'License Expiry Date' },
        
        // Medical Certificate fields
        { id: 'medicalClass', label: 'Medical Class' },
        { id: 'medicalIssue', label: 'Medical Issue Date' },
        { id: 'medicalExpiry', label: 'Medical Expiry Date' },
        
        // Radio Operator License fields
        { id: 'rolNumber', label: 'ROL Certificate Number' },
        { id: 'rolIssue', label: 'ROL Issue Date' },
        { id: 'rolExpiry', label: 'ROL Expiry Date' },
        
        // Passport fields
        { id: 'passportNumber', label: 'Passport Number' },
        { id: 'passportIssue', label: 'Passport Issue Date' },
        { id: 'passportExpiry', label: 'Passport Expiry Date' },
        
        // UAE Visa fields
        { id: 'visaStatus', label: 'Current Visa Status' },
        { id: 'visaNumber', label: 'Visa/Entry Permit Number' },
        { id: 'visaExpiry', label: 'Visa Expiry Date' },
        
        // License Verification Letter fields
        { id: 'licenseVerificationAuthority', label: 'License Verification Authority' },
        { id: 'licenseVerificationDate', label: 'Verification Letter Date' },
        
        // No Incident/Accident Letter fields
        { id: 'incidentLetterAuthority', label: 'Incident Letter Authority' },
        { id: 'incidentLetterDate', label: 'Letter Issue Date' }
      ];
      
      const requiredFiles = [
        { id: 'licenseFile', label: 'Pilot License Document' },
        { id: 'medicalFile', label: 'Medical Certificate' },
        { id: 'rolFile', label: 'Radio Operator License' },
        { id: 'passportFile', label: 'Passport Copy' },
        { id: 'visaFile', label: 'UAE Visa & Work Permit' },
        { id: 'flightHoursFile', label: 'Flight Hours Verification Letter' },
        { id: 'licenseVerificationFile', label: 'License Verification Letter' },
        { id: 'incidentLetterFile', label: 'No Incident/Accident Letter' }
      ];
      
      // Optional documents (only validate if user has started filling them)
      const optionalDocuments = [
        { 
          fields: [
            { id: 'emiratesIdNumber', label: 'Emirates ID Number' }
          ],
          file: { id: 'emiratesIdFile', label: 'Emirates ID Copy' },
          sectionName: 'Emirates ID'
        },
        { 
          fields: [
            { id: 'englishLevel', label: 'English Proficiency Level' },
            { id: 'englishTestType', label: 'Test Type' },
            { id: 'englishTestDate', label: 'Test Date' }
          ],
          file: { id: 'englishFile', label: 'English Proficiency Certificate' },
          sectionName: 'English Proficiency Certificate'
        }
      ];
      
      let isValid = true;
      let firstInvalidField = null;
      let errorMessages = [];
      
      // Clear previous validation styling
      [...requiredFields, ...requiredFiles].forEach(({ id }) => {
        const field = document.getElementById(id);
        if (field) {
          field.classList.remove('validation-error');
          const errorMsg = field.parentElement?.querySelector('.error-message');
          if (errorMsg) errorMsg.remove();
        }
      });
      
      // Clear form section error styling
      document.querySelectorAll('.form-section').forEach(section => {
        section.style.borderColor = '';
        const errorMsg = section.querySelector('.error-message');
        if (errorMsg) errorMsg.remove();
      });
      
      // Validate required form fields
      requiredFields.forEach(({ id, label }) => {
        const field = document.getElementById(id);
        
        // Skip visa fields if "No Current UAE Visa" is selected
        const visaStatus = document.getElementById('visaStatus')?.value;
        if ((id === 'visaExpiry' || id === 'visaNumber') && visaStatus === 'No Current UAE Visa') {
          return; // Skip validation for these fields
        }
        
        if (field && !field.value.trim()) {
          field.classList.add('validation-error');
          
          const errorMsg = document.createElement('span');
          errorMsg.className = 'error-message';
          errorMsg.textContent = `${label} is required`;
          errorMsg.style.color = '#dc2626';
          errorMsg.style.fontSize = '12px';
          errorMsg.style.marginTop = '4px';
          errorMsg.style.display = 'block';
          field.parentElement?.appendChild(errorMsg);
          
          if (isValid) firstInvalidField = field;
          isValid = false;
          errorMessages.push(`${label} is required`);
          
          field.addEventListener('input', () => {
            field.classList.remove('validation-error');
            const msg = field.parentElement?.querySelector('.error-message');
            if (msg) msg.remove();
          }, { once: true });
        }
      });
      
      // Validate required file uploads
      requiredFiles.forEach(({ id, label }) => {
        const fileInput = document.getElementById(id);
        
        // Skip visa file if "No Current UAE Visa" is selected
        const visaStatus = document.getElementById('visaStatus')?.value;
        if (id === 'visaFile' && visaStatus === 'No Current UAE Visa') {
          return; // Skip validation for visa file
        }
        
        if (fileInput && (!fileInput.files || fileInput.files.length === 0)) {
          const formSection = fileInput.closest('.form-section');
          if (formSection) {
            formSection.style.borderColor = '#dc2626';
            formSection.style.backgroundColor = '#fef2f2';
            
            // Create or update error message
            let errorMsg = formSection.querySelector('.error-message');
            if (!errorMsg) {
              errorMsg = document.createElement('div');
              errorMsg.className = 'error-message';
              errorMsg.style.color = '#dc2626';
              errorMsg.style.fontSize = '14px';
              errorMsg.style.fontWeight = '600';
              errorMsg.style.padding = '8px 16px';
              errorMsg.style.marginTop = '12px';
              errorMsg.style.backgroundColor = '#fee2e2';
              errorMsg.style.border = '1px solid #fca5a5';
              errorMsg.style.borderRadius = '6px';
              formSection.appendChild(errorMsg);
            }
            errorMsg.innerHTML = `<strong>‚ö†Ô∏è ${label} is required</strong><br>Please upload the required document to continue.`;
          }
          
          if (isValid) firstInvalidField = fileInput;
          isValid = false;
          errorMessages.push(`${label} document must be uploaded`);
          
          fileInput.addEventListener('change', () => {
            // Validate file size first
            if (fileInput.files && fileInput.files[0] && !validateFileSize(fileInput)) {
              return; // Stop processing if file size validation fails
            }
            
            if (formSection) {
              formSection.style.borderColor = '';
              formSection.style.backgroundColor = '';
            }
            const msg = formSection?.querySelector('.error-message');
            if (msg) msg.remove();
          }, { once: true });
        }
      });
      
      // Validate optional documents (if user started filling them, they must complete them)
      optionalDocuments.forEach(({ fields, file, sectionName }) => {
        const hasStartedSection = fields.some(({ id }) => {
          const field = document.getElementById(id);
          return field && field.value.trim();
        });
        
        if (hasStartedSection) {
          // If user started this optional section, all fields become required
          fields.forEach(({ id, label }) => {
            const field = document.getElementById(id);
            
            // Skip English test date if "Attached to License" is selected
            if (id === 'englishTestDate') {
              const englishTestType = document.getElementById('englishTestType');
              if (englishTestType && englishTestType.value === 'Attached to License') {
                return; // Skip validation for test date
              }
            }
            
            if (field && !field.value.trim()) {
              field.classList.add('validation-error');
              
              const errorMsg = document.createElement('span');
              errorMsg.className = 'error-message';
              errorMsg.textContent = `${label} is required (since you started filling ${sectionName})`;
              errorMsg.style.color = '#dc2626';
              errorMsg.style.fontSize = '12px';
              errorMsg.style.marginTop = '4px';
              errorMsg.style.display = 'block';
              field.parentElement?.appendChild(errorMsg);
              
              if (isValid) firstInvalidField = field;
              isValid = false;
              errorMessages.push(`${label} is required since you started filling ${sectionName}`);
            }
          });
          
          // File is also required if section was started (unless it's ELP attached to license)
          const fileInput = document.getElementById(file.id);
          
          // Special case: English proficiency "attached to license" doesn't require file upload
          let skipFileValidation = false;
          if (file.id === 'englishFile') {
            const englishTestType = document.getElementById('englishTestType');
            if (englishTestType && englishTestType.value === 'Attached to License') {
              skipFileValidation = true;
            }
          }
          
          if (!skipFileValidation && fileInput && (!fileInput.files || fileInput.files.length === 0)) {
            const formSection = fileInput.closest('.form-section');
            if (formSection) {
              formSection.style.borderColor = '#dc2626';
              formSection.style.backgroundColor = '#fef2f2';
              
              let errorMsg = formSection.querySelector('.error-message');
              if (!errorMsg) {
                errorMsg = document.createElement('div');
                errorMsg.className = 'error-message';
                errorMsg.style.color = '#dc2626';
                errorMsg.style.fontSize = '14px';
                errorMsg.style.fontWeight = '600';
                errorMsg.style.padding = '8px 16px';
                errorMsg.style.marginTop = '12px';
                errorMsg.style.backgroundColor = '#fee2e2';
                errorMsg.style.border = '1px solid #fca5a5';
                errorMsg.style.borderRadius = '6px';
                formSection.appendChild(errorMsg);
              }
              errorMsg.innerHTML = `<strong>‚ö†Ô∏è ${file.label} is required</strong><br>Since you started filling ${sectionName}, the document upload is now required.`;
            }
            
            if (isValid) firstInvalidField = fileInput;
            isValid = false;
            errorMessages.push(`${file.label} is required since you started filling ${sectionName}`);
          }
        }
      });
      
      if (!isValid) {
        if (firstInvalidField) firstInvalidField.focus();
        const summaryMessage = `Please complete the following required items:\n\n${errorMessages.slice(0, 5).map(msg => `‚Ä¢ ${msg}`).join('\n')}${errorMessages.length > 5 ? `\n\n... and ${errorMessages.length - 5} more items` : ''}`;
        alert(summaryMessage);
      }
      
      return isValid;
    }

    // Validate declaration
    function validateDeclaration() {
      console.log('‚úÖ Validating declaration and signature...');
      
      // Check declaration checkbox
      const declaration = document.getElementById('declaration');
      if (!declaration.checked) {
        alert('Please accept the declaration before submitting your application.');
        return false;
      }
      
      // Check signature date
      const sigDate = document.getElementById('sigDate');
      if (!sigDate.value) {
        alert('Please select the signature date before submitting.');
        sigDate.focus();
        return false;
      }
      
      // Check if signature is present (canvas has content)
      const canvas = document.getElementById('sigCanvas');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const hasSignature = imageData.data.some(channel => channel !== 0);
        
        if (!hasSignature) {
          alert('Please provide your digital signature before submitting. You can draw on the canvas, type your name and click "Apply Typed", or upload a signature image.');
          return false;
        }
      }
      
      console.log('‚úÖ Declaration and signature validation passed');
      return true;
    }

    // Handle file upload
    function handleFileUpload(input, type) {
      const file = input.files[0];
      if (!file) return;
      
      // Validate file type
      if (file.type !== 'application/pdf') {
        alert('Please upload only PDF files.');
        input.value = '';
        return;
      }
      
      // Validate file size (10MB limit)
      if (file.size > 10 * 1024 * 1024) {
        alert('File size must be less than 10MB.');
        input.value = '';
        return;
      }
      
      // Show file in the list
      const fileListId = type + 'FileList';
      const fileList = document.getElementById(fileListId);
      
      fileList.innerHTML = `
        <div class="file-item">
          <div class="file-info">
            <div class="file-icon">üìÑ</div>
            <div class="file-details">
              <div class="file-name">${file.name}</div>
              <div class="file-size">${(file.size / 1024 / 1024).toFixed(1)} MB</div>
            </div>
          </div>
          <div class="file-status completed">‚úì Ready</div>
        </div>
      `;
      
      // Reset upload area border
      const uploadArea = input.parentElement.querySelector('.upload-area');
      uploadArea.style.borderColor = '#e2e8f0';
    }

    // Generate application summary for review step
    function generateApplicationSummary() {
      if (currentStep !== 4) return;
      
      const summaryEl = document.getElementById('applicationSummary');
      let html = '';
      
      // Personal Information Section
      if (formData.personalInfo) {
        const info = formData.personalInfo;
        html += `
          <div style="margin-bottom: 24px; padding: 20px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--flydubai-red);">
            <h3 style="color: var(--flydubai-navy); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              <span>üë®‚Äç‚úàÔ∏è</span> Personal Information
            </h3>
            <div style="display: grid; gap: 12px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));">
              ${info.pilotName ? `<div><strong>Full Name:</strong> ${info.pilotName}</div>` : ''}
              ${info.nationality ? `<div><strong>Nationality:</strong> ${info.nationality}</div>` : ''}
              ${info.contactEmail ? `<div><strong>Email:</strong> ${info.contactEmail}</div>` : ''}
              ${info.dateOfBirth ? `<div><strong>Date of Birth:</strong> ${toDDMMMYYYY(info.dateOfBirth)}</div>` : ''}
              ${info.countryCode || info.phoneNumber ? `<div><strong>Phone:</strong> ${info.countryCode || ''} ${info.phoneNumber || ''}</div>` : ''}
              ${info.designation ? `<div><strong>Current Designation:</strong> ${info.designation}</div>` : ''}
              ${info.expectedDateOfJoining ? `<div><strong>Expected Date of Joining:</strong> ${toDDMMMYYYY(info.expectedDateOfJoining)}</div>` : ''}
              ${info.previousEmployer ? `<div><strong>Previous Employer:</strong> ${info.previousEmployer}</div>` : ''}
            </div>
          </div>
        `;
      }
      
      // Flight Experience Section
      if (formData.flightExperience) {
        const flight = formData.flightExperience;
        html += `
          <div style="margin-bottom: 24px; padding: 20px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--flydubai-red);">
            <h3 style="color: var(--flydubai-navy); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              <span>‚úàÔ∏è</span> Flight Experience
            </h3>
        `;
        
        // Aircraft Sections
        if (flight.aircraftSections && flight.aircraftSections.length > 0) {
          html += `<div style="margin-bottom: 20px;">
            <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">Aircraft Experience by Type</h4>`;
          
          flight.aircraftSections.forEach((aircraft, index) => {
            if (aircraft.aircraftType || Object.values(aircraft.flightHours).some(h => h !== '0:00')) {
              html += `
                <div style="margin-bottom: 16px; padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h5 style="margin: 0; color: var(--flydubai-navy);">${aircraft.aircraftType || `Aircraft Type ${index + 1}`}</h5>
                  </div>
                  ${aircraft.notes ? `<div style="margin-bottom: 8px; color: #64748b; font-style: italic;">${aircraft.notes}</div>` : ''}
                  <div style="display: grid; gap: 6px; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); font-size: 14px;">
                    <div><strong>PIC Total Hours:</strong> ${aircraft.flightHours.picTotal || '0:00'}</div>
                    <div><strong>PIC Block Hours:</strong> ${aircraft.flightHours.picBlock || '0:00'}</div>
                    <div><strong>SIC Total Hours:</strong> ${aircraft.flightHours.sicTotal || '0:00'}</div>
                    <div><strong>SIC Block Hours:</strong> ${aircraft.flightHours.sicBlock || '0:00'}</div>
                    <div><strong>Multi-Pilot Hours:</strong> ${aircraft.flightHours.multiPilot || '0:00'}</div>
                    <div><strong>Night Hours:</strong> ${aircraft.flightHours.night || '0:00'}</div>
                  </div>
                  ${aircraft.dates.picFrom || aircraft.dates.picTo || aircraft.dates.sicFrom || aircraft.dates.sicTo ? `
                    <div style="margin-top: 12px; padding: 8px 12px; background: #f8fafc; border-radius: 6px; font-size: 12px;">
                      <strong>Flight Dates:</strong><br>
                      ${aircraft.dates.picFrom || aircraft.dates.picTo ? `PIC: ${toDDMMMYYYY(aircraft.dates.picFrom)} - ${toDDMMMYYYY(aircraft.dates.picTo)}<br>` : ''}
                      ${aircraft.dates.sicFrom || aircraft.dates.sicTo ? `SIC: ${toDDMMMYYYY(aircraft.dates.sicFrom)} - ${toDDMMMYYYY(aircraft.dates.sicTo)}` : ''}
                    </div>
                  ` : ''}
                </div>
              `;
            }
          });
          html += `</div>`;
        }
        
        // Summary Hours
        if (flight.summaryHours) {
          const summary = flight.summaryHours;
          html += `
            <div style="margin-bottom: 16px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">Flying Experience Summary</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); font-size: 14px;">
                  <div><strong>PIC/P1:</strong> ${summary.pic || '0:00'}</div>
                  <div><strong>SIC/P2:</strong> ${summary.sic || '0:00'}</div>
                  <div><strong>Solo:</strong> ${summary.solo || '0:00'}</div>
                  <div><strong>Instrument:</strong> ${summary.instrument || '0:00'}</div>
                  <div><strong>Simulator:</strong> ${summary.sim || '0:00'}</div>
                  <div><strong>Night:</strong> ${summary.night || '0:00'}</div>
                  <div><strong>Instructor:</strong> ${summary.instructor || '0:00'}</div>
                  <div><strong>P1US:</strong> ${summary.p1us || '0:00'}</div>
                </div>
              </div>
            </div>
          `;
        }
        
        // Grand Totals
        if (flight.grandTotals) {
          html += `
            <div style="margin-bottom: 16px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">Grand Totals</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); font-size: 14px;">
                  <div><strong>Combined Block Hours:</strong> ${flight.grandTotals.combined || '0:00'}</div>
                  <div><strong>Multi-Pilot Block Hours:</strong> ${flight.grandTotals.multiPilot || '0:00'}</div>
                  <div><strong>Night Hours:</strong> ${flight.grandTotals.night || '0:00'}</div>
                </div>
              </div>
            </div>
          `;
        }
        
        html += `</div>`;
      }
      
      // Documentation Section
      if (formData.documentation) {
        const docs = formData.documentation;
        html += `
          <div style="margin-bottom: 24px; padding: 20px; background: #f8fafc; border-radius: 12px; border-left: 4px solid var(--flydubai-red);">
            <h3 style="color: var(--flydubai-navy); margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
              <span>üìã</span> Documentation & Certificates
            </h3>
        `;
        
        // 1. Pilot License
        if (docs.licenseType || docs.licenseNumber) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üõÇ Pilot License</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.licenseType ? `<div><strong>License Type:</strong> ${docs.licenseType}</div>` : ''}
                  ${docs.licenseNumber ? `<div><strong>License Number:</strong> ${docs.licenseNumber}</div>` : ''}
                  ${docs.licenseIssue ? `<div><strong>Issue Date:</strong> ${toDDMMMYYYY(docs.licenseIssue)}</div>` : ''}
                  ${docs.licenseExpiry ? `<div><strong>Expiry Date:</strong> ${toDDMMMYYYY(docs.licenseExpiry)}</div>` : ''}
                  ${docs.licenseFile ? `<div><strong>Document:</strong> ${docs.licenseFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 2. Radio Operator License
        if (docs.rolNumber || docs.rolAuthority) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üìª Radio Operator License</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.rolNumber ? `<div><strong>License Number:</strong> ${docs.rolNumber}</div>` : ''}
                  ${docs.rolAuthority ? `<div><strong>Authority:</strong> ${docs.rolAuthority}</div>` : ''}
                  ${docs.rolIssue ? `<div><strong>Issue Date:</strong> ${toDDMMMYYYY(docs.rolIssue)}</div>` : ''}
                  ${docs.rolExpiry ? `<div><strong>Expiry Date:</strong> ${toDDMMMYYYY(docs.rolExpiry)}</div>` : ''}
                  ${docs.rolFile ? `<div><strong>Document:</strong> ${docs.rolFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 3. English Proficiency (only if not "Attached to License")
        if (docs.englishLevel || (docs.englishTestType && docs.englishTestType !== 'Attached to License')) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üó£Ô∏è English Proficiency</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.englishLevel ? `<div><strong>Level:</strong> ${docs.englishLevel}</div>` : ''}
                  ${docs.englishTestType ? `<div><strong>Test Type:</strong> ${docs.englishTestType}</div>` : ''}
                  ${docs.englishTestDate && docs.englishTestType !== 'Attached to License' ? `<div><strong>Test Date:</strong> ${toDDMMMYYYY(docs.englishTestDate)}</div>` : ''}
                  ${docs.englishFile ? `<div><strong>Document:</strong> ${docs.englishFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 4. Medical Certificate
        if (docs.medicalClass || docs.medicalAuthority) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üè• Medical Certificate</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.medicalClass ? `<div><strong>Medical Class:</strong> ${docs.medicalClass}</div>` : ''}
                  ${docs.medicalAuthority ? `<div><strong>Authority:</strong> ${docs.medicalAuthority}</div>` : ''}
                  ${docs.medicalIssue ? `<div><strong>Issue Date:</strong> ${toDDMMMYYYY(docs.medicalIssue)}</div>` : ''}
                  ${docs.medicalExpiry ? `<div><strong>Expiry Date:</strong> ${toDDMMMYYYY(docs.medicalExpiry)}</div>` : ''}
                  ${docs.medicalFile ? `<div><strong>Document:</strong> ${docs.medicalFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 5. Passport
        if (docs.passportNumber || docs.passportNationality) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üõÇ Passport</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.passportNumber ? `<div><strong>Passport Number:</strong> ${docs.passportNumber}</div>` : ''}
                  ${docs.passportNationality ? `<div><strong>Nationality:</strong> ${docs.passportNationality}</div>` : ''}
                  ${docs.passportIssue ? `<div><strong>Issue Date:</strong> ${toDDMMMYYYY(docs.passportIssue)}</div>` : ''}
                  ${docs.passportExpiry ? `<div><strong>Expiry Date:</strong> ${toDDMMMYYYY(docs.passportExpiry)}</div>` : ''}
                  ${docs.passportFile ? `<div><strong>Document:</strong> ${docs.passportFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 6. License Verification Letter
        if (docs.licenseVerificationAuthority || docs.licenseVerificationDate || docs.licenseVerificationFile) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üìÑ License Verification Letter</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.licenseVerificationAuthority ? `<div><strong>Authority:</strong> ${docs.licenseVerificationAuthority}</div>` : ''}
                  ${docs.licenseVerificationDate ? `<div><strong>Date:</strong> ${toDDMMMYYYY(docs.licenseVerificationDate)}</div>` : ''}
                  ${docs.licenseVerificationFile ? `<div><strong>Document:</strong> ${docs.licenseVerificationFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 7. No Incident/Accident Letter
        if (docs.incidentLetterAuthority || docs.incidentLetterDate || docs.incidentLetterFile) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üö´ No Incident/Accident Letter</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.incidentLetterAuthority ? `<div><strong>Authority:</strong> ${docs.incidentLetterAuthority}</div>` : ''}
                  ${docs.incidentLetterDate ? `<div><strong>Date:</strong> ${toDDMMMYYYY(docs.incidentLetterDate)}</div>` : ''}
                  ${docs.incidentLetterFile ? `<div><strong>Document:</strong> ${docs.incidentLetterFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 8. Flight Hours Verification Letter
        if (docs.flightHoursAuthority || docs.flightHoursIssue || docs.flightHoursFile) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">‚úÖ Flight Hours Verification Letter</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  ${docs.flightHoursAuthority ? `<div><strong>Authority:</strong> ${docs.flightHoursAuthority}</div>` : ''}
                  ${docs.flightHoursIssue ? `<div><strong>Date:</strong> ${toDDMMMYYYY(docs.flightHoursIssue)}</div>` : ''}
                  ${docs.flightHoursFile ? `<div><strong>Document:</strong> ${docs.flightHoursFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 9. Emirates ID
        if (docs.emiratesIdNumber) {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üÜî Emirates ID</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  <div><strong>Emirates ID Number:</strong> ${docs.emiratesIdNumber}</div>
                  ${docs.emiratesIdIssue ? `<div><strong>Issue Date:</strong> ${toDDMMMYYYY(docs.emiratesIdIssue)}</div>` : ''}
                  ${docs.emiratesIdExpiry ? `<div><strong>Expiry Date:</strong> ${toDDMMMYYYY(docs.emiratesIdExpiry)}</div>` : ''}
                  ${docs.emiratesIdFile ? `<div><strong>Document:</strong> ${docs.emiratesIdFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        // 10. UAE Visa & Work Permit
        if (docs.visaStatus && docs.visaStatus !== 'No Current UAE Visa') {
          html += `
            <div style="margin-bottom: 20px;">
              <h4 style="color: var(--flydubai-navy); margin-bottom: 12px;">üá¶üá™ UAE Visa & Work Permit</h4>
              <div style="padding: 16px; background: white; border-radius: 8px; border: 1px solid #e2e8f0;">
                <div style="display: grid; gap: 8px; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                  <div><strong>Visa Status:</strong> ${docs.visaStatus}</div>
                  ${docs.visaExpiry ? `<div><strong>Expiry Date:</strong> ${toDDMMMYYYY(docs.visaExpiry)}</div>` : ''}
                  ${docs.visaFile ? `<div><strong>Document:</strong> ${docs.visaFile}</div>` : ''}
                </div>
              </div>
            </div>
          `;
        }
        
        html += `</div>`;
      }
      
      summaryEl.innerHTML = html;
    }

    // Original form JavaScript for aircraft sections and calculations
    let sectionCount = 0;

    // Function to check if aircraft is above 50 tons MTOW
    function isHeavyJet(aircraftType) {
      const heavyJets = [
        // Boeing 737 variants (all above 50T MTOW)
        'Boeing 737 NG/MAX',
        'Boeing 737 Classic (300-500)',
        // Boeing Commercial Aircraft
        'Boeing 757-200', 'Boeing 757-300',
        'Boeing 767-200', 'Boeing 767-300', 
        'Boeing 777-200', 'Boeing 777-300',
        'Boeing 787-8 Dreamliner', 'Boeing 787-9 Dreamliner', 'Boeing 787-10 Dreamliner',
        // Airbus Commercial Aircraft  
        'Airbus A319', 'Airbus A320', 'Airbus A321',
        'Airbus A330-200', 'Airbus A330-300',
        'Airbus A340-200', 'Airbus A340-300',
        'Airbus A350-900', 'Airbus A350-1000',
        'Airbus A380',
        // Regional Jets above 50T
        'McDonnell Douglas MD-80', 'McDonnell Douglas MD-90',
        'Embraer E-Jet E190', 'Embraer E-Jet E195',
        'British Aerospace BAe 146', 'Avro RJ70', 'Avro RJ85', 'Avro RJ100',
        // Business Jets above 50T
        'Gulfstream G550', 'Gulfstream G600', 'Gulfstream G650', 'Gulfstream G700',
        'Bombardier Global 5000', 'Bombardier Global 5500', 'Bombardier Global 6000', 
        'Bombardier Global 6500', 'Bombardier Global 7500',
        'Dassault Falcon 2000', 'Dassault Falcon 2000EX', 'Dassault Falcon 2000LX',
        'Dassault Falcon 7X', 'Dassault Falcon 8X', 'Dassault Falcon 900',
        'Cessna Citation Longitude', 'Embraer Lineage 1000',
        // Cargo Aircraft
        'Boeing 747-400F Freighter', 'Boeing 767-300F Freighter',
        'Boeing 777F Freighter', 'Airbus A330-200F Freighter',
        'McDonnell Douglas MD-11F',
        // Military & Special Aircraft above 50T
        'Lockheed C-130 Hercules', 'Boeing KC-135 Stratotanker', 'Airbus A400M Atlas',
        'Boeing E-3 AWACS', 'Lockheed P-3 Orion', 'Boeing P-8 Poseidon',
        // Vintage & Classic Aircraft above 50T
        'Douglas DC-3', 'Boeing 727', 'McDonnell Douglas DC-9',
        'Lockheed L-1011 TriStar', 'Sud Aviation Caravelle', 'BAC One-Eleven',
        'Fokker F28', 'Fokker 100'
      ];
      return heavyJets.includes(aircraftType);
    }

    // ===== Sections builder =====
    let sectionCounter = 0;
    const sectionsWrap = document.getElementById('sections');
    
    function makeAircraftSection({label, typeText, locked=false, b737Type=null}){
      const id = ++sectionCounter;
      const sec = document.createElement('section');
      sec.className = 'section'; 
      sec.dataset.sectionId = id; 
      sec.dataset.locked = locked ? '1' : '0';
      
      let aircraftDropdown = '';
      if(b737Type) {
        // Special dropdown for Boeing 737 variants
        aircraftDropdown = `
        <div style="display: grid; grid-template-columns: 400px auto 1fr; gap: 16px; align-items: end;">
          <div>
            <select class="ac-type" ${locked ? 'disabled' : ''} style="${locked ? 'background-color: #f3f4f6; cursor: not-allowed;' : ''}">
              ${b737Type === 'ng-max' ? `
                <option value="Boeing 737 NG/MAX">Boeing 737 NG/MAX</option>
              ` : `
                <option value="Boeing 737 Classic (300-500)">Boeing 737 Classic (300-500)</option>
              `}
            </select>
          </div>
          <div class="heavy-jet-indicator" style="display: flex; align-items: center; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);">
            ‚úà >50T MTOW
          </div>
          <div class="notes-field" style="display: none;">
            <label>Notes/Comments (Required if "Other" selected above)</label>
            <input type="text" class="ac-notes" placeholder="Please specify aircraft type, model, or any additional details..." style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid var(--line); background: #ffffff; color: var(--ink); font-family: inherit; font-size: 14px;" />
          </div>
        </div>`;
      } else {
        // Regular dropdown for other aircraft - using the same comprehensive list as original
        aircraftDropdown = `
        <div style="display: grid; grid-template-columns: 400px auto 1fr; gap: 16px; align-items: end;">
          <div>
            <select class="ac-type">
              <option value="">Select Aircraft Type...</option>
              <optgroup label="Boeing Commercial Aircraft">
                <option value="Boeing 757-200">Boeing 757-200</option>
                <option value="Boeing 757-300">Boeing 757-300</option>
                <option value="Boeing 767-200">Boeing 767-200</option>
                <option value="Boeing 767-300">Boeing 767-300</option>
                <option value="Boeing 777-200">Boeing 777-200</option>
                <option value="Boeing 777-300">Boeing 777-300</option>
                <option value="Boeing 787-8">Boeing 787-8 Dreamliner</option>
                <option value="Boeing 787-9">Boeing 787-9 Dreamliner</option>
                <option value="Boeing 787-10">Boeing 787-10 Dreamliner</option>
              </optgroup>
              <optgroup label="Airbus Commercial Aircraft">
                <option value="Airbus A319">Airbus A319</option>
                <option value="Airbus A320">Airbus A320</option>
                <option value="Airbus A321">Airbus A321</option>
                <option value="Airbus A330-200">Airbus A330-200</option>
                <option value="Airbus A330-300">Airbus A330-300</option>
                <option value="Airbus A340-200">Airbus A340-200</option>
                <option value="Airbus A340-300">Airbus A340-300</option>
                <option value="Airbus A350-900">Airbus A350-900</option>
                <option value="Airbus A350-1000">Airbus A350-1000</option>
                <option value="Airbus A380">Airbus A380</option>
              </optgroup>
              <optgroup label="Regional Jets & Commercial Aircraft">
                <option value="McDonnell Douglas MD-80">McDonnell Douglas MD-80</option>
                <option value="McDonnell Douglas MD-90">McDonnell Douglas MD-90</option>
                <option value="Embraer E-Jet E170">Embraer E-Jet E170</option>
                <option value="Embraer E-Jet E175">Embraer E-Jet E175</option>
                <option value="Embraer E-Jet E190">Embraer E-Jet E190</option>
                <option value="Embraer E-Jet E195">Embraer E-Jet E195</option>
                <option value="Bombardier CRJ-100">Bombardier CRJ-100</option>
                <option value="Bombardier CRJ-200">Bombardier CRJ-200</option>
                <option value="Bombardier CRJ-700">Bombardier CRJ-700</option>
                <option value="Bombardier CRJ-900">Bombardier CRJ-900</option>
                <option value="Bombardier CRJ-1000">Bombardier CRJ-1000</option>
                <option value="British Aerospace 146">British Aerospace BAe 146</option>
                <option value="Avro RJ70">Avro RJ70</option>
                <option value="Avro RJ85">Avro RJ85</option>
                <option value="Avro RJ100">Avro RJ100</option>
                <option value="Dornier 328JET">Dornier 328JET</option>
                <option value="Fairchild Metro III">Fairchild Metro III</option>
                <option value="Jetstream 41">BAe Jetstream 41</option>
                <option value="Embraer EMB-120">Embraer EMB-120 Brasilia</option>
              </optgroup>
              <optgroup label="Cargo Aircraft">
                <option value="Boeing 747-400F">Boeing 747-400F Freighter</option>
                <option value="Boeing 767-300F">Boeing 767-300F Freighter</option>
                <option value="Boeing 777F">Boeing 777F Freighter</option>
                <option value="Airbus A330-200F">Airbus A330-200F Freighter</option>
                <option value="McDonnell Douglas MD-11F">McDonnell Douglas MD-11F</option>
              </optgroup>
              <optgroup label="Business Jets & Private Aircraft">
                <option value="Gulfstream G150">Gulfstream G150</option>
                <option value="Gulfstream G280">Gulfstream G280</option>
                <option value="Gulfstream G450">Gulfstream G450</option>
                <option value="Gulfstream G500">Gulfstream G500</option>
                <option value="Gulfstream G550">Gulfstream G550</option>
                <option value="Gulfstream G600">Gulfstream G600</option>
                <option value="Gulfstream G650">Gulfstream G650</option>
                <option value="Gulfstream G700">Gulfstream G700</option>
                <option value="Bombardier Global 5000">Bombardier Global 5000</option>
                <option value="Bombardier Global 5500">Bombardier Global 5500</option>
                <option value="Bombardier Global 6000">Bombardier Global 6000</option>
                <option value="Bombardier Global 6500">Bombardier Global 6500</option>
                <option value="Bombardier Global 7500">Bombardier Global 7500</option>
                <option value="Bombardier Challenger 300">Bombardier Challenger 300</option>
                <option value="Bombardier Challenger 350">Bombardier Challenger 350</option>
                <option value="Bombardier Challenger 600">Bombardier Challenger 600</option>
                <option value="Bombardier Challenger 650">Bombardier Challenger 650</option>
                <option value="Dassault Falcon 2000">Dassault Falcon 2000</option>
                <option value="Dassault Falcon 2000EX">Dassault Falcon 2000EX</option>
                <option value="Dassault Falcon 2000LX">Dassault Falcon 2000LX</option>
                <option value="Dassault Falcon 7X">Dassault Falcon 7X</option>
                <option value="Dassault Falcon 8X">Dassault Falcon 8X</option>
                <option value="Dassault Falcon 900">Dassault Falcon 900</option>
                <option value="Cessna Citation Longitude">Cessna Citation Longitude</option>
                <option value="Cessna Citation X">Cessna Citation X</option>
                <option value="Embraer Lineage 1000">Embraer Lineage 1000</option>
                <option value="Embraer Praetor 500">Embraer Praetor 500</option>
                <option value="Embraer Praetor 600">Embraer Praetor 600</option>
              </optgroup>
              <optgroup label="Military & Special Aircraft">
                <option value="Lockheed C-130 Hercules">Lockheed C-130 Hercules</option>
                <option value="Boeing KC-135 Stratotanker">Boeing KC-135 Stratotanker</option>
                <option value="Airbus A400M Atlas">Airbus A400M Atlas</option>
                <option value="Boeing E-3 AWACS">Boeing E-3 AWACS</option>
                <option value="Lockheed P-3 Orion">Lockheed P-3 Orion</option>
                <option value="Boeing P-8 Poseidon">Boeing P-8 Poseidon</option>
              </optgroup>
              <optgroup label="Vintage & Classic Aircraft">
                <option value="Douglas DC-3">Douglas DC-3</option>
                <option value="Boeing 727">Boeing 727</option>
                <option value="McDonnell Douglas DC-9">McDonnell Douglas DC-9</option>
                <option value="Lockheed L-1011 TriStar">Lockheed L-1011 TriStar</option>
                <option value="Sud Aviation Caravelle">Sud Aviation Caravelle</option>
                <option value="BAC One-Eleven">BAC One-Eleven</option>
                <option value="Fokker F28">Fokker F28</option>
                <option value="Fokker 100">Fokker 100</option>
              </optgroup>
              <optgroup label="Other Aircraft Types">
                <option value="Glider">Glider/Sailplane</option>
                <option value="Ultralight">Ultralight Aircraft</option>
                <option value="Experimental">Experimental Aircraft</option>
                <option value="Other - Specify in Notes">Other - Specify in Notes</option>
              </optgroup>
            </select>
          </div>
          <div class="heavy-jet-indicator" style="display: none; align-items: center; background: linear-gradient(135deg, #059669 0%, #10b981 100%); color: white; padding: 8px 12px; border-radius: 8px; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; box-shadow: 0 2px 4px rgba(5, 150, 105, 0.3);">
            ‚úà >50T MTOW
          </div>
          <div class="notes-field" style="display: none;">
            <label>Notes/Comments (Required if "Other" selected above)</label>
            <input type="text" class="ac-notes" placeholder="Please specify aircraft type, model, or any additional details..." style="width: 100%; padding: 14px 16px; border-radius: 12px; border: 2px solid var(--line); background: #ffffff; color: var(--ink); font-family: inherit; font-size: 14px;" />
          </div>
        </div>`;
      }
      
      sec.innerHTML = `
        <div class="section-title">
          <h3>${label}${typeText?': '+typeText:''}</h3>
          <div class="controls no-print">${locked?'' : '<button class="btn warn" data-remove-section>Remove</button>'}</div>
        </div>
        ${locked && !b737Type ? '' : aircraftDropdown}
        <table>
          <thead>
            <tr>
              <th><b>Flight Role</b></th>
              <th><b>Total Hours</b><span class="sub"><b>(HH:MM)</b></span></th>
              <th><b>Total Block Hours in the Last 12 Months</b><span class="sub"><b>(HH:MM)</b></span></th>
              <th><b>Date of First Flight</b><span class="sub"><b>(Last 12 Months)</b></span></th>
              <th><b>Date of Last Flight</b><span class="sub"><b>(Last 12 Months)</b></span></th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="flight-role"><strong>PIC</strong></td>
              <td><input type="text" class="hhmm totHours" placeholder="0:00" /></td>
              <td><input type="text" class="hhmm blk12" placeholder="0:00" /></td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
            </tr>
            <tr>
              <td class="flight-role">SIC</td>
              <td><input type="text" class="hhmm totHours" placeholder="0:00" /></td>
              <td><input type="text" class="hhmm blk12" placeholder="0:00" /></td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
              <td>
                <div class="date-cell">
                  <input type="date" class="date-inp" />
                  <span class="date-print"></span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="footer-fields">
          <div>
            <label>Total Combined Block Hours (HH:MM)</label>
            <div class="kpi"><b class="combined">0:00</b></div>
          </div>
          <div>
            <label>Total Multi‚ÄëPilot Block Hours (HH:MM)</label>
            <input type="text" class="hhmm mp" placeholder="0:00" />
          </div>
          <div>
            <label>Total Night Hours (HH:MM)</label>
            <input type="text" class="hhmm night" placeholder="0:00" />
          </div>
        </div>
      `;
      return sec;
    }

    // Initialize default aircraft sections
    function initializeAircraftSections() {
      console.log('‚úàÔ∏è === INITIALIZING AIRCRAFT SECTIONS ===');
      
      // Clear any existing sections first
      sectionsWrap.innerHTML = '';
      sectionCounter = 0;
      
      // Create Aircraft Type 1 (Boeing 737 NG/MAX)
      console.log('üõ©Ô∏è Creating Aircraft Type 1: Boeing 737 NG/MAX');
      const section1 = makeAircraftSection({
        label: 'Aircraft Type 1',
        typeText: 'Boeing 737 NG/MAX',
        locked: true,
        b737Type: 'ng-max'
      });
      sectionsWrap.appendChild(section1);
      
      // Create Aircraft Type 2 (Boeing 737 Classic)
      console.log('üõ©Ô∏è Creating Aircraft Type 2: Boeing 737 Classic');
      const section2 = makeAircraftSection({
        label: 'Aircraft Type 2', 
        typeText: 'Boeing 737 Classic (300-500)',
        locked: true,
        b737Type: 'classic'
      });
      sectionsWrap.appendChild(section2);
      
      // Initialize event listeners for all time fields in both default sections
      const allTimeFields = sectionsWrap.querySelectorAll('.hhmm');
      console.log(`üîß Adding event listeners to ${allTimeFields.length} time fields in default sections`);
      allTimeFields.forEach((field, index) => {
        // Add specific blur event listener to ensure processing works
        field.addEventListener('blur', function() {
          console.log(`üéØ Direct blur event on default time field: ${this.className}, value: "${this.value}"`);
          padHHMM(this);
          computeAll();
        });
        
        // Also add input event for real-time feedback
        field.addEventListener('input', function() {
          console.log(`‚å®Ô∏è Input event on default time field: ${this.className}, value: "${this.value}"`);
        });
        
        console.log(`  - Default time field ${index + 1}: ${field.className} event listeners added`);
      });
      
      console.log('‚úàÔ∏è Default aircraft sections initialized');
      
      // Recompute totals after initialization
      setTimeout(() => {
        if (typeof computeAll === 'function') {
          computeAll();
        }
      }, 50);
    }

    // Update the showStep function to initialize aircraft sections
    const originalShowStepFunction = showStep;
    showStep = function(step) {
      originalShowStepFunction(step);
      if (step === 2) {
        setTimeout(() => {
          // Check if we have saved flight experience data - use the actual save key
          const saveKey = 'pilotFormData';
          const savedData = localStorage.getItem(saveKey);
          console.log('üîç Checking for saved data with key:', saveKey);
          console.log('üîç Raw saved data exists:', !!savedData);
          console.log('üîç All localStorage keys:', Object.keys(localStorage));
          
          if (savedData) {
            try {
              const parsedData = JSON.parse(savedData);
              console.log('üîç Parsed data structure:', {
                hasFormData: !!parsedData.formData,
                hasFlightExperience: !!parsedData.formData?.flightExperience,
                hasAircraftSections: !!parsedData.formData?.flightExperience?.aircraftSections,
                sectionsLength: parsedData.formData?.flightExperience?.aircraftSections?.length || 0,
                hasSummaryHours: !!parsedData.formData?.flightExperience?.summaryHours,
                topLevelKeys: Object.keys(parsedData)
              });
              console.log('üîç Aircraft sections data:', parsedData.formData?.flightExperience?.aircraftSections);
              console.log('üîç Summary hours data:', parsedData.formData?.flightExperience?.summaryHours);
              
              const hasAircraftData = parsedData.formData?.flightExperience?.aircraftSections && parsedData.formData.flightExperience.aircraftSections.length > 0;
              const hasSummaryData = parsedData.formData?.flightExperience?.summaryHours;
              
              if (hasAircraftData || hasSummaryData) {
                console.log('üìÅ Found saved flight experience data, restoring sections and summary instead of initializing fresh ones');
                populateFormFields(); // Restore saved data
                return;
              } else {
                console.log('‚ö†Ô∏è No aircraft sections or summary data found');
              }
            } catch (e) {
              console.log('‚ö†Ô∏è Error parsing saved data:', e.message);
            }
          } else {
            console.log('‚ö†Ô∏è No saved data found in localStorage');
          }
          console.log('üÜï No saved flight experience data found, initializing fresh sections');
          initializeAircraftSections(); // Create fresh sections only if no saved data
        }, 100);
      }
    };

    // Check document validity based on expiry dates
    function checkValidity(docType) {
      const today = new Date();
      const expiryInput = document.getElementById(docType + 'Expiry');
      const statusDiv = document.getElementById(docType + 'Status');
      const dojInput = document.getElementById('doj');
      
      if (!expiryInput.value || !statusDiv) return;
      
      const expiryDate = new Date(expiryInput.value);
      const daysUntilExpiry = Math.ceil((expiryDate - today) / (1000 * 60 * 60 * 24));
      
      statusDiv.innerHTML = '';
      
      // Check if document expires before today
      if (daysUntilExpiry < 0) {
        statusDiv.innerHTML = '<span class="status-indicator status-expired">EXPIRED</span>';
        return;
      }
      
      // Check validity against joining date if available
      if (dojInput && dojInput.value) {
        const joiningDate = new Date(dojInput.value);
        const daysAfterJoining = Math.ceil((expiryDate - joiningDate) / (1000 * 60 * 60 * 24));
        
        // Passport must be valid for at least 6 months (180 days) after joining
        if (docType === 'passport' && daysAfterJoining < 180) {
          statusDiv.innerHTML = '<span class="status-indicator status-expired">EXPIRES TOO SOON AFTER JOINING (Need 6+ months)</span>';
          return;
        }
        
        // License documents must be valid for at least 90 days after joining
        if (['license', 'medical', 'rol'].includes(docType) && daysAfterJoining < 90) {
          statusDiv.innerHTML = '<span class="status-indicator status-expired">EXPIRES TOO SOON AFTER JOINING (Need 90+ days)</span>';
          return;
        }
      }
      
      // Standard validity checks
      if (daysUntilExpiry <= 30) {
        statusDiv.innerHTML = '<span class="status-indicator status-warning">EXPIRES SOON</span>';
      } else {
        statusDiv.innerHTML = '<span class="status-indicator status-valid">VALID</span>';
      }
    }

    // Calculate expiry for documents with standard validity periods

    // Original computeAll function from the original file
    function computeAll(){
      let gtCombined = 0, gtMP = 0, gtNight = 0;
      sectionsWrap.querySelectorAll('.section').forEach(sec=>{
        let combined = 0;
        sec.querySelectorAll('input.totHours').forEach(inp=> combined += parseHHMM(inp.value));
        const combinedEl = sec.querySelector('.combined');
        if(combinedEl) combinedEl.textContent = toHHMM(combined);
        gtCombined += combined;
        sec.querySelectorAll('input.mp').forEach(inp=> gtMP += parseHHMM(inp.value));
        sec.querySelectorAll('input.night').forEach(inp=> gtNight += parseHHMM(inp.value));
      });
      document.getElementById('gtCombined').textContent = toHHMM(gtCombined);
      document.getElementById('gtMP').textContent = toHHMM(gtMP);
      document.getElementById('gtNight').textContent = toHHMM(gtNight);
    }

    // Original event listeners from the original file
    document.addEventListener('input', (e)=>{
      const t = e.target;
      if(t.classList.contains('hhmm')){ computeAll(); }
      if(t.classList.contains('date-inp')){ const span = t.closest('.date-cell').querySelector('.date-print'); span.textContent = toDDMMMYYYY(t.value); }
      if(t.id === 'pilotName'){ const typed = document.getElementById('typedSig'); if(typed && !typed.value) typed.value = t.value; }
      // Show/hide notes field and heavy jet indicator based on aircraft type selection
      if(t.classList.contains('ac-type')){
        const section = t.closest('.section');
        const notesField = section.querySelector('.notes-field');
        const heavyJetIndicator = section.querySelector('.heavy-jet-indicator');
        
        // Handle notes field
        if(notesField){
          if(t.value === 'Other - Specify in Notes'){
            notesField.style.display = 'block';
          } else {
            notesField.style.display = 'none';
            // Clear the notes field when hiding
            const textarea = notesField.querySelector('.ac-notes');
            if(textarea) {
              textarea.value = '';
              textarea.classList.remove('required-empty');
            }
          }
        }
        
        // Handle heavy jet indicator
        if(heavyJetIndicator){
          if(isHeavyJet(t.value)){
            heavyJetIndicator.style.display = 'flex';
          } else {
            heavyJetIndicator.style.display = 'none';
          }
        }
      }
      // Clear validation styling when user types in notes field
      if(t.classList.contains('ac-notes')){
        t.classList.remove('required-empty');
      }
    });

    document.addEventListener('blur', (e)=>{
      const t = e.target;
      if(t.classList && t.classList.contains('hhmm')){ 
        console.log(`‚è∞ Time field blur detected: ${t.className}, value: "${t.value}"`);
        padHHMM(t); 
        computeAll(); 
      }
      if(t.classList && t.classList.contains('date-inp')){ const span = t.closest('.date-cell').querySelector('.date-print'); span.textContent = toDDMMMYYYY(t.value); }
    }, true);

    // Validate all aircraft sections are complete
    function validateAircraftSections() {
      console.log('üîç === VALIDATING AIRCRAFT SECTIONS ===');
      
      const sections = sectionsWrap.querySelectorAll('.section');
      console.log('üìä Total sections to validate:', sections.length);
      
      let isValid = true;
      let firstIncompleteSection = null;
      
      sections.forEach((section, index) => {
        const sectionTitle = section.querySelector('.section-title h3')?.textContent || `Section ${index + 1}`;
        console.log(`üõ©Ô∏è Validating ${sectionTitle}:`);
        
        // Check aircraft type selection (skip for locked sections with pre-selected types)
        const aircraftSelect = section.querySelector('.ac-type');
        const isLocked = section.dataset.locked === '1';
        
        if (!isLocked && (!aircraftSelect?.value || aircraftSelect.value === '')) {
          console.log(`‚ùå ${sectionTitle}: Aircraft type not selected`);
          isValid = false;
          if (!firstIncompleteSection) firstIncompleteSection = { section, field: aircraftSelect, message: 'Please select an aircraft type' };
        } else {
          console.log(`‚úÖ ${sectionTitle}: Aircraft type selected - ${aircraftSelect?.value || 'Pre-selected'}`);
        }
        
        // Check that ALL time fields are filled (not empty or 0:00)
        const hourInputs = section.querySelectorAll('.hhmm');
        let incompleteTimeField = null;
        let hasIncompleteTimeFields = false;
        
        // Apply red styling to ALL incomplete time fields in this section
        Array.from(hourInputs).forEach(input => {
          const value = input.value || '0:00';
          const isCompleted = value.trim() && value !== '0:00';
          if (!isCompleted) {
            hasIncompleteTimeFields = true;
            if (!incompleteTimeField) incompleteTimeField = input; // Track first for focus
            
            // Add visual error indication to ALL incomplete fields
            input.style.borderColor = '#dc2626';
            input.style.backgroundColor = '#fef2f2';
            input.style.borderWidth = '2px';
            input.style.boxShadow = '0 0 0 1px #dc2626';
            
            // Remove error styling when user starts typing
            input.addEventListener('input', function() {
              this.style.borderColor = '';
              this.style.backgroundColor = '';
              this.style.borderWidth = '';
              this.style.boxShadow = '';
            }, { once: true });
          }
        });
        
        if (hasIncompleteTimeFields) {
          console.log(`‚ùå ${sectionTitle}: Not all time fields completed`);
          isValid = false;
          if (!firstIncompleteSection) firstIncompleteSection = { section, field: incompleteTimeField, message: 'Please fill in all flight time fields for this aircraft type.' };
        } else {
          console.log(`‚úÖ ${sectionTitle}: All time fields completed`);
        }
        
        // Check notes field if "Other" aircraft type is selected
        if (aircraftSelect?.value === 'Other') {
          const notesField = section.querySelector('.ac-notes');
          if (!notesField?.value?.trim()) {
            console.log(`‚ùå ${sectionTitle}: Notes required for "Other" aircraft type`);
            isValid = false;
            if (!firstIncompleteSection) firstIncompleteSection = { section, field: notesField, message: 'Please specify the aircraft type in the notes field' };
          } else {
            console.log(`‚úÖ ${sectionTitle}: Notes provided for "Other" aircraft type`);
          }
        }
      });
      
      // Validate summary/grand total table fields
      if (isValid) {  // Only check summary fields if aircraft sections are valid
        const summaryTableInputs = document.querySelectorAll('.form-step[data-step="2"] .summary table tbody input.hhmm');
        summaryTableInputs.forEach((summaryInput, index) => {
          if (summaryInput && (!summaryInput.value.trim() || summaryInput.value === '0:00')) {
            console.log(`‚ùå Summary field ${index + 1} not completed`);
            isValid = false;
            
            // Add visual error indication
            summaryInput.style.borderColor = '#dc2626';
            summaryInput.style.backgroundColor = '#fef2f2';
            summaryInput.style.borderWidth = '2px';
            summaryInput.style.boxShadow = '0 0 0 1px #dc2626';
            
            // Remove error styling when user starts typing
            summaryInput.addEventListener('input', function() {
              this.style.borderColor = '';
              this.style.backgroundColor = '';
              this.style.borderWidth = '';
              this.style.boxShadow = '';
            }, { once: true });
            
            if (!firstIncompleteSection) {
              const fieldNames = ['PIC/P1', 'SIC/P2', 'Solo', 'Instrument', 'Sim', 'Night', 'Instructor', 'P1 U/S', 'Grand Total'];
              const fieldName = fieldNames[index] || `field ${index + 1}`;
              firstIncompleteSection = { section: null, field: summaryInput, message: `Please fill in the ${fieldName} field in the Flying Experience Summary table.` };
            }
          }
        });
      }
      
      // Validate footer total fields (Multi-Pilot and Night hours)
      if (isValid) {  // Only check footer fields if other fields are valid
        const footerMultiPilotField = document.querySelector('.footer-fields .hhmm.mp');
        const footerNightField = document.querySelector('.footer-fields .hhmm.night');
        
        if (footerMultiPilotField && (!footerMultiPilotField.value.trim() || footerMultiPilotField.value === '0:00')) {
          console.log('‚ùå Footer Multi-Pilot field not completed');
          isValid = false;
          
          // Add visual error indication
          footerMultiPilotField.style.borderColor = '#dc2626';
          footerMultiPilotField.style.backgroundColor = '#fef2f2';
          footerMultiPilotField.style.borderWidth = '2px';
          footerMultiPilotField.style.boxShadow = '0 0 0 1px #dc2626';
          
          // Remove error styling when user starts typing
          footerMultiPilotField.addEventListener('input', function() {
            this.style.borderColor = '';
            this.style.backgroundColor = '';
            this.style.borderWidth = '';
            this.style.boxShadow = '';
          }, { once: true });
          
          if (!firstIncompleteSection) firstIncompleteSection = { section: null, field: footerMultiPilotField, message: 'Please fill in the Total Multi‚ÄëPilot Block Hours field at the bottom of the page.' };
        }
        
        if (footerNightField && (!footerNightField.value.trim() || footerNightField.value === '0:00')) {
          console.log('‚ùå Footer Night Hours field not completed');
          isValid = false;
          
          // Add visual error indication
          footerNightField.style.borderColor = '#dc2626';
          footerNightField.style.backgroundColor = '#fef2f2';
          footerNightField.style.borderWidth = '2px';
          footerNightField.style.boxShadow = '0 0 0 1px #dc2626';
          
          // Remove error styling when user starts typing
          footerNightField.addEventListener('input', function() {
            this.style.borderColor = '';
            this.style.backgroundColor = '';
            this.style.borderWidth = '';
            this.style.boxShadow = '';
          }, { once: true });
          
          if (!firstIncompleteSection) firstIncompleteSection = { section: null, field: footerNightField, message: 'Please fill in the Total Night Hours field at the bottom of the page.' };
        }
      }
      
      if (!isValid && firstIncompleteSection) {
        // Highlight the incomplete section (if it exists)
        if (firstIncompleteSection.section) {
          firstIncompleteSection.section.style.borderColor = '#ef4444';
          firstIncompleteSection.section.style.borderWidth = '2px';
          firstIncompleteSection.section.style.borderStyle = 'solid';
        }
        
        // Focus the problematic field
        if (firstIncompleteSection.field) {
          firstIncompleteSection.field.focus();
          firstIncompleteSection.field.scrollIntoView({ behavior: 'smooth', block: 'center' });
          
          // Add visual error styling to the field
          firstIncompleteSection.field.style.borderColor = '#dc2626';
          firstIncompleteSection.field.style.backgroundColor = '#fef2f2';
          firstIncompleteSection.field.style.borderWidth = '2px';
          firstIncompleteSection.field.style.boxShadow = '0 0 0 1px #dc2626';
        }
        
        // Show error message
        alert(`Please complete all fields before adding a new aircraft section.\n\n${firstIncompleteSection.message}`);
        
        // Remove highlight after 3 seconds
        setTimeout(() => {
          if (firstIncompleteSection.section) {
            firstIncompleteSection.section.style.borderColor = '';
            firstIncompleteSection.section.style.borderWidth = '';
            firstIncompleteSection.section.style.borderStyle = '';
          }
          if (firstIncompleteSection.field) {
            firstIncompleteSection.field.style.borderColor = '';
            firstIncompleteSection.field.style.backgroundColor = '';
            firstIncompleteSection.field.style.borderWidth = '';
            firstIncompleteSection.field.style.boxShadow = '';
          }
        }, 3000);
      }
      
      console.log('üîç Aircraft sections validation result:', isValid);
      console.log('‚úÖ === AIRCRAFT SECTION VALIDATION COMPLETE ===');
      return isValid;
    }

    // Add event listener for Add Aircraft Section button and Remove buttons
    document.addEventListener('click', (e) => {
      // Handle Add Aircraft Section button
      if (e.target.id === 'btnAddSection') {
        console.log('‚ûï Add Aircraft Section button clicked');
        
        // Validate all existing aircraft sections are complete
        if (!validateAircraftSections()) {
          console.log('‚ùå Aircraft sections validation failed, cannot add new section');
          return;
        }
        
        // Validate other form fields (original validation)
        if(!validateOtherFields()) {
          console.log('‚ùå Other fields validation failed, cannot add new section');
          return;
        }
        
        const count = sectionsWrap.querySelectorAll('.section').length + 1;
        console.log('üõ©Ô∏è Adding Aircraft Type', count);
        
        const newSection = makeAircraftSection({
          label: `Aircraft Type ${count}`, 
          typeText: '', 
          locked: false
        });
        
        sectionsWrap.appendChild(newSection);
        console.log('‚úÖ New aircraft section added');
        
        // Ensure all time fields in the new section are properly initialized
        const newTimeFields = newSection.querySelectorAll('.hhmm');
        console.log(`üîß Initializing ${newTimeFields.length} time fields in new section`);
        newTimeFields.forEach((field, index) => {
          // Ensure the field has the right placeholder and is ready for input
          if (!field.value) field.value = '0:00';
          console.log(`  - Time field ${index + 1}: ${field.className} initialized`);
          
          // Add specific blur event listener to ensure processing works
          field.addEventListener('blur', function() {
            console.log(`üéØ Direct blur event on new time field: ${this.className}, value: "${this.value}"`);
            padHHMM(this);
            computeAll();
          });
          
          // Also add input event for real-time feedback
          field.addEventListener('input', function() {
            console.log(`‚å®Ô∏è Input event on new time field: ${this.className}, value: "${this.value}"`);
          });
        });
        
        // Recompute totals
        computeAll();
      }
      
      // Handle Remove Section buttons
      if (e.target.hasAttribute('data-remove-section')) {
        console.log('üóëÔ∏è Remove section button clicked');
        const section = e.target.closest('.section');
        if (section) {
          section.remove();
          console.log('‚úÖ Section removed');
          computeAll();
        }
      }
    });

    // Layout and spacing debugging functions
    function debugLayout() {
      console.log('üé® === LAYOUT DEBUG ANALYSIS ===');
      
      // Check all form steps
      const steps = document.querySelectorAll('.form-step');
      console.log('üìã Form steps found:', steps.length);
      
      steps.forEach((step, index) => {
        const stepNumber = step.getAttribute('data-step');
        const isActive = step.classList.contains('active');
        const computedStyle = window.getComputedStyle(step);
        
        console.log(`üìÑ Step ${stepNumber}:`, {
          active: isActive,
          display: computedStyle.display,
          visibility: computedStyle.visibility,
          height: computedStyle.height,
          padding: computedStyle.padding,
          margin: computedStyle.margin
        });
        
        // Check sections within each step
        const sections = step.querySelectorAll('.form-section, .section');
        console.log(`  üì¶ Sections in Step ${stepNumber}:`, sections.length);
        
        sections.forEach((section, sIndex) => {
          const sectionStyle = window.getComputedStyle(section);
          const title = section.querySelector('h2, h3, .section-title')?.textContent?.slice(0, 30) || `Section ${sIndex + 1}`;
          
          console.log(`    üè∑Ô∏è ${title}:`, {
            marginTop: sectionStyle.marginTop,
            marginBottom: sectionStyle.marginBottom,
            paddingTop: sectionStyle.paddingTop,
            paddingBottom: sectionStyle.paddingBottom,
            height: sectionStyle.height,
            minHeight: sectionStyle.minHeight
          });
        });
      });
    }

    function debugSpacing() {
      console.log('üìè === SPACING DEBUG ANALYSIS ===');
      
      // Check aircraft sections specifically
      const aircraftSections = document.querySelectorAll('#sections .section, #sections .form-section');
      console.log('‚úàÔ∏è Aircraft sections found:', aircraftSections.length);
      
      aircraftSections.forEach((section, index) => {
        const title = section.querySelector('.section-title h3, .section-title')?.textContent || `Aircraft ${index + 1}`;
        const titleElement = section.querySelector('.section-title');
        const style = window.getComputedStyle(section);
        const titleStyle = titleElement ? window.getComputedStyle(titleElement) : null;
        
        console.log(`‚úàÔ∏è ${title}:`, {
          sectionMargin: {
            top: style.marginTop,
            bottom: style.marginBottom
          },
          sectionPadding: {
            top: style.paddingTop,
            bottom: style.paddingBottom
          },
          titleMargin: titleStyle ? {
            top: titleStyle.marginTop,
            bottom: titleStyle.marginBottom
          } : 'No title',
          titlePadding: titleStyle ? {
            top: titleStyle.paddingTop,
            bottom: titleStyle.paddingBottom
          } : 'No title'
        });
        
        // Check remove buttons
        const removeButton = section.querySelector('[data-remove-section], .remove-btn');
        if (removeButton) {
          const buttonStyle = window.getComputedStyle(removeButton);
          const buttonContainer = removeButton.closest('div, .section-title');
          const containerStyle = buttonContainer ? window.getComputedStyle(buttonContainer) : null;
          
          console.log(`  üóëÔ∏è Remove button spacing:`, {
            buttonMargin: {
              top: buttonStyle.marginTop,
              bottom: buttonStyle.marginBottom
            },
            buttonPadding: {
              top: buttonStyle.paddingTop,
              bottom: buttonStyle.paddingBottom
            },
            containerMargin: containerStyle ? {
              top: containerStyle.marginTop,
              bottom: containerStyle.marginBottom
            } : 'No container',
            containerPadding: containerStyle ? {
              top: containerStyle.paddingTop,
              bottom: containerStyle.paddingBottom
            } : 'No container'
          });
        }
      });
      
      // Check form inputs and their containers
      const inputs = document.querySelectorAll('input, select, textarea');
      const inputSpacing = {};
      
      inputs.forEach(input => {
        const container = input.closest('div');
        const containerStyle = container ? window.getComputedStyle(container) : null;
        const inputStyle = window.getComputedStyle(input);
        const type = input.type || input.tagName.toLowerCase();
        
        if (!inputSpacing[type]) {
          inputSpacing[type] = {
            count: 0,
            marginTop: [],
            marginBottom: [],
            paddingTop: [],
            paddingBottom: []
          };
        }
        
        inputSpacing[type].count++;
        inputSpacing[type].marginTop.push(inputStyle.marginTop);
        inputSpacing[type].marginBottom.push(inputStyle.marginBottom);
        inputSpacing[type].paddingTop.push(inputStyle.paddingTop);
        inputSpacing[type].paddingBottom.push(inputStyle.paddingBottom);
      });
      
      console.log('üìù Input spacing analysis:', inputSpacing);
    }

    function debugAircraftSections() {
      console.log('‚úàÔ∏è === AIRCRAFT SECTION DEBUG ===');
      
      const preLoadedSections = document.querySelectorAll('#sections .section');
      console.log('üõ©Ô∏è Pre-loaded sections:', preLoadedSections.length);
      
      preLoadedSections.forEach((section, index) => {
        const title = section.querySelector('.section-title h3')?.textContent || `Section ${index + 1}`;
        const titleElement = section.querySelector('.section-title');
        const removeButton = section.querySelector('[data-remove-section]');
        
        console.log(`üõ©Ô∏è ${title}:`, {
          hasTitle: !!titleElement,
          titleClasses: titleElement ? Array.from(titleElement.classList) : [],
          hasRemoveButton: !!removeButton,
          removeButtonClasses: removeButton ? Array.from(removeButton.classList) : [],
          sectionClasses: Array.from(section.classList),
          innerHTML: section.innerHTML.slice(0, 200) + '...'
        });
        
        // Compare with makeAircraftSection structure
        console.log(`  üìê Layout comparison:`, {
          titleStructure: titleElement ? {
            tag: titleElement.tagName,
            children: titleElement.children.length,
            textContent: titleElement.textContent?.slice(0, 50)
          } : null,
          removeButtonStructure: removeButton ? {
            tag: removeButton.tagName,
            type: removeButton.type,
            textContent: removeButton.textContent?.trim()
          } : null
        });
      });
      
      // Test makeAircraftSection to compare
      console.log('üî¨ Testing makeAircraftSection structure:');
      const testSection = makeAircraftSection({label: 'TEST', typeText: '', locked: false});
      const testTitle = testSection.querySelector('.section-title');
      const testRemoveButton = testSection.querySelector('[data-remove-section]');
      
      console.log('üß™ Test section structure:', {
        titleClasses: testTitle ? Array.from(testTitle.classList) : [],
        removeButtonClasses: testRemoveButton ? Array.from(testRemoveButton.classList) : [],
        sectionClasses: Array.from(testSection.classList),
        titleStructure: testTitle ? {
          tag: testTitle.tagName,
          children: testTitle.children.length,
          textContent: testTitle.textContent?.slice(0, 50)
        } : null,
        removeButtonStructure: testRemoveButton ? {
          tag: testRemoveButton.tagName,
          type: testRemoveButton.type,
          textContent: testRemoveButton.textContent?.trim()
        } : null
      });
    }

    // File size validation constants
    const MAX_TOTAL_SIZE_MB = 2; // Maximum total size across all files
    const MAX_INDIVIDUAL_SIZE_KB = 250; // Maximum individual file size in KB
    
    // File size validation function
    function validateFileSize(fileInput, maxSizeKB = MAX_INDIVIDUAL_SIZE_KB) {
      const file = fileInput.files[0];
      if (!file) return true;
      
      const fileSizeKB = file.size / 1024;
      const fileSizeMB = fileSizeKB / 1024;
      
      // Check individual file size
      if (fileSizeKB > maxSizeKB) {
        showFileSizeError(fileInput, `File size (${fileSizeMB.toFixed(1)}MB) exceeds maximum allowed size of ${(maxSizeKB/1024).toFixed(1)}MB per file.`);
        fileInput.value = ''; // Clear the file input
        return false;
      }
      
      // Check total size across all files
      const totalSize = calculateTotalFileSize();
      if (totalSize > MAX_TOTAL_SIZE_MB * 1024 * 1024) {
        const totalSizeMB = totalSize / (1024 * 1024);
        showFileSizeError(fileInput, `Total file size (${totalSizeMB.toFixed(1)}MB) exceeds maximum allowed total of ${MAX_TOTAL_SIZE_MB}MB across all uploads.`);
        fileInput.value = ''; // Clear the file input
        return false;
      }
      
      return true;
    }
    
    // Calculate total file size across all file inputs
    function calculateTotalFileSize() {
      const fileInputs = document.querySelectorAll('input[type="file"]:not(#sigUpload)');
      let totalSize = 0;
      fileInputs.forEach(input => {
        if (input.files && input.files[0]) {
          totalSize += input.files[0].size;
        }
      });
      return totalSize;
    }
    
    // Show file size error popup
    function showFileSizeError(fileInput, message) {
      const fieldName = getFieldDisplayName(fileInput.id);
      alert(`${fieldName}: ${message}\n\nMaximum individual file size: ${(MAX_INDIVIDUAL_SIZE_KB/1024).toFixed(1)}MB\nMaximum total size across all uploads: ${MAX_TOTAL_SIZE_MB}MB`);
    }
    
    // Get display name for field
    function getFieldDisplayName(fieldId) {
      const fieldNames = {
        'licenseFile': 'Pilot License',
        'rolFile': 'Radio Operator License', 
        'englishFile': 'English Proficiency Certificate',
        'medicalFile': 'Medical Certificate',
        'passportFile': 'Passport Copy',
        'licenseVerificationFile': 'License Verification Letter',
        'incidentLetterFile': 'No Incident/Accident Letter', 
        'flightHoursFile': 'Flight Hours Verification Letter',
        'emiratesIdFile': 'Emirates ID',
        'visaFile': 'UAE Visa & Work Permit'
      };
      return fieldNames[fieldId] || 'Document';
    }

    // Initialize the form when page loads
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ === DOM CONTENT LOADED ===');
      console.log('üåê Page URL:', window.location.href);
      console.log('üïí Load time:', new Date().toLocaleString());
      console.log('‚úÖ parseHHMM function available:', typeof parseHHMM);
      console.log('‚úÖ computeAll function available:', typeof computeAll);
      console.log('‚úÖ sectionCounter initialized:', sectionCounter);
      console.log('‚úÖ sectionsWrap element found:', !!sectionsWrap);
      
      // Make functions globally accessible after they're defined
      console.log('üîó Attaching global functions...')
      
      // ===== Authority Dropdown "Other" Option Handlers =====
      console.log('üîó Setting up authority dropdown handlers...');
      
      // Medical Authority dropdown
      const medicalAuthority = document.getElementById('medicalAuthority');
      const medicalAuthorityOtherDiv = document.getElementById('medicalAuthorityOtherDiv');
      if (medicalAuthority && medicalAuthorityOtherDiv) {
        medicalAuthority.addEventListener('change', () => {
          if (medicalAuthority.value === 'Other') {
            medicalAuthorityOtherDiv.style.display = 'block';
          } else {
            medicalAuthorityOtherDiv.style.display = 'none';
          }
        });
      }
      
      // Radio Authority dropdown  
      const rolAuthority = document.getElementById('rolAuthority');
      const rolAuthorityOtherDiv = document.getElementById('rolAuthorityOtherDiv');
      if (rolAuthority && rolAuthorityOtherDiv) {
        rolAuthority.addEventListener('change', () => {
          if (rolAuthority.value === 'Other') {
            rolAuthorityOtherDiv.style.display = 'block';
          } else {
            rolAuthorityOtherDiv.style.display = 'none';
          }
        });
      }
      
      // License Verification Authority dropdown
      const licenseVerificationAuthority = document.getElementById('licenseVerificationAuthority');
      const licenseVerificationAuthorityOtherDiv = document.getElementById('licenseVerificationAuthorityOtherDiv');
      if (licenseVerificationAuthority && licenseVerificationAuthorityOtherDiv) {
        licenseVerificationAuthority.addEventListener('change', () => {
          if (licenseVerificationAuthority.value === 'Other') {
            licenseVerificationAuthorityOtherDiv.style.display = 'block';
          } else {
            licenseVerificationAuthorityOtherDiv.style.display = 'none';
          }
        });
      }
      
      // Incident Letter Authority dropdown
      const incidentLetterAuthority = document.getElementById('incidentLetterAuthority');
      const incidentLetterAuthorityOtherDiv = document.getElementById('incidentLetterAuthorityOtherDiv');
      if (incidentLetterAuthority && incidentLetterAuthorityOtherDiv) {
        incidentLetterAuthority.addEventListener('change', () => {
          if (incidentLetterAuthority.value === 'Other') {
            incidentLetterAuthorityOtherDiv.style.display = 'block';
          } else {
            incidentLetterAuthorityOtherDiv.style.display = 'none';
          }
        });
      }
      
      console.log('‚úÖ Authority dropdown handlers set up completed');
      
      // ===== English Test Type Handler =====
      console.log('üîó Setting up English test type handler...');
      
      const englishTestType = document.getElementById('englishTestType');
      const englishUploadDiv = document.getElementById('englishUploadDiv');
      const englishTestDate = document.getElementById('englishTestDate');
      const englishLevel = document.getElementById('englishLevel');
      const englishTestDateDiv = document.getElementById('englishTestDateDiv');
      const englishLevelDiv = englishLevel ? englishLevel.parentElement : null;
      
      if (englishTestType && englishUploadDiv) {
        englishTestType.addEventListener('change', () => {
          if (englishTestType.value === 'Attached to License') {
            // Hide upload, test date, and proficiency level fields
            englishUploadDiv.style.display = 'none';
            if (englishTestDateDiv) englishTestDateDiv.style.display = 'none';
            if (englishLevelDiv) englishLevelDiv.style.display = 'none';
            
            // Clear the file input when hiding
            const fileInput = document.getElementById('englishFile');
            if (fileInput) {
              fileInput.value = '';
              // Remove any validation errors
              const formSection = fileInput.closest('.form-section');
              if (formSection) {
                formSection.style.borderColor = '';
                formSection.style.backgroundColor = '';
                const errorMsg = formSection.querySelector('.error-message');
                if (errorMsg) errorMsg.remove();
              }
            }
            
            // Clear other fields
            if (englishTestDate) englishTestDate.value = '';
            if (englishLevel) englishLevel.value = '';
          } else {
            // Show all fields when not "Attached to License"
            englishUploadDiv.style.display = 'block';
            if (englishTestDateDiv) englishTestDateDiv.style.display = 'block';
            if (englishLevelDiv) englishLevelDiv.style.display = 'block';
          }
        });
      }
      
      console.log('‚úÖ English test type handler set up completed');
      
      // ===== Visa Status Handler =====
      console.log('üîó Setting up visa status handler...');
      
      const visaStatus = document.getElementById('visaStatus');
      const visaExpiryDiv = visaStatus?.closest('.grid').children[1]; // The div containing visa expiry date
      const visaFileDiv = visaStatus?.closest('.grid').children[2];   // The div containing visa file upload
      
      if (visaStatus && visaExpiryDiv && visaFileDiv) {
        // Function to toggle visa fields visibility
        function toggleVisaFields() {
          const isNoVisa = visaStatus.value === 'No Current UAE Visa';
          const displayValue = isNoVisa ? 'none' : 'block';
          
          visaExpiryDiv.style.display = displayValue;
          visaFileDiv.style.display = displayValue;
          
          // Clear values if hiding fields
          if (isNoVisa) {
            const visaExpiryInput = document.getElementById('visaExpiry');
            const visaFileInput = document.getElementById('visaFile');
            
            if (visaExpiryInput) {
              visaExpiryInput.value = '';
              // Remove any validation errors
              const formSection = visaExpiryInput.closest('.form-section');
              if (formSection) {
                formSection.style.borderColor = '';
                formSection.style.backgroundColor = '';
                const errorMsg = formSection.querySelector('.error-message');
                if (errorMsg) errorMsg.remove();
              }
            }
            
            if (visaFileInput) {
              visaFileInput.value = '';
              // Remove any validation errors
              const formSection = visaFileInput.closest('.form-section');
              if (formSection) {
                formSection.style.borderColor = '';
                formSection.style.backgroundColor = '';
                const errorMsg = formSection.querySelector('.error-message');
                if (errorMsg) errorMsg.remove();
              }
            }
          }
          
          console.log(`üõÇ Visa fields ${isNoVisa ? 'hidden' : 'shown'} based on status: ${visaStatus.value}`);
        }
        
        // Add change event listener
        visaStatus.addEventListener('change', toggleVisaFields);
        
        // Initialize on page load
        toggleVisaFields();
      }
      
      console.log('‚úÖ Visa status handler set up completed');
      
      // ===== 30-Day Letter Validation =====
      console.log('üîó Setting up 30-day letter validation...');
      
      // Function to check if letter date is within 30 days of joining date
      function validateLetterDate(letterDateId, letterName) {
        const dojInput = document.getElementById('doj');
        const letterDateInput = document.getElementById(letterDateId);
        
        if (!dojInput?.value || !letterDateInput?.value) return;
        
        const joiningDate = new Date(dojInput.value);
        const letterDate = new Date(letterDateInput.value);
        const daysDifference = Math.abs((joiningDate - letterDate) / (1000 * 60 * 60 * 24));
        
        console.log(`üìã Checking ${letterName}:`, {
          joiningDate: joiningDate.toDateString(),
          letterDate: letterDate.toDateString(),
          daysDifference: daysDifference
        });
        
        if (daysDifference > 30) {
          const message = `‚ö†Ô∏è Important Notice Regarding ${letterName}\n\n` +
            `The ${letterName.toLowerCase()} is dated more than 30 days from your flydubai joining date.\n\n` +
            `üìÖ Letter Date: ${letterDate.toLocaleDateString()}\n` +
            `üìÖ Joining Date: ${joiningDate.toLocaleDateString()}\n` +
            `üìä Days Difference: ${Math.round(daysDifference)} days\n\n` +
            `üìã REQUIREMENT: All verification letters must be issued within 30 days of your employment start date.\n\n` +
            `‚è∞ IMPORTANT: Please ensure this letter is reissued within 30 days of your joining date, ` +
            `otherwise your start date may need to be postponed until flydubai receives the updated documentation.\n\n` +
            `üíº We recommend coordinating with your previous employer or the issuing authority to obtain ` +
            `an updated letter closer to your joining date to avoid any delays in your employment commencement.`;
          
          setTimeout(() => alert(message), 500);
        }
      }
      
      // Add file size validation to all file inputs (catch-all for any not already handled)
      const allFileInputs = document.querySelectorAll('input[type="file"]:not(#sigUpload)');
      allFileInputs.forEach(fileInput => {
        // Check if this input already has our validation (avoid duplicate handlers)
        if (!fileInput.hasAttribute('data-size-validated')) {
          fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
              validateFileSize(this);
            }
          });
          fileInput.setAttribute('data-size-validated', 'true');
        }
      });

      // Add event listeners for the three letter dates
      const licenseVerificationDate = document.getElementById('licenseVerificationDate');
      const flightHoursIssue = document.getElementById('flightHoursIssue');
      const incidentLetterDate = document.getElementById('incidentLetterDate');
      
      if (licenseVerificationDate) {
        licenseVerificationDate.addEventListener('change', () => {
          validateLetterDate('licenseVerificationDate', 'License Verification Letter');
        });
      }
      
      if (flightHoursIssue) {
        flightHoursIssue.addEventListener('change', () => {
          validateLetterDate('flightHoursIssue', 'Flight Hours Verification Letter');
        });
      }
      
      if (incidentLetterDate) {
        incidentLetterDate.addEventListener('change', () => {
          validateLetterDate('incidentLetterDate', 'No Incident/Accident Letter');
        });
      }
      
      // Also validate when date of joining changes
      const dojInput = document.getElementById('doj');
      if (dojInput) {
        dojInput.addEventListener('change', () => {
          // Validate all three letters when joining date changes
          setTimeout(() => {
            validateLetterDate('licenseVerificationDate', 'License Verification Letter');
            validateLetterDate('flightHoursIssue', 'Flight Hours Verification Letter');
            validateLetterDate('incidentLetterDate', 'No Incident/Accident Letter');
          }, 100);
        });
      }
      
      console.log('‚úÖ 30-day letter validation set up completed');
      
      // ===== Enter Key Navigation for Time Fields =====
      console.log('üîó Setting up Enter key navigation for time fields...');
      
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && e.target.classList.contains('hhmm')) {
          e.preventDefault(); // Prevent form submission
          
          // Find all time fields (hhmm class) in the current section
          const currentSection = e.target.closest('.section') || document;
          const timeFields = Array.from(currentSection.querySelectorAll('.hhmm'));
          const currentIndex = timeFields.indexOf(e.target);
          
          if (currentIndex !== -1 && currentIndex < timeFields.length - 1) {
            // Move to next time field in the same section
            timeFields[currentIndex + 1].focus();
            timeFields[currentIndex + 1].select();
          } else {
            // If it's the last field in the section, try to find the next section's first time field
            const allSections = Array.from(document.querySelectorAll('.section'));
            const currentSectionIndex = allSections.indexOf(e.target.closest('.section'));
            
            if (currentSectionIndex !== -1 && currentSectionIndex < allSections.length - 1) {
              const nextSection = allSections[currentSectionIndex + 1];
              const nextSectionTimeFields = nextSection.querySelectorAll('.hhmm');
              if (nextSectionTimeFields.length > 0) {
                nextSectionTimeFields[0].focus();
                nextSectionTimeFields[0].select();
              } else {
                // Next section has no time fields, blur current field to process it
                console.log('üîö Last field in section and next section has no time fields, triggering blur');
                e.target.blur();
              }
            } else {
              // If no next section, try to find any time field after the current one in the whole document
              const allTimeFields = Array.from(document.querySelectorAll('.hhmm'));
              const globalCurrentIndex = allTimeFields.indexOf(e.target);
              console.log(`üåç Global navigation: found ${allTimeFields.length} total time fields, current at index ${globalCurrentIndex}`);
              console.log('üîç Time field locations:', allTimeFields.map((field, i) => ({
                index: i,
                isCurrentField: field === e.target,
                section: field.closest('.section')?.querySelector('h3')?.textContent?.trim() || 'Summary row',
                parentId: field.closest('[id]')?.id || 'no-id',
                className: field.className
              })));
              
              if (globalCurrentIndex !== -1 && globalCurrentIndex < allTimeFields.length - 1) {
                const nextField = allTimeFields[globalCurrentIndex + 1];
                console.log(`üéØ Moving to next field globally: ${nextField.className} in ${nextField.closest('.section')?.classList.value || 'summary'}`);
                nextField.focus();
                nextField.select();
              } else {
                // This is the very last time field - blur it to trigger processing
                console.log('üîö Last time field in form, triggering blur to process value');
                e.target.blur();
              }
            }
          }
        }
      });
      
      console.log('‚úÖ Enter key navigation set up completed');
      
      window.nextStep = nextStep;
      window.previousStep = previousStep;
      window.recoverSession = recoverSession;
      window.clearSession = clearSession;
      
      console.log('‚úÖ Global functions attached:', {
        nextStep: typeof window.nextStep,
        previousStep: typeof window.previousStep,
        recoverSession: typeof window.recoverSession,
        clearSession: typeof window.clearSession
      });
      
      // Check for critical elements
      const criticalElements = {
        progressFill: !!document.getElementById('progressFill'),
        recoveryBanner: !!document.getElementById('recoveryBanner'),
        nextBtn: !!document.getElementById('nextBtn'),
        prevBtn: !!document.getElementById('prevBtn'),
        steps: document.querySelectorAll('.form-step').length,
        stepIndicators: document.querySelectorAll('.step').length
      };
      console.log('üèóÔ∏è Critical elements check:', criticalElements);
      
      initializeForm();
      
      // Add layout debugging function
      window.debugLayout = debugLayout;
      window.debugSpacing = debugSpacing;
      window.debugAircraftSections = debugAircraftSections;
      
      // Add event listener for joining date to re-validate documents
      const dojElement = document.getElementById('doj');
      if (dojElement) {
        dojElement.addEventListener('change', () => {
          // Re-validate all documents when joining date changes
          ['passport', 'license', 'medical', 'rol'].forEach(docType => {
            const expiryInput = document.getElementById(docType + 'Expiry');
            if (expiryInput && expiryInput.value) {
              checkValidity(docType);
            }
          });
        });
      }
      
      console.log('üé® Layout debugging functions available. Use debugLayout(), debugSpacing(), or debugAircraftSections() in console');
      
      // Initialize signature date to today (from original file)
      const sigDateElement = document.getElementById('sigDate');
      if (sigDateElement) {
        sigDateElement.value = new Date().toISOString().split('T')[0];
      }

      // ===== Signature pad logic (draw / typed / upload) ===== 
      // EXACT COPY FROM WORKING ORIGINAL FILE WITH HIDDEN CANVAS FIX
      (function initSignature(){
        const canvas = document.getElementById('sigCanvas');
        if(!canvas) return; const ctx = canvas.getContext('2d');
        function setupCanvas(){
          const ratio = Math.max(window.devicePixelRatio || 1, 1);
          const rect = canvas.getBoundingClientRect();
          // If canvas is hidden (zero width), use a default width
          const canvasWidth = rect.width > 0 ? rect.width : 400;
          canvas.width = canvasWidth * ratio; canvas.height = 160 * ratio;
          ctx.setTransform(ratio,0,0,ratio,0,0); ctx.lineWidth = 2; ctx.lineJoin='round'; ctx.lineCap='round'; ctx.strokeStyle = '#111827';
        }
        function clearCanvas(){ ctx.clearRect(0,0,canvas.width,canvas.height); }
        function pos(e){ const r=canvas.getBoundingClientRect(); const p=e.touches? e.touches[0]: e; return {x:p.clientX - r.left, y:p.clientY - r.top}; }
        let drawing=false, lastX=0, lastY=0;
        function start(e){ drawing=true; const p=pos(e); lastX=p.x; lastY=p.y; e.preventDefault(); }
        function move(e){ if(!drawing) return; const p=pos(e); ctx.beginPath(); ctx.moveTo(lastX,lastY); ctx.lineTo(p.x,p.y); ctx.stroke(); lastX=p.x; lastY=p.y; e.preventDefault(); }
        function end(){ drawing=false; }
        setupCanvas(); window.addEventListener('resize', setupCanvas);
        canvas.addEventListener('mousedown', start); canvas.addEventListener('mousemove', move); window.addEventListener('mouseup', end);
        canvas.addEventListener('touchstart', start, {passive:false}); canvas.addEventListener('touchmove', move, {passive:false}); window.addEventListener('touchend', end);

        document.getElementById('sigClear').addEventListener('click', clearCanvas);
        document.getElementById('sigApply').addEventListener('click', ()=>{
          const txt = (document.getElementById('typedSig').value || '').trim(); if(!txt) return;
          clearCanvas();
          ctx.font = '36px cursive'; ctx.fillStyle = '#111827';
          const metrics = ctx.measureText(txt); const cssW = canvas.getBoundingClientRect().width; const x = Math.max(10, (cssW - metrics.width)/2 );
          ctx.fillText(txt, x, 110);
        });
        document.getElementById('sigUpload').addEventListener('change', (ev)=>{
          const file = ev.target.files && ev.target.files[0]; if(!file) return;
          const img = new Image(); img.onload = ()=>{
            clearCanvas();
            const cssW = canvas.getBoundingClientRect().width, cssH = 160; 
            const scale = Math.min(cssW*0.9 / img.width, cssH*0.9 / img.height);
            const w = img.width * scale, h = img.height * scale; const x = (cssW - w)/2, y = (cssH - h)/2;
            ctx.drawImage(img, x, y, w, h);
          }; img.src = URL.createObjectURL(file);
        });
      })();

      
      console.log('‚úÖ === INITIALIZATION COMPLETE ===');
      console.log('üöÄ Deployment trigger:', new Date().toISOString());
      console.log('üîÑ Force deployment update:', Date.now());
    });
  </script>
</body>
</html>